function U(t,e){return t<e?t:e}function x({id:t,name:e,description:n,tags:o}){let r=document.createElement("details");r.setAttribute("name","test"),r.dataset.id=t;let i=document.createElement("summary"),s=document.createElement("span");s.className="title",s.textContent=e,i.appendChild(s);let d=[];for(let a of Object.keys(o))d.push(...o[a]);if(d.length>0){let a=document.createElement("ul");a.className="tags";for(let u=0;u<U(d.length,5);u++){let l=document.createElement("li");l.setAttribute("t",d[u]),a.appendChild(l)}i.appendChild(a)}let c=document.createElement("button");if(c.classList.add("open"),c.textContent="\u10D2\u10D0\u10EE\u10E1\u10DC\u10D0",i.appendChild(c),r.appendChild(i),n){let a=document.createElement("div");a.className="description",a.textContent=n,r.appendChild(a)}if(d.length>0){let a=document.createElement("ul");a.className="attributes";for(let u of Object.keys(o)){let l=document.createElement("li");if(l.appendChild(document.createTextNode(u+":")),o[u]&&o[u].length>0){let h=document.createElement("ul");h.className="tags",o[u].forEach(w=>{let E=document.createElement("li");E.setAttribute("t",w),h.appendChild(E)}),l.appendChild(h)}a.appendChild(l)}r.appendChild(a)}return r}function y(){let t=localStorage.getItem("authToken");return t?{Authorization:`Bearer ${t}`}:{}}var g=class extends Error{};var f="https://terryapi.dimitri.ge/api";async function b(){let t=await fetch(`${f}/test/list`,{headers:y()});if(!t.ok){if(t.status===401)throw new g;{let n=JSON.stringify(await t.json());throw new Error(n)}}return(await t.json()).tests}async function N(){let t=await fetch(`${f}/test`,{method:"POST",headers:y()});if(!t.ok){if(t.status===401)throw new g;{let n=JSON.stringify(await t.json());throw new Error(n)}}return await t.json()}function B(t,e){return fetch(`${f}/test/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",...y()},body:JSON.stringify({...e,gradingScheme:JSON.stringify(e.gradingScheme)})})}function S(t){return fetch(`${f}/test/${t}`,{headers:y(),method:"DELETE"})}async function $(){let t=await fetch(`${f}/tags`);if(!t.ok)throw new Error("can't retireve tags");return await t.json()}async function L(t){let e=await b();for(let n of e)if(n.id===t)return n;throw new Error("No test with id "+t+" found")}var k=document.getElementById("test-details"),M=document.getElementById("save-test-details"),z=document.getElementById("open-test-editor"),H=document.getElementById("close-test-details"),R=document.getElementById("delete-test"),F=document.getElementById("open-test-player"),I=document.getElementById("title"),P=document.getElementById("description"),D=document.getElementById("attributes");function W(t){I.value=t.name,P.value=t.description,D.value=t.tags}var m;async function C(t){let e=await L(t);W(e),m=t,k.showModal()}H.addEventListener("click",()=>{k.close()});M.addEventListener("click",async()=>{if(m!==void 0){let t={name:I.value,description:P.value,tags:D.value};await B(m,t),J(m,t),k.close()}});z.addEventListener("click",()=>{window.location.href=`/editor/?id=${m}`});R.addEventListener("click",async()=>{m!==void 0&&await S(m)});F.addEventListener("click",()=>{window.location.href=`/player/?id=${m}`});var O=class extends HTMLElement{#e={};addEntryButton;constructor(){super(),this.addEntryButton=document.createElement("button")}set options(e){this.#e=e,this.#t()}get value(){let e={},n=this.childNodes;for(let o=0;o<n.length-1;o++){let[r,i]=n[o].childNodes,[s,d]=[r.value,i.value];s&&d&&(e[s]===void 0?e[s]=[d]:e[s].push(d))}return e}set value(e){this.innerHTML="",this.appendChild(this.addEntryButton);let n=[];for(let r of Object.values(e).flat())n.push(this.#n());let o=0;this.#t();for(let[r,i]of Object.entries(e))for(let s of i){let[d,c]=n[o];d.value=r,this.#t(d),c.value=s,this.#t(c),o++}this.#t()}connectedCallback(){this.addEntryButton.innerText="+",this.addEntryButton.addEventListener("click",()=>{this.#n(),this.#t()}),this.appendChild(this.addEntryButton)}#n(){let e=new Option("","",!0);e.hidden=!0;let n=document.createElement("div"),o=document.createElement("select");o.appendChild(e.cloneNode());for(let s of Object.keys(this.#e))o.appendChild(new Option(s,s));o.addEventListener("change",()=>this.#t(o));let r=document.createElement("select");r.appendChild(e.cloneNode()),r.addEventListener("change",()=>this.#t(r));let i=document.createElement("button");return i.addEventListener("click",()=>{n.remove(),this.#t()}),i.innerText="-",n.append(o,r,i),this.insertBefore(n,this.addEntryButton),[o,r]}#o(e,n,o=!1){let r=Object.keys(n);if(o){e.innerHTML="",e.appendChild(new Option("","",!0)),e.firstChild.hidden=!0;for(let s of r)e.appendChild(new Option(s,s))}let i=e.firstChild?.nextSibling;for(let s=0;s<r.length;s++){if(s<r.length-1&&i===null)throw new Error("select element has too few options");i.disabled=!n[r[s]],i=i.nextSibling}}#t(e){let n=[],o={},r=this.childNodes;for(let i=0;i<r.length-1;i++){let s=r[i].childNodes[0],d=r[i].childNodes[1],[c,a]=[s.value,d.value];c!==void 0&&a!==void 0&&(o[c]===void 0&&(o[c]={}),o[c][a]=n.length,n.push([c,a,i]))}for(let i=0;i<n.length;i++){let[s,d,c]=n[i],a=r[c].childNodes[0],u=r[c].childNodes[1];delete o[s][d];let l={},h=[];for(let p of Object.keys(this.#e)){l[p]={};let j=!1;for(let T of this.#e[p])l[p][T]=o[p]===void 0||o[p][T]===void 0,j||=l[p][T];j&&h.push(p)}o[s][d]=i;let w={};for(let p of Object.keys(this.#e))w[p]=h.includes(p);this.#o(a,w);let E=e!==void 0&&a===e&&this.#e[s]!==void 0;this.#o(u,l[s]??{},E)}}};customElements.define("attribute-selector",O);var v=document.getElementById("list"),A=document.getElementById("attributes");v.addEventListener("click",t=>{if(t.target.classList.contains("open")){let e=t.target.parentElement.parentElement.dataset.id;C(e)}});var _=document.getElementById("new-test");_.addEventListener("click",async()=>{try{let t=await N();await C(t)}catch(t){t instanceof g?alert("\u10D0\u10EE\u10D0\u10DA\u10D8 \u10E2\u10D4\u10E1\u10E2\u10D8\u10E1 \u10E8\u10D4\u10E1\u10D0\u10E5\u10DB\u10DC\u10D4\u10DA\u10D0\u10D3 \u10E1\u10D0\u10ED\u10D8\u10E0\u10DD\u10D0 \u10D0\u10D5\u10D7\u10D4\u10DC\u10E2\u10D8\u10D9\u10D0\u10EA\u10D8\u10D0"):alert(t.message)}});function J(t,e){let n=x({id:t,...e});v.insertBefore(n,v.firstChild)}async function G(){let t=await b();for(let e of t){let n=x(e);v.appendChild(n.cloneNode(!0))}try{A.options=await $()}catch{A.options={\u10E1\u10D0\u10E4\u10D4\u10EE\u10E3\u10E0\u10D8:["\u10D3\u10D0\u10EC\u10E7\u10D4\u10D1\u10D8\u10D7\u10D8","\u10E1\u10D0\u10D1\u10D0\u10D6\u10D8\u10E1\u10DD","\u10E1\u10D0\u10E8\u10E3\u10D0\u10DA\u10DD"],\u10D9\u10D5\u10DA\u10D4\u10D5\u10D0:["PISA","TIMSS","PIRLS"],\u10E1\u10D0\u10D2\u10D0\u10DC\u10D8:["\u10DB\u10D0\u10D7\u10D4\u10DB\u10D0\u10E2\u10D8\u10D9\u10D0","\u10E4\u10D8\u10D6\u10D8\u10D9\u10D0","\u10D9\u10D8\u10D7\u10EE\u10D5\u10D0","\u10D1\u10E3\u10DC\u10D4\u10D1\u10D8\u10E1\u10DB\u10D4\u10E2\u10E7\u10D5\u10D4\u10DA\u10D4\u10D1\u10D0"],\u10D9\u10DA\u10D0\u10E1\u10D8:["1","2"],\u10D4\u10DC\u10D0:["\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8"],\u10EE\u10D8\u10DA\u10D5\u10D0\u10D3\u10DD\u10D1\u10D0:["\u10E1\u10D0\u10EF\u10D0\u10E0\u10DD","\u10E8\u10D4\u10D6\u10E6\u10E3\u10D3\u10E3\u10DA\u10D8","\u10D3\u10D0\u10DB\u10D0\u10DA\u10E3\u10DA\u10D8"]}}}G();export{J as addTest};
