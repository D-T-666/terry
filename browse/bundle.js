function $(s,e){return s<e?s:e}function T({id:s,name:e,description:r,tags:t}){let n=document.createElement("details");n.setAttribute("name","test"),n.dataset.id=s;let o=document.createElement("summary"),i=document.createElement("span");i.className="title",i.textContent=e,o.appendChild(i);let d=[];for(let a of Object.keys(t))d.push(...t[a]);if(d.length>0){let a=document.createElement("ul");a.className="tags";for(let u=0;u<$(d.length,5);u++){let c=document.createElement("li");c.setAttribute("t",d[u]),a.appendChild(c)}o.appendChild(a)}let l=document.createElement("button");if(l.classList.add("open"),l.textContent="\u10D2\u10D0\u10EE\u10E1\u10DC\u10D0",o.appendChild(l),n.appendChild(o),r){let a=document.createElement("div");a.className="description",a.textContent=r,n.appendChild(a)}if(d.length>0){let a=document.createElement("ul");a.className="attributes";for(let u of Object.keys(t)){let c=document.createElement("li");if(c.appendChild(document.createTextNode(u+":")),t[u]&&t[u].length>0){let m=document.createElement("ul");m.className="tags",t[u].forEach(g=>{let f=document.createElement("li");f.setAttribute("t",g),m.appendChild(f)}),c.appendChild(m)}a.appendChild(c)}n.appendChild(a)}return n}var A={Authorization:"Bearer "+(localStorage.getItem("authToken")??"")};function y(){return A}var b="https://eko.dimitri.ge/api";async function h(){let s=await fetch(`${b}/test/list`,{headers:y()});return s.ok?(await s.json()).tests:(console.log(s.statusText),[])}function C(){return fetch(`${b}/test`,{method:"POST",headers:y()})}function B(s,e){return fetch(`${b}/test/${s}`,{method:"PUT",headers:{"Content-Type":"application/json",...y()},body:JSON.stringify(e)})}var v=null;async function O(s){v===null&&(v=await h()),console.log(v);for(let e of v)if(e.id===s)return e}var N=document.getElementById("test-details"),M=document.getElementById("save-test-details"),U=document.getElementById("open-test-editor"),z=document.getElementById("close-test-details"),j=document.getElementById("title"),L=document.getElementById("description"),I=document.getElementById("attributes");function H(s){j.value=s.name,L.value=s.description,I.value=s.tags}var E;async function S(s){console.log(s),H(await O(s)),E=s,N.showModal()}z.addEventListener("click",()=>{N.close()});M.addEventListener("click",()=>{E!==void 0&&B(E,{name:j.value,description:L.value,tags:I.value})});U.addEventListener("click",()=>{window.location.href=`/editor/?id=${E}`});var x=class extends HTMLElement{#t={};addEntryButton;constructor(){super(),this.addEntryButton=document.createElement("button")}set options(e){this.#t=e,this.#e()}get value(){let e={},r=this.childNodes;for(let t=0;t<r.length-1;t++){let[n,o]=r[t].childNodes,[i,d]=[n.value,o.value];i&&d&&(e[i]===void 0?e[i]=[d]:e[i].push(d))}return e}set value(e){this.innerHTML="",this.appendChild(this.addEntryButton);let r=[];for(let n of Object.values(e).flat())r.push(this.#n());let t=0;this.#e();for(let[n,o]of Object.entries(e))for(let i of o){let[d,l]=r[t];d.value=n,this.#e(d),l.value=i,this.#e(l),t++}this.#e()}connectedCallback(){this.addEntryButton.innerText="+",this.addEntryButton.addEventListener("click",()=>{this.#n(),this.#e()}),this.appendChild(this.addEntryButton)}#n(){let e=new Option("","",!0);e.hidden=!0;let r=document.createElement("div"),t=document.createElement("select");t.appendChild(e.cloneNode());for(let i of Object.keys(this.#t))t.appendChild(new Option(i,i));t.addEventListener("change",()=>this.#e(t));let n=document.createElement("select");n.appendChild(e.cloneNode()),n.addEventListener("change",()=>this.#e(n));let o=document.createElement("button");return o.addEventListener("click",()=>{r.remove(),this.#e()}),o.innerText="-",r.append(t,n,o),this.insertBefore(r,this.addEntryButton),[t,n]}#o(e,r,t=!1){let n=Object.keys(r);if(t){e.innerHTML="",e.appendChild(new Option("","",!0)),e.firstChild.hidden=!0;for(let i of n)e.appendChild(new Option(i,i))}let o=e.firstChild?.nextSibling;for(let i=0;i<n.length;i++){if(i<n.length-1&&o===null)throw new Error("select element has too few options");o.disabled=!r[n[i]],o=o.nextSibling}}#e(e){let r=[],t={},n=this.childNodes;for(let o=0;o<n.length-1;o++){let i=n[o].childNodes[0],d=n[o].childNodes[1],[l,a]=[i.value,d.value];l!==void 0&&a!==void 0&&(t[l]===void 0&&(t[l]={}),t[l][a]=r.length,r.push([l,a,o]))}for(let o=0;o<r.length;o++){let[i,d,l]=r[o],a=n[l].childNodes[0],u=n[l].childNodes[1];delete t[i][d];let c={},m=[];for(let p of Object.keys(this.#t)){c[p]={};let w=!1;for(let k of this.#t[p])c[p][k]=t[p]===void 0||t[p][k]===void 0,w||=c[p][k];w&&m.push(p)}t[i][d]=o;let g={};for(let p of Object.keys(this.#t))g[p]=m.includes(p);this.#o(a,g);let f=e!==void 0&&a===e&&this.#t[i]!==void 0;this.#o(u,c[i]??{},f)}}};customElements.define("attribute-selector",x);var P=document.getElementById("list"),D=document.getElementById("attributes");P.addEventListener("click",s=>{if(s.target.classList.contains("open")){let e=s.target.parentElement.parentElement.dataset.id;console.log(e),S(e)}});var J=document.getElementById("new-test");J.addEventListener("click",async()=>{(await C()).ok||console.error("Unauthorized request to create a test")});async function R(){let s=await h();for(let e of s){let r=T(e);P.appendChild(r.cloneNode(!0))}D.options={\u10E1\u10D0\u10E4\u10D4\u10EE\u10E3\u10E0\u10D8:["\u10D3\u10D0\u10EC\u10E7\u10D4\u10D1\u10D8\u10D7\u10D8","\u10E1\u10D0\u10D1\u10D0\u10D6\u10D8\u10E1\u10DD","\u10E1\u10D0\u10E8\u10E3\u10D0\u10DA\u10DD"],\u10D9\u10D5\u10DA\u10D4\u10D5\u10D0:["PISA","TIMSS","PIRLS"],\u10E1\u10D0\u10D2\u10D0\u10DC\u10D8:["\u10DB\u10D0\u10D7\u10D4\u10DB\u10D0\u10E2\u10D8\u10D9\u10D0","\u10E4\u10D8\u10D6\u10D8\u10D9\u10D0","\u10D9\u10D8\u10D7\u10EE\u10D5\u10D0","\u10D1\u10E3\u10DC\u10D4\u10D1\u10D8\u10E1\u10DB\u10D4\u10E2\u10E7\u10D5\u10D4\u10DA\u10D4\u10D1\u10D0"],\u10D9\u10DA\u10D0\u10E1\u10D8:["1","2"],\u10D4\u10DC\u10D0:["\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8"],\u10EE\u10D8\u10DA\u10D5\u10D0\u10D3\u10DD\u10D1\u10D0:["\u10E1\u10D0\u10EF\u10D0\u10E0\u10DD","\u10E8\u10D4\u10D6\u10E6\u10E3\u10D3\u10E3\u10DA\u10D8","\u10D3\u10D0\u10DB\u10D0\u10DA\u10E3\u10DA\u10D8"]}}R();
