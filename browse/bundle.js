function A(t,e){return t<e?t:e}function x({id:t,name:e,description:r,tags:n}){let o=document.createElement("details");o.setAttribute("name","test"),o.dataset.id=t;let i=document.createElement("summary"),s=document.createElement("span");s.className="title",s.textContent=e,i.appendChild(s);let d=[];for(let a of Object.keys(n))d.push(...n[a]);if(d.length>0){let a=document.createElement("ul");a.className="tags";for(let u=0;u<A(d.length,5);u++){let l=document.createElement("li");l.setAttribute("t",d[u]),a.appendChild(l)}i.appendChild(a)}let c=document.createElement("button");if(c.classList.add("open"),c.textContent="\u10D2\u10D0\u10EE\u10E1\u10DC\u10D0",i.appendChild(c),o.appendChild(i),r){let a=document.createElement("div");a.className="description",a.textContent=r,o.appendChild(a)}if(d.length>0){let a=document.createElement("ul");a.className="attributes";for(let u of Object.keys(n)){let l=document.createElement("li");if(l.appendChild(document.createTextNode(u+":")),n[u]&&n[u].length>0){let g=document.createElement("ul");g.className="tags",n[u].forEach(b=>{let E=document.createElement("li");E.setAttribute("t",b),g.appendChild(E)}),l.appendChild(g)}a.appendChild(l)}o.appendChild(a)}return o}var D={Authorization:"Bearer "+(localStorage.getItem("authToken")??"")};function h(){return D}var f="https://terryapi.dimitri.ge/api";async function y(){let t=await fetch(`${f}/test/list`,{headers:h()});return t.ok?(await t.json()).tests:(console.log(t.statusText),[])}function O(){return fetch(`${f}/test`,{method:"POST",headers:h()})}function L(t,e){return console.log("trying to upload",e,"for test",t),fetch(`${f}/test/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",...h()},body:JSON.stringify({...e,gradingScheme:JSON.stringify(e.gradingScheme)})})}function N(t){return fetch(`${f}/test/${t}`,{headers:h(),method:"DELETE"})}async function I(t){let e=await y();console.log(e);for(let r of e)if(r.id===t)return r;throw new Error("No test with id "+t+" found")}var k=document.getElementById("test-details"),U=document.getElementById("save-test-details"),M=document.getElementById("open-test-editor"),z=document.getElementById("close-test-details"),H=document.getElementById("delete-test"),J=document.getElementById("open-test-player"),j=document.getElementById("title"),S=document.getElementById("description"),P=document.getElementById("attributes");function R(t){j.value=t.name,S.value=t.description,P.value=t.tags}var m;async function T(t){console.log(t);let e=await I(t);console.log(e),R(e),m=t,k.showModal()}z.addEventListener("click",()=>{k.close()});U.addEventListener("click",async()=>{if(m!==void 0){let t={name:j.value,description:S.value,tags:P.value};await L(m,t),$(m,t),k.close()}});M.addEventListener("click",()=>{window.location.href=`/editor/?id=${m}`});H.addEventListener("click",async()=>{m!==void 0&&await N(m)});J.addEventListener("click",()=>{window.location.href=`/player/?id=${m}`});var C=class extends HTMLElement{#t={};addEntryButton;constructor(){super(),this.addEntryButton=document.createElement("button")}set options(e){this.#t=e,this.#e()}get value(){let e={},r=this.childNodes;for(let n=0;n<r.length-1;n++){let[o,i]=r[n].childNodes,[s,d]=[o.value,i.value];s&&d&&(e[s]===void 0?e[s]=[d]:e[s].push(d))}return e}set value(e){this.innerHTML="",this.appendChild(this.addEntryButton);let r=[];for(let o of Object.values(e).flat())r.push(this.#n());let n=0;this.#e();for(let[o,i]of Object.entries(e))for(let s of i){let[d,c]=r[n];d.value=o,this.#e(d),c.value=s,this.#e(c),n++}this.#e()}connectedCallback(){this.addEntryButton.innerText="+",this.addEntryButton.addEventListener("click",()=>{this.#n(),this.#e()}),this.appendChild(this.addEntryButton)}#n(){let e=new Option("","",!0);e.hidden=!0;let r=document.createElement("div"),n=document.createElement("select");n.appendChild(e.cloneNode());for(let s of Object.keys(this.#t))n.appendChild(new Option(s,s));n.addEventListener("change",()=>this.#e(n));let o=document.createElement("select");o.appendChild(e.cloneNode()),o.addEventListener("change",()=>this.#e(o));let i=document.createElement("button");return i.addEventListener("click",()=>{r.remove(),this.#e()}),i.innerText="-",r.append(n,o,i),this.insertBefore(r,this.addEntryButton),[n,o]}#o(e,r,n=!1){let o=Object.keys(r);if(n){e.innerHTML="",e.appendChild(new Option("","",!0)),e.firstChild.hidden=!0;for(let s of o)e.appendChild(new Option(s,s))}let i=e.firstChild?.nextSibling;for(let s=0;s<o.length;s++){if(s<o.length-1&&i===null)throw new Error("select element has too few options");i.disabled=!r[o[s]],i=i.nextSibling}}#e(e){let r=[],n={},o=this.childNodes;for(let i=0;i<o.length-1;i++){let s=o[i].childNodes[0],d=o[i].childNodes[1],[c,a]=[s.value,d.value];c!==void 0&&a!==void 0&&(n[c]===void 0&&(n[c]={}),n[c][a]=r.length,r.push([c,a,i]))}for(let i=0;i<r.length;i++){let[s,d,c]=r[i],a=o[c].childNodes[0],u=o[c].childNodes[1];delete n[s][d];let l={},g=[];for(let p of Object.keys(this.#t)){l[p]={};let B=!1;for(let w of this.#t[p])l[p][w]=n[p]===void 0||n[p][w]===void 0,B||=l[p][w];B&&g.push(p)}n[s][d]=i;let b={};for(let p of Object.keys(this.#t))b[p]=g.includes(p);this.#o(a,b);let E=e!==void 0&&a===e&&this.#t[s]!==void 0;this.#o(u,l[s]??{},E)}}};customElements.define("attribute-selector",C);var v=document.getElementById("list"),F=document.getElementById("attributes");v.addEventListener("click",t=>{if(t.target.classList.contains("open")){let e=t.target.parentElement.parentElement.dataset.id;console.log(e),T(e)}});var W=document.getElementById("new-test");W.addEventListener("click",async()=>{let t=await O();if(!t.ok){console.error("Unauthorized request to create a test");return}let e=await t.json();await T(e)});function $(t,e){console.log(t,e);let r=x({id:t,...e});v.insertBefore(r,v.firstChild)}async function _(){let t=await y();for(let e of t){let r=x(e);v.appendChild(r.cloneNode(!0))}F.options={\u10E1\u10D0\u10E4\u10D4\u10EE\u10E3\u10E0\u10D8:["\u10D3\u10D0\u10EC\u10E7\u10D4\u10D1\u10D8\u10D7\u10D8","\u10E1\u10D0\u10D1\u10D0\u10D6\u10D8\u10E1\u10DD","\u10E1\u10D0\u10E8\u10E3\u10D0\u10DA\u10DD"],\u10D9\u10D5\u10DA\u10D4\u10D5\u10D0:["PISA","TIMSS","PIRLS"],\u10E1\u10D0\u10D2\u10D0\u10DC\u10D8:["\u10DB\u10D0\u10D7\u10D4\u10DB\u10D0\u10E2\u10D8\u10D9\u10D0","\u10E4\u10D8\u10D6\u10D8\u10D9\u10D0","\u10D9\u10D8\u10D7\u10EE\u10D5\u10D0","\u10D1\u10E3\u10DC\u10D4\u10D1\u10D8\u10E1\u10DB\u10D4\u10E2\u10E7\u10D5\u10D4\u10DA\u10D4\u10D1\u10D0"],\u10D9\u10DA\u10D0\u10E1\u10D8:["1","2"],\u10D4\u10DC\u10D0:["\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8"],\u10EE\u10D8\u10DA\u10D5\u10D0\u10D3\u10DD\u10D1\u10D0:["\u10E1\u10D0\u10EF\u10D0\u10E0\u10DD","\u10E8\u10D4\u10D6\u10E6\u10E3\u10D3\u10E3\u10DA\u10D8","\u10D3\u10D0\u10DB\u10D0\u10DA\u10E3\u10DA\u10D8"]}}_();export{$ as addTest};
