function U(e,t){return e<t?e:t}function x({id:e,name:t,description:n,tags:o}){let s=document.createElement("details");s.setAttribute("name","test"),s.dataset.id=e;let r=document.createElement("summary"),i=document.createElement("span");i.className="title",i.textContent=t,r.appendChild(i);let d=[];for(let a of Object.keys(o))d.push(...o[a]);if(d.length>0){let a=document.createElement("ul");a.className="tags";for(let u=0;u<U(d.length,5);u++){let l=document.createElement("li");l.setAttribute("t",d[u]),a.appendChild(l)}r.appendChild(a)}let c=document.createElement("button");if(c.classList.add("open"),c.textContent="\u10D2\u10D0\u10EE\u10E1\u10DC\u10D0",r.appendChild(c),s.appendChild(r),n){let a=document.createElement("div");a.className="description",a.textContent=n,s.appendChild(a)}if(d.length>0){let a=document.createElement("ul");a.className="attributes";for(let u of Object.keys(o)){let l=document.createElement("li");if(l.appendChild(document.createTextNode(u+":")),o[u]&&o[u].length>0){let h=document.createElement("ul");h.className="tags",o[u].forEach(w=>{let E=document.createElement("li");E.setAttribute("t",w),h.appendChild(E)}),l.appendChild(h)}a.appendChild(l)}s.appendChild(a)}return s}function y(){let e=localStorage.getItem("authToken");return e?{Authorization:`Bearer ${e}`}:{}}var g=class extends Error{};var f="https://terryapi.dimitri.ge/api";async function b(){let e=await fetch(`${f}/test/list`,{headers:y()});if(!e.ok){if(e.status===401)throw new g;{let n=JSON.stringify(await e.json());throw new Error(n)}}return(await e.json()).tests}async function N(){let e=await fetch(`${f}/test`,{method:"POST",headers:y()});if(!e.ok){if(e.status===401)throw new g;{let n=JSON.stringify(await e.json());throw new Error(n)}}let t=await e.json();return console.log(t),t}function j(e,t){return console.log("trying to upload",t,"for test",e),fetch(`${f}/test/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",...y()},body:JSON.stringify({...t,gradingScheme:JSON.stringify(t.gradingScheme)})})}function S(e){return fetch(`${f}/test/${e}`,{headers:y(),method:"DELETE"})}async function $(){let e=await fetch(`${f}/tags`);if(!e.ok)throw new Error("can't retireve tags");return await e.json()}async function L(e){let t=await b();console.log(t);for(let n of t)if(n.id===e)return n;throw new Error("No test with id "+e+" found")}var k=document.getElementById("test-details"),M=document.getElementById("save-test-details"),z=document.getElementById("open-test-editor"),H=document.getElementById("close-test-details"),R=document.getElementById("delete-test"),F=document.getElementById("open-test-player"),I=document.getElementById("title"),P=document.getElementById("description"),D=document.getElementById("attributes");function W(e){I.value=e.name,P.value=e.description,D.value=e.tags}var m;async function C(e){console.log(e);let t=await L(e);console.log(t),W(t),m=e,k.showModal()}H.addEventListener("click",()=>{k.close()});M.addEventListener("click",async()=>{if(m!==void 0){let e={name:I.value,description:P.value,tags:D.value};await j(m,e),A(m,e),k.close()}});z.addEventListener("click",()=>{window.location.href=`/editor/?id=${m}`});R.addEventListener("click",async()=>{m!==void 0&&await S(m)});F.addEventListener("click",()=>{window.location.href=`/player/?id=${m}`});var O=class extends HTMLElement{#t={};addEntryButton;constructor(){super(),this.addEntryButton=document.createElement("button")}set options(t){this.#t=t,this.#e()}get value(){let t={},n=this.childNodes;for(let o=0;o<n.length-1;o++){let[s,r]=n[o].childNodes,[i,d]=[s.value,r.value];i&&d&&(t[i]===void 0?t[i]=[d]:t[i].push(d))}return t}set value(t){this.innerHTML="",this.appendChild(this.addEntryButton);let n=[];for(let s of Object.values(t).flat())n.push(this.#n());let o=0;this.#e();for(let[s,r]of Object.entries(t))for(let i of r){let[d,c]=n[o];d.value=s,this.#e(d),c.value=i,this.#e(c),o++}this.#e()}connectedCallback(){this.addEntryButton.innerText="+",this.addEntryButton.addEventListener("click",()=>{this.#n(),this.#e()}),this.appendChild(this.addEntryButton)}#n(){let t=new Option("","",!0);t.hidden=!0;let n=document.createElement("div"),o=document.createElement("select");o.appendChild(t.cloneNode());for(let i of Object.keys(this.#t))o.appendChild(new Option(i,i));o.addEventListener("change",()=>this.#e(o));let s=document.createElement("select");s.appendChild(t.cloneNode()),s.addEventListener("change",()=>this.#e(s));let r=document.createElement("button");return r.addEventListener("click",()=>{n.remove(),this.#e()}),r.innerText="-",n.append(o,s,r),this.insertBefore(n,this.addEntryButton),[o,s]}#o(t,n,o=!1){let s=Object.keys(n);if(o){t.innerHTML="",t.appendChild(new Option("","",!0)),t.firstChild.hidden=!0;for(let i of s)t.appendChild(new Option(i,i))}let r=t.firstChild?.nextSibling;for(let i=0;i<s.length;i++){if(i<s.length-1&&r===null)throw new Error("select element has too few options");r.disabled=!n[s[i]],r=r.nextSibling}}#e(t){let n=[],o={},s=this.childNodes;for(let r=0;r<s.length-1;r++){let i=s[r].childNodes[0],d=s[r].childNodes[1],[c,a]=[i.value,d.value];c!==void 0&&a!==void 0&&(o[c]===void 0&&(o[c]={}),o[c][a]=n.length,n.push([c,a,r]))}for(let r=0;r<n.length;r++){let[i,d,c]=n[r],a=s[c].childNodes[0],u=s[c].childNodes[1];delete o[i][d];let l={},h=[];for(let p of Object.keys(this.#t)){l[p]={};let B=!1;for(let T of this.#t[p])l[p][T]=o[p]===void 0||o[p][T]===void 0,B||=l[p][T];B&&h.push(p)}o[i][d]=r;let w={};for(let p of Object.keys(this.#t))w[p]=h.includes(p);this.#o(a,w);let E=t!==void 0&&a===t&&this.#t[i]!==void 0;this.#o(u,l[i]??{},E)}}};customElements.define("attribute-selector",O);var v=document.getElementById("list"),J=document.getElementById("attributes");v.addEventListener("click",e=>{if(e.target.classList.contains("open")){let t=e.target.parentElement.parentElement.dataset.id;console.log(t),C(t)}});var _=document.getElementById("new-test");_.addEventListener("click",async()=>{try{let e=await N();await C(e)}catch(e){console.log(e),e instanceof g?alert("\u10D0\u10EE\u10D0\u10DA\u10D8 \u10E2\u10D4\u10E1\u10E2\u10D8\u10E1 \u10E8\u10D4\u10E1\u10D0\u10E5\u10DB\u10DC\u10D4\u10DA\u10D0\u10D3 \u10E1\u10D0\u10ED\u10D8\u10E0\u10DD\u10D0 \u10D0\u10D5\u10D7\u10D4\u10DC\u10E2\u10D8\u10D9\u10D0\u10EA\u10D8\u10D0"):alert(e.message)}});function A(e,t){console.log(e,t);let n=x({id:e,...t});v.insertBefore(n,v.firstChild)}async function G(){let e=await b();for(let t of e){let n=x(t);v.appendChild(n.cloneNode(!0))}try{J.options=await $()}catch{J.options={\u10E1\u10D0\u10E4\u10D4\u10EE\u10E3\u10E0\u10D8:["\u10D3\u10D0\u10EC\u10E7\u10D4\u10D1\u10D8\u10D7\u10D8","\u10E1\u10D0\u10D1\u10D0\u10D6\u10D8\u10E1\u10DD","\u10E1\u10D0\u10E8\u10E3\u10D0\u10DA\u10DD"],\u10D9\u10D5\u10DA\u10D4\u10D5\u10D0:["PISA","TIMSS","PIRLS"],\u10E1\u10D0\u10D2\u10D0\u10DC\u10D8:["\u10DB\u10D0\u10D7\u10D4\u10DB\u10D0\u10E2\u10D8\u10D9\u10D0","\u10E4\u10D8\u10D6\u10D8\u10D9\u10D0","\u10D9\u10D8\u10D7\u10EE\u10D5\u10D0","\u10D1\u10E3\u10DC\u10D4\u10D1\u10D8\u10E1\u10DB\u10D4\u10E2\u10E7\u10D5\u10D4\u10DA\u10D4\u10D1\u10D0"],\u10D9\u10DA\u10D0\u10E1\u10D8:["1","2"],\u10D4\u10DC\u10D0:["\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8"],\u10EE\u10D8\u10DA\u10D5\u10D0\u10D3\u10DD\u10D1\u10D0:["\u10E1\u10D0\u10EF\u10D0\u10E0\u10DD","\u10E8\u10D4\u10D6\u10E6\u10E3\u10D3\u10E3\u10DA\u10D8","\u10D3\u10D0\u10DB\u10D0\u10DA\u10E3\u10DA\u10D8"]}}}G();export{A as addTest};
//# sourceMappingURL=bundle.js.map
