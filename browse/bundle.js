function $(e,t){return e<t?e:t}function w({id:e,name:t,description:r,tags:n}){let o=document.createElement("details");o.setAttribute("name","test"),o.dataset.id=e;let s=document.createElement("summary"),i=document.createElement("span");i.className="title",i.textContent=t,s.appendChild(i);let d=[];for(let a of Object.keys(n))d.push(...n[a]);if(d.length>0){let a=document.createElement("ul");a.className="tags";for(let u=0;u<$(d.length,5);u++){let l=document.createElement("li");l.setAttribute("t",d[u]),a.appendChild(l)}s.appendChild(a)}let c=document.createElement("button");if(c.classList.add("open"),c.textContent="\u10D2\u10D0\u10EE\u10E1\u10DC\u10D0",s.appendChild(c),o.appendChild(s),r){let a=document.createElement("div");a.className="description",a.textContent=r,o.appendChild(a)}if(d.length>0){let a=document.createElement("ul");a.className="attributes";for(let u of Object.keys(n)){let l=document.createElement("li");if(l.appendChild(document.createTextNode(u+":")),n[u]&&n[u].length>0){let m=document.createElement("ul");m.className="tags",n[u].forEach(f=>{let y=document.createElement("li");y.setAttribute("t",f),m.appendChild(y)}),l.appendChild(m)}a.appendChild(l)}o.appendChild(a)}return o}var A={Authorization:"Bearer "+(localStorage.getItem("authToken")??"")};function b(){return A}var v="https://eko.dimitri.ge/api";async function g(){let e=await fetch(`${v}/test/list`,{headers:b()});return e.ok?(await e.json()).tests:(console.log(e.statusText),[])}function B(){return fetch(`${v}/test`,{method:"POST",headers:b()})}function N(e,t){return console.log("trying to upload",t,"for test",e),fetch(`${v}/test/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",...b()},body:JSON.stringify({...t,gradingScheme:JSON.stringify(t.gradingScheme)})})}async function j(e){let t=await g();console.log(t);for(let r of t)if(r.id===e)return r;throw new Error("No test with id "+e+" found")}var x=document.getElementById("test-details"),M=document.getElementById("save-test-details"),U=document.getElementById("open-test-editor"),z=document.getElementById("close-test-details"),S=document.getElementById("title"),L=document.getElementById("description"),I=document.getElementById("attributes");function H(e){S.value=e.name,L.value=e.description,I.value=e.tags}var h;async function T(e){console.log(e);let t=await j(e);console.log(t),H(t),h=e,x.showModal()}z.addEventListener("click",()=>{x.close()});M.addEventListener("click",async()=>{if(h!==void 0){let e={name:S.value,description:L.value,tags:I.value};await N(h,e),P(h,e),x.close()}});U.addEventListener("click",()=>{window.location.href=`/editor/?id=${h}`});var C=class extends HTMLElement{#e={};addEntryButton;constructor(){super(),this.addEntryButton=document.createElement("button")}set options(t){this.#e=t,this.#t()}get value(){let t={},r=this.childNodes;for(let n=0;n<r.length-1;n++){let[o,s]=r[n].childNodes,[i,d]=[o.value,s.value];i&&d&&(t[i]===void 0?t[i]=[d]:t[i].push(d))}return t}set value(t){this.innerHTML="",this.appendChild(this.addEntryButton);let r=[];for(let o of Object.values(t).flat())r.push(this.#n());let n=0;this.#t();for(let[o,s]of Object.entries(t))for(let i of s){let[d,c]=r[n];d.value=o,this.#t(d),c.value=i,this.#t(c),n++}this.#t()}connectedCallback(){this.addEntryButton.innerText="+",this.addEntryButton.addEventListener("click",()=>{this.#n(),this.#t()}),this.appendChild(this.addEntryButton)}#n(){let t=new Option("","",!0);t.hidden=!0;let r=document.createElement("div"),n=document.createElement("select");n.appendChild(t.cloneNode());for(let i of Object.keys(this.#e))n.appendChild(new Option(i,i));n.addEventListener("change",()=>this.#t(n));let o=document.createElement("select");o.appendChild(t.cloneNode()),o.addEventListener("change",()=>this.#t(o));let s=document.createElement("button");return s.addEventListener("click",()=>{r.remove(),this.#t()}),s.innerText="-",r.append(n,o,s),this.insertBefore(r,this.addEntryButton),[n,o]}#o(t,r,n=!1){let o=Object.keys(r);if(n){t.innerHTML="",t.appendChild(new Option("","",!0)),t.firstChild.hidden=!0;for(let i of o)t.appendChild(new Option(i,i))}let s=t.firstChild?.nextSibling;for(let i=0;i<o.length;i++){if(i<o.length-1&&s===null)throw new Error("select element has too few options");s.disabled=!r[o[i]],s=s.nextSibling}}#t(t){let r=[],n={},o=this.childNodes;for(let s=0;s<o.length-1;s++){let i=o[s].childNodes[0],d=o[s].childNodes[1],[c,a]=[i.value,d.value];c!==void 0&&a!==void 0&&(n[c]===void 0&&(n[c]={}),n[c][a]=r.length,r.push([c,a,s]))}for(let s=0;s<r.length;s++){let[i,d,c]=r[s],a=o[c].childNodes[0],u=o[c].childNodes[1];delete n[i][d];let l={},m=[];for(let p of Object.keys(this.#e)){l[p]={};let O=!1;for(let k of this.#e[p])l[p][k]=n[p]===void 0||n[p][k]===void 0,O||=l[p][k];O&&m.push(p)}n[i][d]=s;let f={};for(let p of Object.keys(this.#e))f[p]=m.includes(p);this.#o(a,f);let y=t!==void 0&&a===t&&this.#e[i]!==void 0;this.#o(u,l[i]??{},y)}}};customElements.define("attribute-selector",C);var E=document.getElementById("list"),D=document.getElementById("attributes");E.addEventListener("click",e=>{if(e.target.classList.contains("open")){let t=e.target.parentElement.parentElement.dataset.id;console.log(t),T(t)}});var J=document.getElementById("new-test");J.addEventListener("click",async()=>{let e=await B();if(!e.ok){console.error("Unauthorized request to create a test");return}let t=await e.json();await T(t)});function P(e,t){console.log(e,t);let r=w({id:e,...t});E.insertBefore(r,E.firstChild)}async function R(){let e=await g();for(let t of e){let r=w(t);E.appendChild(r.cloneNode(!0))}D.options={\u10E1\u10D0\u10E4\u10D4\u10EE\u10E3\u10E0\u10D8:["\u10D3\u10D0\u10EC\u10E7\u10D4\u10D1\u10D8\u10D7\u10D8","\u10E1\u10D0\u10D1\u10D0\u10D6\u10D8\u10E1\u10DD","\u10E1\u10D0\u10E8\u10E3\u10D0\u10DA\u10DD"],\u10D9\u10D5\u10DA\u10D4\u10D5\u10D0:["PISA","TIMSS","PIRLS"],\u10E1\u10D0\u10D2\u10D0\u10DC\u10D8:["\u10DB\u10D0\u10D7\u10D4\u10DB\u10D0\u10E2\u10D8\u10D9\u10D0","\u10E4\u10D8\u10D6\u10D8\u10D9\u10D0","\u10D9\u10D8\u10D7\u10EE\u10D5\u10D0","\u10D1\u10E3\u10DC\u10D4\u10D1\u10D8\u10E1\u10DB\u10D4\u10E2\u10E7\u10D5\u10D4\u10DA\u10D4\u10D1\u10D0"],\u10D9\u10DA\u10D0\u10E1\u10D8:["1","2"],\u10D4\u10DC\u10D0:["\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8"],\u10EE\u10D8\u10DA\u10D5\u10D0\u10D3\u10DD\u10D1\u10D0:["\u10E1\u10D0\u10EF\u10D0\u10E0\u10DD","\u10E8\u10D4\u10D6\u10E6\u10E3\u10D3\u10E3\u10DA\u10D8","\u10D3\u10D0\u10DB\u10D0\u10DA\u10E3\u10DA\u10D8"]}}R();export{P as addTest};
