function D(t,e){return t<e?t:e}function w({id:t,name:e,description:s,tags:n}){let o=document.createElement("details");o.setAttribute("name","test"),o.dataset.id=t;let r=document.createElement("summary"),i=document.createElement("span");i.className="title",i.textContent=e,r.appendChild(i);let d=[];for(let a of Object.keys(n))d.push(...n[a]);if(d.length>0){let a=document.createElement("ul");a.className="tags";for(let u=0;u<D(d.length,5);u++){let l=document.createElement("li");l.setAttribute("t",d[u]),a.appendChild(l)}r.appendChild(a)}let c=document.createElement("button");if(c.classList.add("open"),c.textContent="\u10D2\u10D0\u10EE\u10E1\u10DC\u10D0",r.appendChild(c),o.appendChild(r),s){let a=document.createElement("div");a.className="description",a.textContent=s,o.appendChild(a)}if(d.length>0){let a=document.createElement("ul");a.className="attributes";for(let u of Object.keys(n)){let l=document.createElement("li");if(l.appendChild(document.createTextNode(u+":")),n[u]&&n[u].length>0){let g=document.createElement("ul");g.className="tags",n[u].forEach(b=>{let E=document.createElement("li");E.setAttribute("t",b),g.appendChild(E)}),l.appendChild(g)}a.appendChild(l)}o.appendChild(a)}return o}var A={Authorization:"Bearer "+(localStorage.getItem("authToken")??"")};function h(){return A}var f="https://terryapi.dimitri.ge/api";async function y(){let t=await fetch(`${f}/test/list`,{headers:h()});return t.ok?(await t.json()).tests:(console.log(t.statusText),[])}function B(){return fetch(`${f}/test`,{method:"POST",headers:h()})}function L(t,e){return console.log("trying to upload",e,"for test",t),fetch(`${f}/test/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",...h()},body:JSON.stringify({...e,gradingScheme:JSON.stringify(e.gradingScheme)})})}function N(t){return fetch(`${f}/test/${t}`,{headers:h(),method:"DELETE"})}async function $(t){let e=await y();console.log(e);for(let s of e)if(s.id===t)return s;throw new Error("No test with id "+t+" found")}var x=document.getElementById("test-details"),U=document.getElementById("save-test-details"),M=document.getElementById("open-test-editor"),z=document.getElementById("close-test-details"),H=document.getElementById("delete-test"),J=document.getElementById("open-test-player"),S=document.getElementById("title"),j=document.getElementById("description"),I=document.getElementById("attributes");function R(t){S.value=t.name,j.value=t.description,I.value=t.tags}var m;async function k(t){console.log(t);let e=await $(t);console.log(e),R(e),m=t,x.showModal()}z.addEventListener("click",()=>{x.close()});U.addEventListener("click",async()=>{if(m!==void 0){let t={name:S.value,description:j.value,tags:I.value};await L(m,t),P(m,t),x.close()}});M.addEventListener("click",()=>{window.location.href=`/editor/?id=${m}`});H.addEventListener("click",async()=>{m!==void 0&&await N(m)});J.addEventListener("click",()=>{window.location.href=`/player/?id=${m}`});var C=class extends HTMLElement{#t={};addEntryButton;constructor(){super(),this.addEntryButton=document.createElement("button")}set options(e){this.#t=e,this.#e()}get value(){let e={},s=this.childNodes;for(let n=0;n<s.length-1;n++){let[o,r]=s[n].childNodes,[i,d]=[o.value,r.value];i&&d&&(e[i]===void 0?e[i]=[d]:e[i].push(d))}return e}set value(e){this.innerHTML="",this.appendChild(this.addEntryButton);let s=[];for(let o of Object.values(e).flat())s.push(this.#n());let n=0;this.#e();for(let[o,r]of Object.entries(e))for(let i of r){let[d,c]=s[n];d.value=o,this.#e(d),c.value=i,this.#e(c),n++}this.#e()}connectedCallback(){this.addEntryButton.innerText="+",this.addEntryButton.addEventListener("click",()=>{this.#n(),this.#e()}),this.appendChild(this.addEntryButton)}#n(){let e=new Option("","",!0);e.hidden=!0;let s=document.createElement("div"),n=document.createElement("select");n.appendChild(e.cloneNode());for(let i of Object.keys(this.#t))n.appendChild(new Option(i,i));n.addEventListener("change",()=>this.#e(n));let o=document.createElement("select");o.appendChild(e.cloneNode()),o.addEventListener("change",()=>this.#e(o));let r=document.createElement("button");return r.addEventListener("click",()=>{s.remove(),this.#e()}),r.innerText="-",s.append(n,o,r),this.insertBefore(s,this.addEntryButton),[n,o]}#o(e,s,n=!1){let o=Object.keys(s);if(n){e.innerHTML="",e.appendChild(new Option("","",!0)),e.firstChild.hidden=!0;for(let i of o)e.appendChild(new Option(i,i))}let r=e.firstChild?.nextSibling;for(let i=0;i<o.length;i++){if(i<o.length-1&&r===null)throw new Error("select element has too few options");r.disabled=!s[o[i]],r=r.nextSibling}}#e(e){let s=[],n={},o=this.childNodes;for(let r=0;r<o.length-1;r++){let i=o[r].childNodes[0],d=o[r].childNodes[1],[c,a]=[i.value,d.value];c!==void 0&&a!==void 0&&(n[c]===void 0&&(n[c]={}),n[c][a]=s.length,s.push([c,a,r]))}for(let r=0;r<s.length;r++){let[i,d,c]=s[r],a=o[c].childNodes[0],u=o[c].childNodes[1];delete n[i][d];let l={},g=[];for(let p of Object.keys(this.#t)){l[p]={};let O=!1;for(let v of this.#t[p])l[p][v]=n[p]===void 0||n[p][v]===void 0,O||=l[p][v];O&&g.push(p)}n[i][d]=r;let b={};for(let p of Object.keys(this.#t))b[p]=g.includes(p);this.#o(a,b);let E=e!==void 0&&a===e&&this.#t[i]!==void 0;this.#o(u,l[i]??{},E)}}};customElements.define("attribute-selector",C);var T=document.getElementById("list"),F=document.getElementById("attributes");T.addEventListener("click",t=>{if(t.target.classList.contains("open")){let e=t.target.parentElement.parentElement.dataset.id;console.log(e),k(e)}});var W=document.getElementById("new-test");W.addEventListener("click",async()=>{let t=await B();if(!t.ok){console.error("Unauthorized request to create a test");return}let e=await t.json();await k(e)});function P(t,e){console.log(t,e);let s=w({id:t,...e});T.insertBefore(s,T.firstChild)}async function _(){let t=await y();for(let e of t){let s=w(e);T.appendChild(s.cloneNode(!0))}F.options={\u10E1\u10D0\u10E4\u10D4\u10EE\u10E3\u10E0\u10D8:["\u10D3\u10D0\u10EC\u10E7\u10D4\u10D1\u10D8\u10D7\u10D8","\u10E1\u10D0\u10D1\u10D0\u10D6\u10D8\u10E1\u10DD","\u10E1\u10D0\u10E8\u10E3\u10D0\u10DA\u10DD"],\u10D9\u10D5\u10DA\u10D4\u10D5\u10D0:["PISA","TIMSS","PIRLS"],\u10E1\u10D0\u10D2\u10D0\u10DC\u10D8:["\u10DB\u10D0\u10D7\u10D4\u10DB\u10D0\u10E2\u10D8\u10D9\u10D0","\u10E4\u10D8\u10D6\u10D8\u10D9\u10D0","\u10D9\u10D8\u10D7\u10EE\u10D5\u10D0","\u10D1\u10E3\u10DC\u10D4\u10D1\u10D8\u10E1\u10DB\u10D4\u10E2\u10E7\u10D5\u10D4\u10DA\u10D4\u10D1\u10D0"],\u10D9\u10DA\u10D0\u10E1\u10D8:["1","2"],\u10D4\u10DC\u10D0:["\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8"],\u10EE\u10D8\u10DA\u10D5\u10D0\u10D3\u10DD\u10D1\u10D0:["\u10E1\u10D0\u10EF\u10D0\u10E0\u10DD","\u10E8\u10D4\u10D6\u10E6\u10E3\u10D3\u10E3\u10DA\u10D8","\u10D3\u10D0\u10DB\u10D0\u10DA\u10E3\u10DA\u10D8"]}}_();export{P as addTest};
