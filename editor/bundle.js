var Ht=Object.defineProperty;var m=(e,t)=>{for(var n in t)Ht(e,n,{get:t[n],enumerable:!0})};var v=function(e){return e[e.rightClick=0]="rightClick",e[e.element=1]="element",e[e.preset=2]="preset",e}({}),B=[document.getElementById("left-pane-right-click-menu"),document.getElementById("element-menu"),document.getElementById("preset-menu")],Jt={[v.element]:v.rightClick,[v.preset]:v.rightClick},ot;function O(){for(let e of B)e.style.visibility="hidden"}function Mt(e,t){let n=t.getBoundingClientRect();B[e].style.top=`${n.top}px`,B[e].style.left=`calc(${n.right}px + 0.25rem)`,B[e].style.visibility="visible",ot=e}function D(e,t,n){if(t.length>0)for(let o of B[e].children)o.disabled=!t.includes(o.id);else{console.error("requested to open a menu with 0 options.");for(let o of B[e].children)o.disabled=!1}Mt(e,n)}document.addEventListener("click",function(e){let t=[],n=ot;for(;n!==void 0;)t.push(n),n=Jt[n];let o;for(let r=0;r<3;r++)if(B[r].contains(e.target)){o=r;break}for(;t.length>0&&t[t.length-1]!==o;)t.pop();for(let r=0;r<3;r++)t.includes(r)||(B[r].style.visibility="hidden")});var P={};m(P,{attributes:()=>rt,initializeToolbar:()=>Ut,realElement:()=>N,showToolbar:()=>qt});function s(e,t,n,o){o===void 0&&(o=`${e}-${n}`);let r=document.createElement(t);return r.id=n,r.dataset.name=o,r.dataset.type=e,r}function N(){let e=l();return s("container","div",e,`\u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8 (${e})`)}var h={},Y=e=>document.getElementById(e);function Ut(){h.layout=Y("container-toolbar-layout"),h.padding=Y("container-toolbar-padding"),h.border=Y("container-toolbar-border"),h.align=Y("container-toolbar-align"),h.layout.addEventListener("change",()=>{i().dataset.layout=h.layout.value}),h.padding.addEventListener("change",()=>{i().style.padding=h.padding.value+"px"}),h.border.addEventListener("change",()=>{i().dataset.border=h.border.value}),h.align.addEventListener("change",()=>{i().dataset.align=h.align.value})}function qt(e){let t=rt(e);for(let[n,o]of Object.entries(t))h[n].value=o}function rt(e){return{layout:e.dataset.layout??"",padding:(e.style.padding??"0  ").slice(0,-2),border:e.dataset.border??"",align:e.dataset.align??""}}var _={};m(_,{attributes:()=>at,children:()=>Gt,initializeToolbar:()=>Vt,mounted:()=>Wt,realElement:()=>R,showToolbar:()=>Qt});var it=[];function Z(e){let t=e.parentElement;for(;t.id!=="main-content";){if(it.includes(t.id))return;t=t.parentElement}it.push(e.id),e.contentEditable="true"}function R(){let e=l();return s("paragraph","p",e,`\u10DE\u10D0\u10E0\u10D0\u10D2\u10E0\u10D0\u10E4\u10D8 (${e})`)}function Wt(e){Z(e)}var Gt=["text","formula"],u={},G=e=>document.getElementById(e);function Vt(){u["line-height"]=G("paragraph-toolbar-line-height"),u["first-line-indent"]=G("paragraph-toolbar-first-line-indent"),u["spacing-above"]=G("paragraph-toolbar-spacing-above"),u["spacing-below"]=G("paragraph-toolbar-spacing-below"),u.align=G("paragraph-toolbar-align"),u["line-height"].addEventListener("change",()=>{i().style.lineHeight=u["line-height"].value+"%"}),u["first-line-indent"].addEventListener("change",()=>{i().style.textIndent=u["first-line-indent"].value+"%"}),u["spacing-above"].addEventListener("change",()=>{i().style.marginTop=u["spacing-above"].value+"rem"}),u["spacing-below"].addEventListener("change",()=>{i().style.marginBottom=u["spacing-below"].value+"rem"}),u.align.addEventListener("change",()=>{i().style.textAlign=u.align.value})}function Qt(e){let t=at(e);for(let[n,o]of Object.entries(t))u[n].value=o}function at(e){return{"line-height":(e.style.lineHeight??"%").slice(0,-1),"first-line-indent":(e.style.lineHeight??"%").slice(0,-1),"spacing-above":(e.style.marginTop??"rem").slice(0,-2),"spacing-below":(e.style.marginBottom??"rem").slice(0,-2),align:e.style.textAlign??"left"}}var we={};m(we,{attributes:()=>lt,initializeToolbar:()=>Yt,realElement:()=>Xt,showToolbar:()=>Zt});function Xt(){let e=l();return s("formula","span",e,`\u10E4\u10DD\u10E0\u10DB\u10E3\u10DA\u10D0 (${e})`)}var V={},Kt=e=>document.getElementById(e);function Yt(){V.content=Kt("formula-toolbar-content"),V.content.addEventListener("keyup",()=>{i().dataset.content=V.content.value;let e=MathJax.tex2mml(V.content.value);i().innerHTML=e,i().firstChild.setAttribute("display","inline")})}function Zt(e){let t=lt(e);for(let[n,o]of Object.entries(t))V[n].value=o}function lt(e){return{content:e.dataset.content??""}}var ee={};m(ee,{attributes:()=>st,initializeToolbar:()=>tn,mounted:()=>en,realElement:()=>Ce,showToolbar:()=>nn});function Ce(){let e=l();return s("text","span",e,`\u10E2\u10D4\u10E5\u10E1\u10E2\u10D8 (${e})`)}function en(e){Z(e)}var p={},F=e=>document.getElementById(e);function tn(){p.content=F("text-toolbar-content"),p.color=F("text-toolbar-color"),p.bold=F("text-toolbar-bold"),p.italic=F("text-toolbar-italic"),p.underline=F("text-toolbar-underline"),p.size=F("text-toolbar-size"),p.content.addEventListener("keyup",()=>{i().innerText=p.content.value;let e="(T) "+p.content.value.slice(0,20);p.content.value.length>20&&(e+="..."),i().dataset.name=e,d().firstChild.innerText=e},!1),p.color.addEventListener("change",()=>{i().style.color=p.color.value},!1),p.bold.addEventListener("change",()=>{i().style.fontWeight=p.bold.checked?"bold":"normal"},!1),p.italic.addEventListener("change",()=>{i().style.fontStyle=p.italic.checked?"oblique":"normal"},!1),p.underline.addEventListener("change",()=>{i().style.textDecoration=p.underline.checked?"underline":"none"},!1),p.size.addEventListener("change",()=>{i().style.fontSize=p.size.value+"pt"},!1)}function nn(e){let t=st(e);for(let[n,o]of Object.entries(t))p[n].value=o}function st(e){return{content:e.innerText,color:e.style.color??"black",bold:String(e.style.fontWeight==="bold"),italic:String(e.style.fontStyle==="oblique"),underline:String(e.style.textDecoration==="underline"),size:(e.style.fontSize??"12pt").slice(0,-2)}}var ke={};m(ke,{attributes:()=>ct,initializeToolbar:()=>rn,realElement:()=>on,showToolbar:()=>an});function on(){let e=l();return s("heading","h1",e,`\u10E1\u10D0\u10D7\u10D0\u10E3\u10E0\u10D8 (${e})`)}var y={},Ie=e=>document.getElementById(e);function rn(){y.level=Ie("heading-toolbar-level"),y.content=Ie("heading-toolbar-content"),y.align=Ie("heading-toolbar-align"),y.content.addEventListener("keyup",()=>{i().innerText=y.content.value;let e="(H) "+y.content.value.slice(0,20);y.content.value.length>20&&(e+="..."),i().dataset.name=e,d().firstChild.innerText=e},!1),y.level.addEventListener("change",()=>{let e=i(),t=document.createElement(`h${y.level.value}`);t.id=e.id,t.textContent=e.textContent,t.style.textAlign=e.style.textAlign,t.dataset.type=e.dataset.type,t.dataset.name=e.dataset.name,e.replaceWith(t),Te(t)}),y.align.addEventListener("change",()=>{i().style.textAlign=y.align.value})}function an(e){let t=ct(e);for(let[n,o]of Object.entries(t))y[n].value=o}function ct(e){return{content:e.innerText,level:e.tagName.slice(1),align:e.style.textAlign??"center"}}var ne={};m(ne,{attributes:()=>dt,initializeToolbar:()=>sn,realElement:()=>Le,showToolbar:()=>cn});function Le(){let e=document.createElement("input");return e.type="text",e.id=l(),e.dataset.name=`\u10DB\u10DD\u10D9\u10DA\u10D4 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="shortTextInput",e}var te={},ln=e=>document.getElementById(e);function sn(){te.width=ln("shortTextInput-toolbar-width"),te.width.addEventListener("change",()=>{i().style.width=te.width.value+"ch"})}function cn(e){let t=dt(e);for(let[n,o]of Object.entries(t))te[n].value=o}function dt(e){return{width:e.style.width.slice(0,-2)}}var Be={};m(Be,{attributes:()=>mt,initializeToolbar:()=>pn,realElement:()=>dn,showToolbar:()=>un});function dn(){let e=document.createElement("textarea");return e.id=l(),e.dataset.name=`\u10D2\u10E0\u10EB\u10D4\u10DA\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="longTextInput",e}var oe={},mn=e=>document.getElementById(e);function pn(){oe.width=mn("longTextInput-toolbar-width"),oe.width.addEventListener("change",()=>{i().cols=Number(oe.width.value)})}function un(e){let t=mt(e);for(let[n,o]of Object.entries(t))oe[n].value=o}function mt(e){return{width:String(e.cols)}}var ie={};m(ie,{attributes:()=>pt,children:()=>fn,initializeToolbar:()=>gn,realElement:()=>Se,showToolbar:()=>hn});function Se(){let e=l();return s("multipleChoiceInput","ol",e,`\u10DB\u10E0\u10D0\u10D5\u10D0\u10DA\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var fn=["multipleChoiceItem"],re={};function gn(){re.numbering=document.getElementById("multipleChoiceInput-toolbar-numbering"),re.numbering.addEventListener("change",()=>{i().dataset.numbering=re.numbering.value})}function hn(e){let t=pt(e);for(let[n,o]of Object.entries(t))re[n].value=o}function pt(e){return{numbering:e.dataset.numbering??"letters"}}var ae={};m(ae,{attributes:()=>xn,initializeToolbar:()=>yn,parents:()=>bn,realElement:()=>H,showToolbar:()=>En});function H(){let e=document.createElement("li");e.dataset.type="multipleChoiceItem",e.id=l(),e.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${e.id})`;let t=document.createElement("input");return t.type="checkbox",t.id=l(),e.appendChild(t),e}var bn=["multipleChoiceInput"];function yn(){}function En(e){}function xn(e){return{}}var se={};m(se,{attributes:()=>ut,children:()=>vn,initializeToolbar:()=>wn,realElement:()=>$e,showToolbar:()=>Cn});function $e(){let e=l();return s("singleChoiceInput","ol",e,`\u10D4\u10E0\u10D7\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var vn=["singleChoiceItem"],le={};function wn(){le.numbering=document.getElementById("singleChoiceInput-toolbar-numbering"),le.numbering.addEventListener("change",()=>{i().dataset.numbering=le.numbering.value})}function Cn(e){let t=ut(e);for(let[n,o]of Object.entries(t))le[n].value=o}function ut(e){return{numbering:e.dataset.numbering??"letters"}}var ce={};m(ce,{attributes:()=>Ln,initializeToolbar:()=>kn,parents:()=>In,realElement:()=>Oe,showToolbar:()=>Tn});function Oe(e){let t=document.createElement("li");t.dataset.type="singleChoiceItem",t.id=l(),t.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${t.id})`;let n=document.createElement("input");return n.type="radio",n.id=l(),n.name=e,t.appendChild(n),t}var In=["singleChoiceInput"];function kn(){}function Tn(e){}function Ln(e){return{}}var Ne={};m(Ne,{attributes:()=>Nn,children:()=>Sn,initializeToolbar:()=>$n,realElement:()=>Bn,showToolbar:()=>On});function Bn(){let e=l();return s("browserSim","browser-sim",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10E1\u10D8\u10DB\u10E3\u10DA\u10D0\u10E2\u10DD\u10E0\u10D8 (${e})`)}var Sn=["browserPage"];function $n(){}function On(e){}function Nn(e){return{}}var je={};m(je,{attributes:()=>ft,initializeToolbar:()=>zn,parents:()=>jn,realElement:()=>Rn,showToolbar:()=>An});function Rn(){let e=l(),t=s("browserPage","browser-page",e,`\u10D2\u10D5\u10D4\u10E0\u10D3\u10D8 (${e})`);return t.setAttribute("closable","true"),t}var jn=["browserSim"],w={},Re=e=>document.getElementById(e);function zn(){w.closable=Re("browserPage-toolbar-closable"),w.title=Re("browserPage-toolbar-title"),w.url=Re("browserPage-toolbar-url"),w.closable.addEventListener("change",()=>{i().setAttribute("closable",String(w.closable.checked))}),w.title.addEventListener("keyup",()=>{i().setAttribute("title",w.title.value)}),w.url.addEventListener("keyup",()=>{i().setAttribute("url",w.url.value)})}function An(e){let t=ft(e);for(let[n,o]of Object.entries(t))w[n].value=o}function ft(e){return{closable:e.getAttribute("closable")??"true",title:e.getAttribute("title")??"",url:e.getAttribute("url")??e.id}}var ze={};m(ze,{attributes:()=>ht,children:()=>Pn,initializeToolbar:()=>_n,realElement:()=>Dn,showToolbar:()=>Fn});function Dn(){let e=l();return s("browserLink","browser-link",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10DA\u10D8\u10DC\u10D9\u10D8 (${e})`)}var Pn=["text","image"],E={},gt=e=>document.getElementById(e);function _n(){E.browser=gt("browserLink-toolbar-browser"),E.url=gt("browserLink-toolbar-url"),E.browser.addEventListener("change",()=>{i().setAttribute("browser",E.browser.value)}),E.url.addEventListener("change",()=>{i().setAttribute("url",E.url.value)})}function Fn(e){let t=[],n={};function o(a){a.tagName==="BROWSER-SIM"&&(n[a.dataset.name]=a.id),a.tagName==="BROWSER-PAGE"&&t.push(a.getAttribute("url"));for(let c of a.children)o(c)}o(g),E.url.innerHTML="",E.browser.innerHTML="";for(let a of t){let c=document.createElement("option");c.value=a,c.innerText=a,E.url.appendChild(c)}for(let a of Object.keys(n)){let c=document.createElement("option");c.value=n[a],c.innerText=a,E.browser.appendChild(c)}let r=ht(e);for(let[a,c]of Object.entries(r))E[a].value=c}function ht(e){return{browser:e.getAttribute("browser")??"",url:e.getAttribute("url")??""}}var Fe={};m(Fe,{attributes:()=>bt,children:()=>Qn,initializeToolbar:()=>Yn,realElement:()=>Vn,showToolbar:()=>Zn});var De={};m(De,{attributes:()=>Un,children:()=>Hn,initializeToolbar:()=>Jn,realElement:()=>Ae,showToolbar:()=>Mn});function Ae(){let e=l();return s("tableRow","tr",e,"\u10E1\u10E2\u10E0\u10D8\u10E5\u10DD\u10DC\u10D8")}var Hn=[];function Jn(){}function Mn(e){}function Un(e){return{}}var Pe={};m(Pe,{attributes:()=>Gn,initializeToolbar:()=>qn,realElement:()=>de,showToolbar:()=>Wn});function de(){let e=l();return s("tableElement","td",e,"\u10D4\u10DA\u10D4\u10DB\u10D4\u10DC\u10E2\u10D8")}function qn(){}function Wn(e){}function Gn(e){return{}}function Vn(){let e=l(),t=s("table","table",e,`\u10EA\u10EE\u10E0\u10D8\u10DA\u10D8 (${e})`);return t.appendChild(Ae()),t.lastChild.appendChild(de()),t}var Qn=[];function Xn(e,t){let n=e.children.length;if(n<t)for(let o=0;o<t-n;o++){let r=Q(e.lastChild);e.appendChild(r)}else if(n>t)for(;e.children.length>t;)e.lastChild.remove();e.dataset.rows=String(t),He(e)}function Kn(e,t){let n=e.firstChild.children.length;for(let o of e.children)if(n<t)for(let r=0;r<t-n;r++)o.appendChild(de());else for(;o.children.length;)o.lastChild.remove();e.dataset.cols=String(t),He(e)}var C={},_e=e=>document.getElementById(e);function Yn(){C.style=_e("table-toolbar-style"),C.rows=_e("table-toolbar-rows"),C.cols=_e("table-toolbar-cols"),C.style.addEventListener("change",()=>{i().dataset.style=C.style.value}),C.rows.addEventListener("change",()=>{let e=i();Xn(e,Number(C.rows.value))}),C.cols.addEventListener("change",()=>{let e=i();Kn(e,Number(C.cols.value))})}function Zn(e){let t=bt(e);for(let[n,o]of Object.entries(t))C[n].value=o}function bt(e){return{style:e.dataset.style||"empty",rows:e.dataset.rows||"1",cols:e.dataset.cols||"1"}}var qe={};m(qe,{attributes:()=>wt,initializeToolbar:()=>to,realElement:()=>eo,showToolbar:()=>no});function me(){let e=localStorage.getItem("authToken");return e?{Authorization:`Bearer ${e}`}:{}}var ue=class extends Error{};var pe="https://terryapi.dimitri.ge/api";async function yt(e){let t=await fetch(`${pe}/test/${e}`,{headers:me()});if(!t.ok){if(t.status===401)throw new ue;{let o=JSON.stringify(await t.json());throw new Error(o)}}let n=await t.json();return{id:e,...n}}function Et(e,t){return fetch(`${pe}/test/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",...me()},body:JSON.stringify({...t,gradingScheme:JSON.stringify(t.gradingScheme)})})}function Je(e,t){return`${pe}/image/${e}/${t}`}async function xt(e,t,n){let o=new FormData;return o.append("image",n),(await fetch(Je(e,t),{method:"POST",headers:{...me()},body:o})).ok}var T;async function Me(e,t){return T=e,localStorage.setItem("currentFile",JSON.stringify(e)),t!==void 0?(await Et(t,e)).ok:!1}async function vt(e){if(e!==void 0)try{return T=await yt(e),T}catch(n){console.log(n)}let t=localStorage.getItem("currentFile");return t!=null?T=JSON.parse(t):T={content:'<div data-type="container" data-name="\u10DB\u10D7\u10D0\u10D5\u10D0\u10E0\u10D8 \u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8" id="0" data-pages="1"></div>'},T}function eo(){let e=l();return s("image","img",e,`\u10E1\u10E3\u10E0\u10D0\u10D7\u10D8 (${e})`)}var I={},Ue=e=>document.getElementById(e);function to(){I.image=Ue("image-toolbar-image"),I.width=Ue("image-toolbar-width"),I.float=Ue("image-toolbar-float"),I.image.addEventListener("change",async e=>{let n=e.target.files[0];if(await xt(T.id,n.name,n))i().src=Je(T.id,n.name);else{let o=new FileReader;o.onload=r=>{i().src=r.target.result},o.readAsDataURL(e.target.files[0])}}),I.width.addEventListener("change",()=>{i().style.width=`${I.width.value}px`}),I.float.addEventListener("change",()=>{i().style.float=I.float.value})}function no(e){let t=wt(e);for(let[n,o]of Object.entries(t))I[n]&&(I[n].value=o)}function wt(e){return{url:e.src??"",width:(e.style.width??"100px").slice(0,-2),float:e.style.float??"left"}}var We={};m(We,{attributes:()=>Ct,children:()=>ro,initializeToolbar:()=>io,realElement:()=>oo,showToolbar:()=>ao});function oo(){let e=l();return s("multiColumn","div",e,"\u10DB\u10E0\u10D0\u10D5\u10D0\u10DA\u10E1\u10D5\u10D4\u10E2\u10D8\u10D0\u10DC\u10D8 \u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8")}var ro=["container"],fe={};function io(){fe.height=document.getElementById("multiColumn-toolbar-height"),fe.height.addEventListener("change",()=>{i().style.height=Number(fe.height.value)*.8+"vh"})}function ao(e){let t=Ct(e);for(let[n,o]of Object.entries(t))fe[n].value=o}function Ct(e){return{height:(e.style.height??"80vh").slice(0,-2)}}function x(e){let t=e.dataset.type,n=e.id,o=e.dataset.name,r=[];for(let a of e.children){let c=x(a);c&&(c instanceof HTMLElement?r.push(c):r.push(...c))}if(t!==void 0){let a=document.createElement("div");a.innerHTML=r.length===0?`<div class="list" tabindex="0" data-id="${n}" data-type="${t}"><span data-type="${t}">${o}</span></div>`:`<details open class="list" tabindex="0" data-id="${n}" data-type="${t}"><summary data-type="${t}">${o}</summary></details>`;let c=a.firstChild;for(let ve of r)c.appendChild(ve);return c}else return r}var f={container:P,paragraph:_,formula:we,text:ee,shortTextInput:ne,multipleChoiceInput:ie,multipleChoiceItem:ae,singleChoiceInput:se,singleChoiceItem:ce,browserSim:Ne,browserPage:je,browserLink:ze,table:Fe,tableRow:De,tableElement:Pe,image:qe,longTextInput:Be,heading:ke,multiColumn:We};function It(){for(let{initializeToolbar:e}of Object.values(f))e&&e()}function Ge(e){let t=[];for(let n of Object.keys(f)){let o=!0;f[e.dataset.type].children!==void 0&&(o&&=f[e.dataset.type].children.includes(n)),f[n].parents!==void 0&&(o&&=f[n].parents.includes(e.dataset.type)),o&&t.push(n)}return t}var lo=document.getElementById("page-buttons"),kt=document.getElementById("add-page"),J=0,b=0,L=[],Tt=[];function ge(){let e=document.createElement("input");e.type="radio",e.id=`page-${b+1}`,e.name="current-page";let t=b;e.addEventListener("change",()=>{Lt(t)});let n=document.createElement("label");n.innerText=String(b+1),n.appendChild(e),lo.insertBefore(n,kt),Tt.push(n),L.push([]),b+=1,g.firstElementChild.dataset.pages=String(b)}function so(){for(let e of L[J])e.classList.remove("current")}function Lt(e){if(e<b&&e>=0){so(),J=e;for(let t of L[J])t.classList.add("current")}}function j(e){switch(e.dataset.visibilityType??"always"){case"only":{let n=Number(e.dataset.visibleOnlyOn??"1");for(;n>b;)ge();St(e,n);break}case"range":{let n=Number(e.dataset.visibleFrom??"1"),o=Number(e.dataset.visibleTo??"1");for(;n>b;)ge();for(;o>b;)ge();mo(e,n,o);break}}for(let n of e.children)j(n);co()}function Bt(e,t,n){for(let o=0;o<b;o++)if(o<t||o>n){let r=L[o].indexOf(e);r>=0&&L[o].splice(r,1)}}function co(){for(let e=b-1;e>0&&!(L[e].length>0);e--)L.pop(),Tt.pop().remove(),b--}function St(e,t,n=!0){t-=1,t<b&&t>=0&&(L[t].includes(e)||L[t].push(e),n&&Bt(e,t,t),t===J&&Lt(t))}function mo(e,t,n){for(let o=t;o<=n;o++)St(e,o,!1);Bt(e,t-1,n-1)}kt.addEventListener("click",()=>{ge()});var Ot={general:["visibility-type","visible-only-on","visible-from","visible-to"]},po={general:e=>{let t={"visibility-type":e.dataset.visibilityType||"always"};switch(t["visibility-type"]){case"only":t["visible-only-on"]=e.dataset.visibleOnlyOn||"1";break;case"range":t["visible-from"]=e.dataset.visibleFrom||"1",t["visible-to"]=e.dataset.visibleTo||"1";break}return t}},S={};for(let e of Object.keys(Ot)){let t={};for(let n of Ot[e]){let o=document.getElementById(`${e}-toolbar-${n}`);t[n]={element:o,addEventListener:o.addEventListener,set value(r){if(o.nodeName==="INPUT"){let a=o;switch(a.type){case"text":case"number":a.value=r;break;case"checkbox":a.checked=r}}(o.nodeName==="SELECT"||o.nodeName==="TEXTAREA")&&(o.value=r),this.setTrigger(r)},setTrigger(r){}}}S[e]=t}var Nt={_elements:{},_current:void 0,show(e){this._current&&this._current.classList.remove("current");let t=e.dataset.type;if(this._elements[t]===void 0&&(this._elements[t]=document.getElementById(`${t}-toolbar`)),this._current=this._elements[t],this._current){this._current.classList.add("current"),f[t].showToolbar(e);let n=po.general(e);for(let o of Object.keys(n))S.general[o].value=n[o]}},hide(){this._current&&(this._current.classlist.remove("current"),this._current=void 0)}};function uo(){S.general["visibility-type"].setTrigger=e=>{Ve.dataset.visibilityType=e},S.general["visibility-type"].element.addEventListener("change",e=>{S.general["visibility-type"].setTrigger(e.target.value),i().dataset.visibilityType=e.target.value}),S.general["visible-only-on"].element.addEventListener("change",e=>{i().dataset.visibleOnlyOn=e.target.value,j(i())}),S.general["visible-from"].element.addEventListener("change",e=>{i().dataset.visibleFrom=e.target.value,j(i())}),S.general["visible-to"].element.addEventListener("change",e=>{i().dataset.visibleTo=e.target.value,j(i())})}uo();var Qe=0;function l(){return String(Qe++)}function Xe(e){let t=Number(e.id);t>=Qe&&(Qe=t+1);for(let n of e.children)Xe(n)}function Q(e){let t=e.cloneNode(!0);function n(o){o.id=l();for(let r of o.children)n(r)}return n(t),t}var z;function d(){return z}function A(){jt(),z&&(z.blur(),z.removeAttribute("id")),z=void 0}function he(e){A(),z=e,z.setAttribute("id","selected");let t=document.getElementById(e.dataset.id);Te(t),Nt.show(t)}function Rt(e){he(e)}function He(e){let t=e.id,n=$.querySelector(`[data-id="${t}"]`);n.parentElement.replaceChild(x(e),n)}var M;function i(){return M}function jt(){M&&M.classList.remove("selected"),M=void 0}function Te(e){jt(),M=e,M.classList.add("selected")}var zt={multipleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},singleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},shortTextInput:e=>({correct:e.value})};var Ke;function At(){Ke={};for(let e of Object.keys(zt))for(let t of g.querySelectorAll(`[data-type=${e}]`))Ke[t.id]=zt[e](t);return Ke}var be=class{#t=100;#n=[];#e=-1;update(t){this.#n.splice(0,this.#e,t),this.#n.length>=this.#t&&this.#n.splice(this.#t),this.#e=-1}canGoBack(){return this.#e<this.#n.length-1}goBack(){return this.#e+=1,this.#n[this.#e]}canGoForward(){return this.#e>0}goForward(){return this.#e-=1,this.#n[this.#e]}};var Dt=document.getElementById("test-name"),fo=window.location.search,go=new URLSearchParams(fo),ye=go.get("id"),Pt=e=>{e.classList.remove("selected"),e.className===""&&e.removeAttribute("class");for(let t of e.children)Pt(t)},Ye=class{get content(){let t=g.cloneNode(!0);return Pt(t),t.innerHTML.trim().replaceAll(/[\s\t][\s\t]+/g,"").replaceAll(' contenteditable="true"',"")}get gradingScheme(){return JSON.stringify(At())}get name(){return Dt.value}export(){return{content:this.content,gradingScheme:this.gradingScheme,name:this.name}}load({name:t,content:n,gradingScheme:o}){g.innerHTML=n;for(let r of g.getElementsByTagName("p"))r.contentEditable="true";for(let r of g.getElementsByTagName("span"))r.contentEditable="true";if(Xe(g.firstChild),o){let r=JSON.parse(o);for(let a of Object.keys(r))document.getElementById(a).value=r[a].correct}$.innerHTML="",$.appendChild(x(g.firstElementChild)),j(g.firstElementChild),t&&(Dt.value=t)}},U=new be;document.getElementById("undo").addEventListener("click",()=>{if(U.canGoBack()){let e=U.goBack();q.load(e)}else console.log("can't go back anymore")});document.getElementById("redo").addEventListener("click",()=>{if(U.canGoForward()){let e=U.goForward();q.load(e)}else console.log("can't go forward anymore")});function k(){U.update(q.export())}var q=new Ye;document.getElementById("save-test").addEventListener("click",async()=>{await Me(q.export(),ye??void 0)});function _t(e){e.preventDefault()}document.getElementById("preview").addEventListener("click",async()=>{await Me(q.export(),ye??void 0)&&(removeEventListener("beforeunload",_t),window.location.href=`/player/?id=${ye}&page=${J+1}`)});addEventListener("beforeunload",_t);async function ho(){let e=await vt(ye);q.load(e),U.update(e)}ho();var $=document.getElementById("tree-view"),g=document.getElementById("main-content"),Ve=document.getElementById("right-pane"),Ze=!1;$.addEventListener("click",e=>{d()!==void 0&&(d().contains(e.target)||A(),Ze||e.preventDefault(),Ze=!0)},!0);$.addEventListener("contextmenu",e=>{let t=e.target;if(e.preventDefault(),t.classList.contains("list"))he(t);else if(t.parentElement.classList.contains("list"))he(t.parentElement);else return;e.stopPropagation();let n=["rcm-add-child","rcm-add-preset","rcm-copy","rcm-delete","rcm-rename"];(t.parentElement.parentElement.parentElement.classList.contains("list")||t.parentElement.parentElement.classList.contains("list"))&&n.push("rcm-add-sibbling"),X.isCopying()&&(n.push("rcm-paste-child"),t.parentElement?.classList.contains("list")&&n.push("rcm-paste-above")),D(v.rightClick,n,t)},!0);$.addEventListener("focus",e=>{let t=e.target;t.classList.contains("list")||(t=t.parentElement),t.classList.contains("list")&&(Rt(t),Ze=!1)},!0);Ve.addEventListener("change",()=>{k()});var et={};m(et,{realElement:()=>bo});function bo(){let e=N();return e.appendChild(R()),e.appendChild(Le()),e}var tt={};m(tt,{realElement:()=>yo});function yo(){let e=N();e.appendChild(R());let t=Se();return t.appendChild(H()),t.appendChild(H()),t.appendChild(H()),t.appendChild(H()),e.appendChild(t),e}var nt={};m(nt,{realElement:()=>Eo});function Ee(e){let t=Oe(e),n=Ce();return t.append(n),n.innerText=" abc ",t}function Eo(){let e=N();e.appendChild(R());let t=$e();return t.appendChild(Ee(t.id)),t.appendChild(Ee(t.id)),t.appendChild(Ee(t.id)),t.appendChild(Ee(t.id)),e.appendChild(t),e}var W={shortTextQuestion:et,multipleChoiceQuestion:tt,singleChoiceQuestion:nt};function Ft(){let e=[];for(let t of Object.keys(W))e.push(t);return e}var xe=class{#t;set data(t){this.#t=t}get data(){return this.#t}isCopying(){return this.#t!==void 0}};var K,X=new xe;function xo(){document.getElementById("rcm-add-child").addEventListener("click",e=>{K=vo,D(v.element,Ge(d()),e.target)},!1),document.getElementById("rcm-add-sibbling").addEventListener("click",e=>{K=wo,D(v.element,Ge(d().parentElement),e.target)},!1),document.getElementById("rcm-add-preset").addEventListener("click",e=>{K=Co,D(v.preset,Ft(),e.target)},!1),document.getElementById("rcm-copy").addEventListener("click",e=>{let t=d().dataset.id;X.data=document.getElementById(t),O()},!1),document.getElementById("rcm-paste-child").addEventListener("click",e=>{let t=Q(X.data);i().appendChild(t),d().parentElement.replaceChild(x(i()),d()),O(),k()},!1),document.getElementById("rcm-paste-above").addEventListener("click",e=>{let t=Q(X.data);i().parentElement.insertBefore(t,i());let n=x(i().parentElement);d().parentElement.parentElement.replaceChild(n,d().parentElement),O(),k()},!1),document.getElementById("rcm-delete").addEventListener("click",e=>{let t=d().dataset.id;d().remove(),A(),document.getElementById(t).remove(),O(),k()},!1),document.getElementById("rcm-rename").addEventListener("click",e=>{let t=d().dataset.id,n=d().firstChild,o=n.innerText,r=document.createElement("input");r.type="text",r.value=o,d().insertBefore(r,n),n.remove(),r.focus(),r.addEventListener("blur",a=>{r.contains(a.relatedTarget)||(n.innerText=r.value,document.getElementById(t).dataset.name=r.value,d().insertBefore(n,r),r.remove())}),r.addEventListener("click",a=>{a.stopPropagation()}),r.addEventListener("keyup",a=>{(a.key==="Enter"||a.key==="Escape")&&r.blur()}),n.remove(),k()},!1);for(let e of Object.keys(f)){let t=document.getElementById(e);t&&t.addEventListener("click",()=>{K(d(),e),A(),O()})}for(let e of Object.keys(W)){let t=document.getElementById(e);t&&t.addEventListener("click",()=>{K(d(),e),A(),O()})}It()}xo();function vo(e,t){let n=e.dataset.id,o=document.getElementById(n),r=f[t].realElement(n);if(o.appendChild(r),f[t].mounted!==void 0&&f[t].mounted(r),e.appendChild(x(r)),e.tagName==="DIV"){let a=document.createElement("details");a.classList.add("list"),a.tabIndex=0,a.dataset.id=n,a.dataset.type=e.dataset.type,a.open=!0;let c=document.createElement("summary");c.dataset.type=e.dataset.type,c.innerText=e.firstChild.innerText,a.appendChild(c);let ve=[...e.children].slice(1);a.append(...ve),e.replaceWith(a)}k()}function wo(e,t){let n=e.dataset.id,o=document.getElementById(n),r=o.parentElement,a=e.parentElement.id,c=f[t].realElement(a);r.insertBefore(c,o),f[t].mounted!==void 0&&f[t].mounted(c),e.parentElement.insertBefore(x(c),e),k()}function Co(e,t){let n=e.dataset.id,o=document.getElementById(n),r=W[t].realElement();o.appendChild(r),W[t].mounted!==void 0&&W[t].mounted(r),e.parentElement.replaceChild(x(o),e),k()}export{X as copyBuffer};
