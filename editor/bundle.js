var se=Object.defineProperty;var f=(e,t)=>{for(var o in t)se(e,o,{get:t[o],enumerable:!0})};var x=function(e){return e[e.rightClick=0]="rightClick",e[e.element=1]="element",e}({}),b=[document.getElementById("left-pane-right-click-menu"),document.getElementById("element-menu")];function T(){for(let e of b)e.style.visibility="hidden"}function ae(e,t){let o=t.getBoundingClientRect();b[e].style.top=`${o.top}px`,b[e].style.left=`${o.right+2}px`,b[e].style.visibility="visible"}function N(e,t,o){if(t.length>0)for(let n of b[e].children)n.disabled=!t.includes(n.id);else for(let n of b[e].children)n.disabled=!1;ae(e,o)}document.addEventListener("click",function(e){b[x.rightClick].contains(e.target)||(b[x.rightClick].style.visibility="hidden",b[x.element].style.visibility="hidden")});var y=document.getElementById("tree-view"),u=document.getElementById("main-content"),J=document.getElementById("right-pane");var le=document.getElementById("page-buttons"),V=document.getElementById("add-page"),A=0,g=0,I=[];function k(){let e=document.createElement("input");e.type="radio",e.id=`page-${g+1}`,e.name="current-page";let t=g;e.addEventListener("change",()=>{G(t)});let o=document.createElement("label");o.innerText=String(g+1),o.appendChild(e),le.insertBefore(o,V),I.push([]),g+=1,u.firstElementChild.dataset.pages=String(g)}function ce(){for(let e of I[A])e.classList.remove("current")}function G(e){if(e<g&&e>=0){ce(),A=e;for(let t of I[A])t.classList.add("current")}}function w(e){switch(e.dataset.visibilityType||"always"){case"only":let o=Number(e.dataset.visibleOnlyOn||"1");for(;o>g;)k();K(e,o);break;case"range":let n=Number(e.dataset.visibleFrom||"1"),r=Number(e.dataset.visibleTo||"1");for(;n>g;)k();for(;r>g;)k();de(e,n,r);break}for(let o of e.children)w(o)}function X(e){for(let t of I){let o=t.indexOf(e);o>=0&&t.splice(o,1)}}function K(e,t,o=!0){t-=1,t<g&&t>=0&&(o&&X(e),I[t].includes(e)||I[t].push(e),t===A&&G(t))}function de(e,t,o){X(e);for(let n=t;n<=o;n++)K(e,n,!1)}V.addEventListener("click",()=>{k()});var Y={text:["content","color","bold","italic","underline","size"],paragraph:["line-height","first-line-indent","spacing-above","spacing-below"],container:["layout","padding","border","align"],"browser-page":["title","url"],"browser-link":["browser","url"],formula:["content"],"short-text-input":["width"],table:["style"],general:["visibility-type","visible-only-on","visible-from","visible-to"]},Z={text:e=>({content:e.innerText,color:e.style.color||"black",bold:e.style.fontWeight==="bold",italic:e.style.fontStyle==="oblique",underline:e.style.textDecoration==="underline",size:(e.style.fontSize||"12pt").slice(0,-2)}),paragraph:e=>({"line-height":e.style.lineHeight.slice(0,-1),"first-line-indent":e.style.lineHeight.slice(0,-1),"spacing-above":e.style.marginTop.slice(0,-2),"spacing-below":e.style.marginBottom.slice(0,-2)}),container:e=>({layout:e.dataset.layout,padding:e.style.padding.slice(0,-2),border:e.dataset.border,align:e.dataset.align}),formula:e=>({content:e.dataset.content}),"short-text-input":e=>({width:e.style.width.slice(0,-2)}),"browser-link":e=>({browser:e.getAttribute("browser"),url:e.getAttribute("to")}),"browser-page":e=>({title:e.getAttribute("title"),url:e.getAttribute("url")}),table:e=>({style:e.dataset.style||"empty"}),general:e=>{let t={"visibility-type":e.dataset.visibilityType||"always"};switch(t["visibility-type"]){case"only":t["visible-only-on"]=e.dataset.visibleOnlyOn||"1";break;case"range":t["visible-from"]=e.dataset.visibleFrom||"1",t["visible-to"]=e.dataset.visibleTo||"1";break}return t}},a={};for(let e of Object.keys(Y)){let t={};for(let o of Y[e]){let n=document.getElementById(`${e}-toolbar-${o}`);t[o]={element:n,addEventListener:n.addEventListener,set value(r){if(n.nodeName==="INPUT"){let i=n;switch(i.type){case"text":case"number":i.value=r;break;case"checkbox":i.checked=r}}(n.nodeName==="SELECT"||n.nodeName==="TEXTAREA")&&(n.value=r),this.setTrigger(r)},setTrigger(r){}}}a[e]=t}var ee={_elements:{},_current:void 0,show(e){this._current&&this._current.classList.remove("current");let t=e.dataset.type;if(this._elements[t]===void 0&&(this._elements[t]=document.getElementById(`${t}-toolbar`)),this._current=this._elements[t],t==="browser-link"){let r=function(i){i.tagName==="BROWSER-SIM"&&(n[i.dataset.name]=i.id),i.tagName==="BROWSER-PAGE"&&o.push(i.getAttribute("url"));for(let d of i.children)r(d)},o=[],n={};r(mainContent),a["browser-link"].url.element.innerHTML="",a["browser-link"].browser.element.innerHTML="";for(let i of o){let d=document.createElement("option");d.value=i,d.innerText=i,a["browser-link"].url.element.appendChild(d)}for(let i of Object.keys(n)){let d=document.createElement("option");d.value=n[i],d.innerText=i,a["browser-link"].browser.element.appendChild(d)}}if(this._current){this._current.classList.add("current");let o=Z[t](e);for(let r of Object.keys(o))a[t][r].value=o[r];let n=Z.general(e);for(let r of Object.keys(n))a.general[r].value=n[r]}},hide(){this._current&&(this._current.classlist.remove("current"),this._current=void 0)}};function me(){a.general["visibility-type"].setTrigger=e=>{J.dataset.visibilityType=e},a.general["visibility-type"].element.addEventListener("change",e=>{a.general["visibility-type"].setTrigger(e.target.value),s().dataset.visibilityType=e.target.value}),a.general["visible-only-on"].element.addEventListener("change",e=>{s().dataset.visibleOnlyOn=e.target.value,w(s())}),a.general["visible-from"].element.addEventListener("change",e=>{s().dataset.visibleFrom=e.target.value,w(s())}),a.general["visible-to"].element.addEventListener("change",e=>{s().dataset.visibleTo=e.target.value,w(s())}),a.table.style.element.addEventListener("change",e=>{s().dataset.style=e.target.value}),a["short-text-input"].width.element.addEventListener("change",e=>{s().style.width=e.target.value+"ch"}),a.formula.content.element.addEventListener("keyup",e=>{s().dataset.content=e.target.value;let t=MathJax.tex2mml(e.target.value);s().innerHTML=t,s().firstChild.setAttribute("display","inline")}),a["browser-link"].browser.element.addEventListener("change",e=>{s().setAttribute("browser",e.target.value)}),a["browser-link"].url.element.addEventListener("change",e=>{s().setAttribute("to",e.target.value)}),a["browser-page"].title.element.addEventListener("keyup",e=>{s().setAttribute("title",e.target.value)}),a["browser-page"].url.element.addEventListener("keyup",e=>{s().setAttribute("url",e.target.value)}),a.paragraph["line-height"].element.addEventListener("change",e=>{s().style.lineHeight=e.target.value+"%"}),a.paragraph["first-line-indent"].element.addEventListener("change",e=>{s().style.textIndent=e.target.value+"%"}),a.paragraph["spacing-above"].element.addEventListener("change",e=>{s().style.marginTop=e.target.value+"rem"}),a.paragraph["spacing-below"].element.addEventListener("change",e=>{s().style.marginBottom=e.target.value+"rem"}),a.container.layout.element.addEventListener("change",e=>{s().dataset.layout=e.target.value}),a.container.padding.element.addEventListener("change",e=>{s().style.padding=e.target.value+"px"}),a.container.border.element.addEventListener("change",e=>{s().dataset.border=e.target.value}),a.container.align.element.addEventListener("change",e=>{s().dataset.align=e.target.value}),a.text.content.element.addEventListener("keyup",e=>{s().innerText=e.target.value},!1),a.text.color.element.addEventListener("change",e=>{s().style.color=e.target.value},!1),a.text.bold.element.addEventListener("change",e=>{s().style.fontWeight=e.target.checked?"bold":"normal"},!1),a.text.italic.element.addEventListener("change",e=>{s().style.fontStyle=e.target.checked?"oblique":"normal"},!1),a.text.underline.element.addEventListener("change",e=>{s().style.textDecoration=e.target.checked?"underline":"none"},!1),a.text.size.element.addEventListener("change",e=>{s().style.fontSize=e.target.value+"pt"},!1)}me();var pe=0;function l(){return String(pe++)}function $(e){let t=e.cloneNode(!0);function o(n){n.id=l();for(let r of n.children)o(r)}return o(t),t}var L;function p(){return L}function B(){L&&(L.blur(),L.removeAttribute("id")),L=void 0}function R(e){B(),L=e,L.setAttribute("id","selected")}function te(e){R(e);let t=document.getElementById(e.dataset.id);fe(t),ee.show(t)}var C;function s(){return C}function ue(){C&&C.classList.remove("selected"),C=void 0}function fe(e){ue(),C=e,C.classList.add("selected")}function c(e,t,o,n){n===void 0&&(n=`${e}-${o}`);let r=document.createElement(t);return r.id=o,r.dataset.name=n,r.dataset.type=e,r}var O={};f(O,{children:()=>ye,parents:()=>Ee,predecessors:()=>he,realElement:()=>ge,successors:()=>be});function ge(){return c("container","div",l())}var he=[],be=[],Ee=[],ye=[];var D={};f(D,{children:()=>ke,parents:()=>Le,predecessors:()=>xe,realElement:()=>ve,successors:()=>we});function ve(){let e=c("paragraph","p",l());return e.contentEditable="true",e}var xe=[],we=[],Le=[],ke=["text","formula"];var P={};f(P,{children:()=>Ne,parents:()=>Be,predecessors:()=>Ce,realElement:()=>Ie,successors:()=>Te});function Ie(){return c("formula","span",l())}var Ce=[],Te=[],Be=[],Ne=[];var _={};f(_,{children:()=>Oe,parents:()=>$e,predecessors:()=>Re,realElement:()=>Ae,successors:()=>Se});function Ae(){let e=c("text","span",l());return e.contentEditable="true",e}var Re=[],Se=[],$e=[],Oe=[];var M={};f(M,{children:()=>He,parents:()=>Me,predecessors:()=>Pe,realElement:()=>De,successors:()=>_e});function De(){let e=document.createElement("input");return e.type="text",e.id=l(),e.dataset.name=`short-text-input-${e.id}`,e.dataset.type="short-text-input",e}var Pe=[],_e=[],Me=[],He=[];var H={};f(H,{children:()=>qe,parents:()=>We,predecessors:()=>ze,realElement:()=>je,successors:()=>Fe});function je(){let e=l();return c("multipleChoiceInput","ol",e,`multipleChoice-${e}`)}var ze=[],Fe=[],We=[],qe=["multipleChoiceItem"];var j={};f(j,{children:()=>Xe,parents:()=>Ge,predecessors:()=>Je,realElement:()=>Ue,successors:()=>Ve});function Ue(){let e=document.createElement("li");e.dataset.type="multiple-choice-item",e.id=l(),e.dataset.name=`item-${e.id}`;let t=document.createElement("input");return t.type="checkbox",t.id=l(),e.appendChild(t),e}var Je=[],Ve=[],Ge=[],Xe=["multiple-choice-item"];var z={};f(z,{children:()=>et,parents:()=>Ze,predecessors:()=>Qe,realElement:()=>Ke,successors:()=>Ye});function Ke(){return c("browserSim","browserSim",l())}var Qe=[],Ye=[],Ze=[],et=["browserPage"];var F={};f(F,{children:()=>it,parents:()=>ot,predecessors:()=>nt,realElement:()=>tt,successors:()=>rt});function tt(){return c("browserPage","browserPage",l())}var nt=[],rt=[],ot=[],it=[];var W={};f(W,{children:()=>dt,parents:()=>ct,predecessors:()=>at,realElement:()=>st,successors:()=>lt});function st(){return c("browserLink","browserLink",l())}var at=[],lt=[],ct=[],dt=["text","image"];function E(e){let t=e.dataset.type;if(t===void 0)throw TypeError(`Unknown element type ${t}`);let o=e.id,n=e.dataset.name,r=[];for(let m of e.children){let h=E(m);h&&r.push(h)}let i=document.createElement("div");i.innerHTML=r.length===0?`<div class="list" tabindex="0" data-id="${o}" data-type="${t}"><span data-type="${t}">${n}</span></div>`:`<details open class="list" tabindex="0" data-id="${o}" data-type="${t}"><summary data-type="${t}">${n}</summary></details>`;let d=i.firstChild;for(let m of r)d.appendChild(m);return d}var v={container:O,paragraph:D,formula:P,text:_,shortTextInput:M,multipleChoiceInput:H,multipleChoiceItem:j,browserSim:z,browserPage:F,browserLink:W,table:{children:["table-body","table-head","table-foot"],realElement(){return c("table","table",l())}},"table-head":{children:["table-row"],realElement(){return c("table-head","thead",l())}},"table-body":{children:["table-row"],realElement(){return c("table-body","tbody",l())}},"table-foot":{children:["table-row"],realElement(){return c("table-foot","tfoot",l())}},"table-row":{children:["table-data"],realElement(){let e=l();return c("table-row","tr",e,`row-${e}`)}},"table-data":{children:[],realElement(){let e=l();return c("table-data","td",e,`cell-${e}`)}}};console.log(v);var ne={multipleChoiceInput:e=>{let t={options:[],correct:[]};for(let o of e.children){let n=o.children[0];t.options.push(n.id),t.correct.push(n.checked)}return t},shortTextInput:e=>({correct:e.value})},q;function re(e){if(e.dataset.type!==void 0&&ne[e.dataset.type]!==void 0){let t=ne[e.dataset.type];q[e.id]=t(e);return}for(let t of e.children)re(t)}function oe(){return q={},re(u),q}var ie={testName:void 0,addInteraction(e){},export(){let e=r=>{r.classList.remove("current"),r.className===""&&r.removeAttribute("class");for(let i of r.children)e(i)},t=u.cloneNode(!0);e(t);let o=t.innerHTML.trim().replaceAll(/[\s\t][\s\t]+/g,"").replaceAll(' contenteditable="true"',""),n=oe();return localStorage.setItem("test",JSON.stringify({html:o,gradingScheme:n})),{html:o,gradingScheme:n}},load({content:e,gradingScheme:t}){let o=JSON.parse(window.localStorage.getItem("test"));e=o.html,t=o.gradingScheme,u.innerHTML=e;for(let n of u.getElementsByTagName("p"))n.contentEditable="true";for(let n of u.getElementsByTagName("span"))n.contentEditable="true";for(let n of Object.keys(t))document.getElementById(n).value=t[n].correct;y.innerHTML="",y.appendChild(E(u.firstElementChild)),w(u.firstElementChild)},changeName(e){}};document.getElementById("load-test").addEventListener("click",e=>{ie.load({})});document.getElementById("save-test").addEventListener("click",e=>{ie.export()});var U,S;function mt(){let t=v["container"].realElement();u.appendChild(t),y.appendChild(E(t));let o=!1;y.addEventListener("click",n=>{p()!==void 0&&(p().contains(n.target)||B(),o||n.preventDefault(),o=!0)},!0),y.addEventListener("contextmenu",n=>{let r=n.target;if(n.preventDefault(),r.classList.contains("list"))R(r);else if(r.parentElement.classList.contains("list"))R(r.parentElement);else return;n.stopPropagation();let i=["rcm-add-child","rcm-add-sibbling","rcm-copy","rcm-delete","rcm-rename"];S!==void 0&&(i.push("rcm-paste-child"),i.push("rcm-paste-above")),N(x.rightClick,i,r)},!0),y.addEventListener("focus",n=>{let r=n.target;r.classList.contains("list")||(r=r.parentElement),r.classList.contains("list")&&(te(r),o=!1)},!0),document.getElementById("rcm-add-child").addEventListener("click",n=>{U=pt;let r=v[p().dataset.type].children;N(x.element,r,n.target)},!1),document.getElementById("rcm-add-sibbling").addEventListener("click",n=>{U=ut;let r=v[p().parentElement.dataset.type].children;N(x.element,r,n.target)},!1),document.getElementById("rcm-copy").addEventListener("click",n=>{let r=p().dataset.id;S=document.getElementById(r),T()},!1),document.getElementById("rcm-paste-child").addEventListener("click",n=>{let r=$(S);s().appendChild(r),p().parentElement.replaceChild(E(s()),p()),T()},!1),document.getElementById("rcm-paste-above").addEventListener("click",n=>{let r=$(S);s().parentElement.insertBefore(r,s());let i=E(s().parentElement);p().parentElement.parentElement.replaceChild(i,p().parentElement),T()},!1),document.getElementById("rcm-delete").addEventListener("click",n=>{let r=p().dataset.id;p().remove(),B(),document.getElementById(r).remove(),T()},!1),document.getElementById("rcm-rename").addEventListener("click",n=>{let r=p().dataset.id,i=p().firstChild,d=i.innerText,m=document.createElement("input");m.type="text",m.value=d,p().insertBefore(m,i),i.remove(),m.focus(),m.addEventListener("blur",h=>{m.contains(h.relatedTarget)||(i.innerText=m.value,document.getElementById(r).dataset.name=m.value,p().insertBefore(i,m),m.remove())}),m.addEventListener("click",h=>{h.stopPropagation()}),m.addEventListener("keyup",h=>{(h.key==="Enter"||h.key==="Escape")&&m.blur()}),i.remove()},!1);for(let n of Object.keys(v)){let r=document.getElementById(n);r&&r.addEventListener("click",i=>{U(p(),n),B()})}k()}mt();function pt(e,t){let o=e.dataset.id,n=document.getElementById(o),r=v[t].realElement(o);n.appendChild(r),e.parentElement.replaceChild(E(n),e)}function ut(e,t){let o=e.dataset.id,n=document.getElementById(o),r=n.parentElement,i=r.id,d=v[t].realElement(i);r.insertBefore(d,n),e.parentElement.insertBefore(E(d),e)}
