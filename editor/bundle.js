var jt=Object.defineProperty;var m=(e,t)=>{for(var n in t)jt(e,n,{get:t[n],enumerable:!0})};var w=function(e){return e[e.rightClick=0]="rightClick",e[e.element=1]="element",e[e.preset=2]="preset",e}({}),B=[document.getElementById("left-pane-right-click-menu"),document.getElementById("element-menu"),document.getElementById("preset-menu")],Dt={[w.element]:w.rightClick,[w.preset]:w.rightClick},Ze;function R(){for(let e of B)e.style.visibility="hidden"}function Pt(e,t){let n=t.getBoundingClientRect();B[e].style.top=`${n.top}px`,B[e].style.left=`calc(${n.right}px + 0.25rem)`,B[e].style.visibility="visible",Ze=e}function D(e,t,n){if(t.length>0)for(let o of B[e].children)o.disabled=!t.includes(o.id);else{console.error("requested to open a menu with 0 options.");for(let o of B[e].children)o.disabled=!1}Pt(e,n)}document.addEventListener("click",function(e){let t=[],n=Ze;for(;n!==void 0;)t.push(n),n=Dt[n];let o;for(let r=0;r<3;r++)if(B[r].contains(e.target)){o=r;break}for(;t.length>0&&t[t.length-1]!==o;)t.pop();for(let r=0;r<3;r++)t.includes(r)||(B[r].style.visibility="hidden")});var P={};m(P,{attributes:()=>et,initializeToolbar:()=>_t,realElement:()=>$,showToolbar:()=>Ft});function s(e,t,n,o){o===void 0&&(o=`${e}-${n}`);let r=document.createElement(t);return r.id=n,r.dataset.name=o,r.dataset.type=e,r}function $(){let e=l();return s("container","div",e,`\u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8 (${e})`)}var h={},Y=e=>document.getElementById(e);function _t(){h.layout=Y("container-toolbar-layout"),h.padding=Y("container-toolbar-padding"),h.border=Y("container-toolbar-border"),h.align=Y("container-toolbar-align"),h.layout.addEventListener("change",()=>{i().dataset.layout=h.layout.value}),h.padding.addEventListener("change",()=>{i().style.padding=h.padding.value+"px"}),h.border.addEventListener("change",()=>{i().dataset.border=h.border.value}),h.align.addEventListener("change",()=>{i().dataset.align=h.align.value})}function Ft(e){let t=et(e);for(let[n,o]of Object.entries(t))h[n].value=o}function et(e){return{layout:e.dataset.layout??"",padding:(e.style.padding??"0  ").slice(0,-2),border:e.dataset.border??"",align:e.dataset.align??""}}var _={};m(_,{attributes:()=>nt,children:()=>Mt,initializeToolbar:()=>Ut,mounted:()=>Ht,realElement:()=>N,showToolbar:()=>qt});var tt=[];function Z(e){let t=e.parentElement;for(;t.id!=="main-content";){if(tt.includes(t.id))return;t=t.parentElement}tt.push(e.id),e.contentEditable="true",console.log(`making ${e} contenteditable;`)}function N(){let e=l();return s("paragraph","p",e,`\u10DE\u10D0\u10E0\u10D0\u10D2\u10E0\u10D0\u10E4\u10D8 (${e})`)}function Ht(e){Z(e)}var Mt=["text","formula"],g={},J=e=>document.getElementById(e);function Ut(){g["line-height"]=J("paragraph-toolbar-line-height"),g["first-line-indent"]=J("paragraph-toolbar-first-line-indent"),g["spacing-above"]=J("paragraph-toolbar-spacing-above"),g["spacing-below"]=J("paragraph-toolbar-spacing-below"),g.align=J("paragraph-toolbar-align"),g["line-height"].addEventListener("change",()=>{i().style.lineHeight=g["line-height"].value+"%"}),g["first-line-indent"].addEventListener("change",()=>{i().style.textIndent=g["first-line-indent"].value+"%"}),g["spacing-above"].addEventListener("change",()=>{i().style.marginTop=g["spacing-above"].value+"rem"}),g["spacing-below"].addEventListener("change",()=>{i().style.marginBottom=g["spacing-below"].value+"rem"}),g.align.addEventListener("change",()=>{i().style.textAlign=g.align.value})}function qt(e){let t=nt(e);for(let[n,o]of Object.entries(t))g[n].value=o}function nt(e){return{"line-height":(e.style.lineHeight??"%").slice(0,-1),"first-line-indent":(e.style.lineHeight??"%").slice(0,-1),"spacing-above":(e.style.marginTop??"rem").slice(0,-2),"spacing-below":(e.style.marginBottom??"rem").slice(0,-2),align:e.style.textAlign??"left"}}var Ee={};m(Ee,{attributes:()=>ot,initializeToolbar:()=>Gt,realElement:()=>Jt,showToolbar:()=>Vt});function Jt(){let e=l();return s("formula","span",e,`\u10E4\u10DD\u10E0\u10DB\u10E3\u10DA\u10D0 (${e})`)}var W={},Wt=e=>document.getElementById(e);function Gt(){W.content=Wt("formula-toolbar-content"),W.content.addEventListener("keyup",()=>{i().dataset.content=W.content.value;let e=MathJax.tex2mml(W.content.value);i().innerHTML=e,i().firstChild.setAttribute("display","inline")})}function Vt(e){let t=ot(e);for(let[n,o]of Object.entries(t))W[n].value=o}function ot(e){return{content:e.dataset.content??""}}var ee={};m(ee,{attributes:()=>rt,initializeToolbar:()=>Xt,mounted:()=>Qt,realElement:()=>xe,showToolbar:()=>Kt});function xe(){let e=l();return s("text","span",e,`\u10E2\u10D4\u10E5\u10E1\u10E2\u10D8 (${e})`)}function Qt(e){Z(e)}var p={},F=e=>document.getElementById(e);function Xt(){p.content=F("text-toolbar-content"),p.color=F("text-toolbar-color"),p.bold=F("text-toolbar-bold"),p.italic=F("text-toolbar-italic"),p.underline=F("text-toolbar-underline"),p.size=F("text-toolbar-size"),console.log("but whyyyy"),p.content.addEventListener("keyup",()=>{i().innerText=p.content.value;let e="(T) "+p.content.value.slice(0,20);p.content.value.length>20&&(e+="..."),i().dataset.name=e,d().firstChild.innerText=e},!1),p.color.addEventListener("change",()=>{i().style.color=p.color.value},!1),p.bold.addEventListener("change",()=>{i().style.fontWeight=p.bold.checked?"bold":"normal"},!1),p.italic.addEventListener("change",()=>{i().style.fontStyle=p.italic.checked?"oblique":"normal"},!1),p.underline.addEventListener("change",()=>{i().style.textDecoration=p.underline.checked?"underline":"none"},!1),p.size.addEventListener("change",()=>{i().style.fontSize=p.size.value+"pt"},!1)}function Kt(e){let t=rt(e);console.log(t,p);for(let[n,o]of Object.entries(t))p[n].value=o}function rt(e){return{content:e.innerText,color:e.style.color??"black",bold:String(e.style.fontWeight==="bold"),italic:String(e.style.fontStyle==="oblique"),underline:String(e.style.textDecoration==="underline"),size:(e.style.fontSize??"12pt").slice(0,-2)}}var we={};m(we,{attributes:()=>it,initializeToolbar:()=>Zt,realElement:()=>Yt,showToolbar:()=>en});function Yt(){let e=l();return s("heading","h1",e,`\u10E1\u10D0\u10D7\u10D0\u10E3\u10E0\u10D8 (${e})`)}var y={},ve=e=>document.getElementById(e);function Zt(){y.level=ve("heading-toolbar-level"),y.content=ve("heading-toolbar-content"),y.align=ve("heading-toolbar-align"),y.content.addEventListener("keyup",()=>{i().innerText=y.content.value;let e="(H) "+y.content.value.slice(0,20);y.content.value.length>20&&(e+="..."),i().dataset.name=e,d().firstChild.innerText=e},!1),y.level.addEventListener("change",()=>{let e=i(),t=document.createElement(`h${y.level.value}`);t.id=e.id,t.textContent=e.textContent,t.style.textAlign=e.style.textAlign,t.dataset.type=e.dataset.type,t.dataset.name=e.dataset.name,e.replaceWith(t),ke(t)}),y.align.addEventListener("change",()=>{i().style.textAlign=y.align.value})}function en(e){let t=it(e);for(let[n,o]of Object.entries(t))y[n].value=o}function it(e){return{content:e.innerText,level:e.tagName.slice(1),align:e.style.textAlign??"center"}}var ne={};m(ne,{attributes:()=>at,initializeToolbar:()=>nn,realElement:()=>Ce,showToolbar:()=>on});function Ce(){let e=document.createElement("input");return e.type="text",e.id=l(),e.dataset.name=`\u10DB\u10DD\u10D9\u10DA\u10D4 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="shortTextInput",e}var te={},tn=e=>document.getElementById(e);function nn(){te.width=tn("shortTextInput-toolbar-width"),te.width.addEventListener("change",()=>{i().style.width=te.width.value+"ch"})}function on(e){let t=at(e);for(let[n,o]of Object.entries(t))te[n].value=o}function at(e){return{width:e.style.width.slice(0,-2)}}var Ie={};m(Ie,{attributes:()=>lt,initializeToolbar:()=>ln,realElement:()=>rn,showToolbar:()=>sn});function rn(){let e=document.createElement("textarea");return e.id=l(),e.dataset.name=`\u10D2\u10E0\u10EB\u10D4\u10DA\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="longTextInput",e}var oe={},an=e=>document.getElementById(e);function ln(){oe.width=an("longTextInput-toolbar-width"),oe.width.addEventListener("change",()=>{i().cols=Number(oe.width.value)})}function sn(e){let t=lt(e);for(let[n,o]of Object.entries(t))oe[n].value=o}function lt(e){return{width:String(e.cols)}}var ie={};m(ie,{attributes:()=>st,children:()=>cn,initializeToolbar:()=>dn,realElement:()=>Te,showToolbar:()=>pn});function Te(){let e=l();return s("multipleChoiceInput","ol",e,`\u10DB\u10E0\u10D0\u10D5\u10D0\u10DA\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var cn=["multipleChoiceItem"],re={};function dn(){re.numbering=document.getElementById("multipleChoiceInput-toolbar-numbering"),re.numbering.addEventListener("change",()=>{i().dataset.numbering=re.numbering.value})}function pn(e){let t=st(e);for(let[n,o]of Object.entries(t))re[n].value=o}function st(e){return{numbering:e.dataset.numbering??"letters"}}var ae={};m(ae,{attributes:()=>fn,initializeToolbar:()=>un,parents:()=>mn,realElement:()=>H,showToolbar:()=>gn});function H(){let e=document.createElement("li");e.dataset.type="multipleChoiceItem",e.id=l(),e.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${e.id})`;let t=document.createElement("input");return t.type="checkbox",t.id=l(),e.appendChild(t),e}var mn=["multipleChoiceInput"];function un(){}function gn(e){}function fn(e){return{}}var se={};m(se,{attributes:()=>ct,children:()=>hn,initializeToolbar:()=>bn,realElement:()=>Le,showToolbar:()=>yn});function Le(){let e=l();return s("singleChoiceInput","ol",e,`\u10D4\u10E0\u10D7\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var hn=["singleChoiceItem"],le={};function bn(){le.numbering=document.getElementById("singleChoiceInput-toolbar-numbering"),le.numbering.addEventListener("change",()=>{i().dataset.numbering=le.numbering.value})}function yn(e){let t=ct(e);for(let[n,o]of Object.entries(t))le[n].value=o}function ct(e){return{numbering:e.dataset.numbering??"letters"}}var ce={};m(ce,{attributes:()=>wn,initializeToolbar:()=>xn,parents:()=>En,realElement:()=>Be,showToolbar:()=>vn});function Be(e){let t=document.createElement("li");t.dataset.type="singleChoiceItem",t.id=l(),t.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${t.id})`;let n=document.createElement("input");return n.type="radio",n.id=l(),n.name=e,t.appendChild(n),t}var En=["singleChoiceInput"];function xn(){}function vn(e){}function wn(e){return{}}var Se={};m(Se,{attributes:()=>Ln,children:()=>Cn,initializeToolbar:()=>In,realElement:()=>kn,showToolbar:()=>Tn});function kn(){let e=l();return s("browserSim","browser-sim",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10E1\u10D8\u10DB\u10E3\u10DA\u10D0\u10E2\u10DD\u10E0\u10D8 (${e})`)}var Cn=["browserPage"];function In(){}function Tn(e){}function Ln(e){return{}}var $e={};m($e,{attributes:()=>dt,initializeToolbar:()=>Rn,parents:()=>Sn,realElement:()=>Bn,showToolbar:()=>$n});function Bn(){let e=l(),t=s("browserPage","browser-page",e,`\u10D2\u10D5\u10D4\u10E0\u10D3\u10D8 (${e})`);return t.setAttribute("closable","true"),t}var Sn=["browserSim"],k={},Re=e=>document.getElementById(e);function Rn(){k.closable=Re("browserPage-toolbar-closable"),k.title=Re("browserPage-toolbar-title"),k.url=Re("browserPage-toolbar-url"),k.closable.addEventListener("change",()=>{i().setAttribute("closable",String(k.closable.checked))}),k.title.addEventListener("keyup",()=>{i().setAttribute("title",k.title.value)}),k.url.addEventListener("keyup",()=>{i().setAttribute("url",k.url.value)})}function $n(e){let t=dt(e);for(let[n,o]of Object.entries(t))k[n].value=o}function dt(e){return{closable:e.getAttribute("closable")??"true",title:e.getAttribute("title")??"",url:e.getAttribute("url")??e.id}}var Ne={};m(Ne,{attributes:()=>mt,children:()=>On,initializeToolbar:()=>zn,realElement:()=>Nn,showToolbar:()=>An});function Nn(){let e=l();return s("browserLink","browser-link",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10DA\u10D8\u10DC\u10D9\u10D8 (${e})`)}var On=["text","image"],O={},pt=e=>document.getElementById(e);function zn(){O.browser=pt("browserLink-toolbar-browser"),O.url=pt("browserLink-toolbar-url"),O.browser.addEventListener("change",()=>{i().setAttribute("browser",O.browser.value)}),O.url.addEventListener("change",()=>{i().setAttribute("url",O.url.value)})}function An(e){let t=mt(e);for(let[n,o]of Object.entries(t))O[n].value=o}function mt(e){return{browser:e.getAttribute("browser")??"",url:e.getAttribute("to")??""}}var De={};m(De,{attributes:()=>ut,children:()=>qn,initializeToolbar:()=>Gn,realElement:()=>Un,showToolbar:()=>Vn});var ze={};m(ze,{attributes:()=>_n,children:()=>jn,initializeToolbar:()=>Dn,realElement:()=>Oe,showToolbar:()=>Pn});function Oe(){let e=l();return s("tableRow","tr",e,"\u10E1\u10E2\u10E0\u10D8\u10E5\u10DD\u10DC\u10D8")}var jn=[];function Dn(){}function Pn(e){}function _n(e){return{}}var Ae={};m(Ae,{attributes:()=>Mn,initializeToolbar:()=>Fn,realElement:()=>de,showToolbar:()=>Hn});function de(){let e=l();return s("tableElement","td",e,"\u10D4\u10DA\u10D4\u10DB\u10D4\u10DC\u10E2\u10D8")}function Fn(){}function Hn(e){}function Mn(e){return{}}function Un(){let e=l(),t=s("table","table",e,`\u10EA\u10EE\u10E0\u10D8\u10DA\u10D8 (${e})`);return t.appendChild(Oe()),t.lastChild.appendChild(de()),t}var qn=[];function Jn(e,t){let n=e.children.length;if(n<t)for(let o=0;o<t-n;o++){let r=G(e.lastChild);e.appendChild(r)}else if(n>t)for(;e.children.length>t;)e.lastChild.remove();e.dataset.rows=String(t),Pe(e)}function Wn(e,t){let n=e.firstChild.children.length;for(let o of e.children)if(n<t)for(let r=0;r<t-n;r++)o.appendChild(de());else for(;o.children.length;)o.lastChild.remove();e.dataset.cols=String(t),Pe(e)}var x={},je=e=>document.getElementById(e);function Gn(){x.style=je("table-toolbar-style"),x.rows=je("table-toolbar-rows"),x.cols=je("table-toolbar-cols"),x.style.addEventListener("change",()=>{i().dataset.style=x.style.value}),x.rows.addEventListener("change",()=>{let e=i();Jn(e,Number(x.rows.value))}),x.cols.addEventListener("change",()=>{let e=i();Wn(e,Number(x.cols.value))})}function Vn(e){let t=ut(e);console.log(x,t);for(let[n,o]of Object.entries(t))x[n].value=o}function ut(e){return{style:e.dataset.style||"empty",rows:e.dataset.rows||"1",cols:e.dataset.cols||"1"}}var He={};m(He,{attributes:()=>Et,initializeToolbar:()=>Kn,realElement:()=>Xn,showToolbar:()=>Yn});var Qn={Authorization:"Bearer "+(localStorage.getItem("authToken")??"")};function pe(){return Qn}var me="https://terryapi.dimitri.ge/api";async function gt(e){let t=await fetch(`${me}/test/${e}`,{headers:pe()});if(!t.ok)throw new Error(t.statusText);let n=await t.json();return{id:e,...n}}function ft(e,t){return console.log("trying to upload",t,"for test",e),fetch(`${me}/test/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",...pe()},body:JSON.stringify({...t,gradingScheme:JSON.stringify(t.gradingScheme)})})}function _e(e,t){return`${me}/image/${e}/${t}`}async function ht(e,t,n){let o=new FormData;return o.append("image",n),(await fetch(_e(e,t),{method:"POST",headers:{...pe()},body:o})).ok}var L;async function bt(e,t){L=e,localStorage.setItem("currentFile",JSON.stringify(e)),t!==void 0&&await ft(t,e)}async function yt(e){if(e!==void 0)try{return L=await gt(e),L}catch(n){console.log(n)}let t=localStorage.getItem("currentFile");return t!=null?L=JSON.parse(t):L={content:'<div data-type="container" data-name="\u10DB\u10D7\u10D0\u10D5\u10D0\u10E0\u10D8 \u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8" id="0" data-pages="1"></div>'},L}function Xn(){let e=l();return s("image","img",e,`\u10E1\u10E3\u10E0\u10D0\u10D7\u10D8 (${e})`)}var C={},Fe=e=>document.getElementById(e);function Kn(){C.image=Fe("image-toolbar-image"),C.width=Fe("image-toolbar-width"),C.float=Fe("image-toolbar-float"),C.image.addEventListener("change",async e=>{let t=e.target.files,n=t[0];if(await ht(L.id,n.name,n))i().src=_e(L.id,n.name);else{let o=new FileReader;o.onload=r=>{i().src=r.target.result},o.readAsDataURL(e.target.files[0])}console.log(t)}),C.width.addEventListener("change",()=>{i().style.width=`${C.width.value}px`}),C.float.addEventListener("change",()=>{i().style.float=C.float.value})}function Yn(e){let t=Et(e);for(let[n,o]of Object.entries(t))C[n]&&(C[n].value=o)}function Et(e){return{url:e.src??"",width:(e.style.width??"100px").slice(0,-2),float:e.style.float??"left"}}function v(e){let t=e.dataset.type,n=e.id,o=e.dataset.name,r=[];for(let a of e.children){let c=v(a);c&&(c instanceof HTMLElement?r.push(c):r.push(...c))}if(t!==void 0){let a=document.createElement("div");a.innerHTML=r.length===0?`<div class="list" tabindex="0" data-id="${n}" data-type="${t}"><span data-type="${t}">${o}</span></div>`:`<details open class="list" tabindex="0" data-id="${n}" data-type="${t}"><summary data-type="${t}">${o}</summary></details>`;let c=a.firstChild;for(let K of r)c.appendChild(K);return c}else return r}var u={container:P,paragraph:_,formula:Ee,text:ee,shortTextInput:ne,multipleChoiceInput:ie,multipleChoiceItem:ae,singleChoiceInput:se,singleChoiceItem:ce,browserSim:Se,browserPage:$e,browserLink:Ne,table:De,tableRow:ze,tableElement:Ae,image:He,longTextInput:Ie,heading:we};console.log(u);function xt(){console.log("hello");for(let{initializeToolbar:e}of Object.values(u))e&&e()}function Me(e){let t=[];console.log(e.dataset.type),console.log(u);for(let n of Object.keys(u)){let o=!0;u[e.dataset.type].children!==void 0&&(o&&=u[e.dataset.type].children.includes(n)),u[n].parents!==void 0&&(o&&=u[n].parents.includes(e.dataset.type)),o&&t.push(n)}return console.log(t),t}var Zn=document.getElementById("page-buttons"),vt=document.getElementById("add-page"),ge=0,b=0,I=[],wt=[];function ue(){let e=document.createElement("input");e.type="radio",e.id=`page-${b+1}`,e.name="current-page";let t=b;e.addEventListener("change",()=>{kt(t)});let n=document.createElement("label");n.innerText=String(b+1),n.appendChild(e),Zn.insertBefore(n,vt),wt.push(n),I.push([]),b+=1,f.firstElementChild.dataset.pages=String(b)}function eo(){for(let e of I[ge])e.classList.remove("current")}function kt(e){if(e<b&&e>=0){console.log(I[e]),eo(),ge=e;for(let t of I[ge])t.classList.add("current")}}function z(e){switch(e.dataset.visibilityType??"always"){case"only":{let n=Number(e.dataset.visibleOnlyOn??"1");for(;n>b;)ue();It(e,n);break}case"range":{let n=Number(e.dataset.visibleFrom??"1"),o=Number(e.dataset.visibleTo??"1");for(;n>b;)ue();for(;o>b;)ue();no(e,n,o);break}}for(let n of e.children)z(n);to()}function Ct(e,t,n){for(let o=0;o<b;o++)if(o<t||o>n){let r=I[o].indexOf(e);r>=0&&I[o].splice(r,1)}}function to(){for(let e=b-1;e>0&&!(I[e].length>0);e--)I.pop(),wt.pop().remove(),b--}function It(e,t,n=!0){t-=1,t<b&&t>=0&&(I[t].includes(e)||I[t].push(e),n&&Ct(e,t,t),t===ge&&kt(t))}function no(e,t,n){for(let o=t;o<=n;o++)It(e,o,!1);Ct(e,t-1,n-1)}vt.addEventListener("click",()=>{ue()});var Lt={general:["visibility-type","visible-only-on","visible-from","visible-to"]},oo={general:e=>{let t={"visibility-type":e.dataset.visibilityType||"always"};switch(t["visibility-type"]){case"only":t["visible-only-on"]=e.dataset.visibleOnlyOn||"1";break;case"range":t["visible-from"]=e.dataset.visibleFrom||"1",t["visible-to"]=e.dataset.visibleTo||"1";break}return t}},E={};for(let e of Object.keys(Lt)){let t={};for(let n of Lt[e]){let o=document.getElementById(`${e}-toolbar-${n}`);console.log(e,n),t[n]={element:o,addEventListener:o.addEventListener,set value(r){if(o.nodeName==="INPUT"){let a=o;switch(a.type){case"text":case"number":a.value=r;break;case"checkbox":a.checked=r}}(o.nodeName==="SELECT"||o.nodeName==="TEXTAREA")&&(o.value=r),this.setTrigger(r)},setTrigger(r){}}}E[e]=t}var Bt={_elements:{},_current:void 0,show(e){this._current&&this._current.classList.remove("current");let t=e.dataset.type;if(this._elements[t]===void 0&&(this._elements[t]=document.getElementById(`${t}-toolbar`)),this._current=this._elements[t],t==="browserLink"){let r=function(a){a.tagName==="BROWSER-SIM"&&(o[a.dataset.name]=a.id),a.tagName==="BROWSER-PAGE"&&n.push(a.getAttribute("url"));for(let c of a.children)r(c)},n=[],o={};r(f),E.browserLink.url.element.innerHTML="",E.browserLink.browser.element.innerHTML="";for(let a of n){let c=document.createElement("option");c.value=a,c.innerText=a,E.browserLink.url.element.appendChild(c)}for(let a of Object.keys(o)){let c=document.createElement("option");c.value=o[a],c.innerText=a,E.browserLink.browser.element.appendChild(c)}}if(this._current){this._current.classList.add("current"),u[t].showToolbar(e);let n=oo.general(e);for(let o of Object.keys(n))E.general[o].value=n[o]}},hide(){this._current&&(this._current.classlist.remove("current"),this._current=void 0)}};function ro(){E.general["visibility-type"].setTrigger=e=>{Ue.dataset.visibilityType=e},E.general["visibility-type"].element.addEventListener("change",e=>{E.general["visibility-type"].setTrigger(e.target.value),i().dataset.visibilityType=e.target.value}),E.general["visible-only-on"].element.addEventListener("change",e=>{i().dataset.visibleOnlyOn=e.target.value,z(i())}),E.general["visible-from"].element.addEventListener("change",e=>{i().dataset.visibleFrom=e.target.value,z(i())}),E.general["visible-to"].element.addEventListener("change",e=>{i().dataset.visibleTo=e.target.value,z(i())})}ro();var qe=0;function l(){return String(qe++)}function Je(e){let t=Number(e.id);t>=qe&&(qe=t+1);for(let n of e.children)Je(n)}function G(e){let t=e.cloneNode(!0);function n(o){o.id=l();for(let r of o.children)n(r)}return n(t),t}var A;function d(){return A}function j(){Rt(),A&&(A.blur(),A.removeAttribute("id")),A=void 0}function fe(e){j(),A=e,A.setAttribute("id","selected");let t=document.getElementById(e.dataset.id);ke(t),Bt.show(t)}function St(e){fe(e)}function Pe(e){let t=e.id,n=S.querySelector(`[data-id="${t}"]`);n.parentElement.replaceChild(v(e),n)}var M;function i(){return M}function Rt(){M&&M.classList.remove("selected"),M=void 0}function ke(e){Rt(),M=e,M.classList.add("selected")}var We={multipleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},singleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},shortTextInput:e=>({correct:e.value})};var Ge;function $t(){Ge={};for(let e of Object.keys(We))for(let t of f.querySelectorAll(`[data-type=${e}]`))console.log("extracted",We[e](t)),Ge[t.id]=We[e](t);return Ge}var he=class{#n=100;#t=[];#e=-1;update(t){this.#t.splice(0,this.#e,t),this.#t.length>=this.#n&&this.#t.splice(this.#n),this.#e=-1,console.log(this.#t)}canGoBack(){return this.#e<this.#t.length-1}goBack(){return this.#e+=1,console.log("returning version",this.#e),this.#t[this.#e]}canGoForward(){return this.#e>0}goForward(){return this.#e-=1,console.log("returning version",this.#e),this.#t[this.#e]}};var Nt=document.getElementById("test-name"),io=window.location.search,ao=new URLSearchParams(io),Ot=ao.get("id"),zt=e=>{e.classList.remove("selected"),e.className===""&&e.removeAttribute("class");for(let t of e.children)zt(t)},Ve=class{get content(){let t=f.cloneNode(!0);return zt(t),t.innerHTML.trim().replaceAll(/[\s\t][\s\t]+/g,"").replaceAll(' contenteditable="true"',"")}get gradingScheme(){return JSON.stringify($t())}get name(){return Nt.value}export(){return{content:this.content,gradingScheme:this.gradingScheme,name:this.name}}load({name:t,content:n,gradingScheme:o}){f.innerHTML=n;for(let r of f.getElementsByTagName("p"))r.contentEditable="true";for(let r of f.getElementsByTagName("span"))r.contentEditable="true";if(Je(f.firstChild),o){let r=JSON.parse(o);for(let a of Object.keys(r))document.getElementById(a).value=r[a].correct}S.innerHTML="",S.appendChild(v(f.firstElementChild)),z(f.firstElementChild),t&&(Nt.value=t)}},U=new he;document.getElementById("undo").addEventListener("click",()=>{if(U.canGoBack()){let e=U.goBack();V.load(e)}else console.log("can't go back anymore")});document.getElementById("redo").addEventListener("click",()=>{if(U.canGoForward()){let e=U.goForward();V.load(e)}else console.log("can't go forward anymore")});function T(){U.update(V.export())}var V=new Ve;document.getElementById("save-test").addEventListener("click",async()=>{await bt(V.export(),Ot??void 0)});addEventListener("beforeunload",e=>e.preventDefault());async function lo(){let e=await yt(Ot);V.load(e),U.update(e)}lo();var S=document.getElementById("tree-view"),f=document.getElementById("main-content"),Ue=document.getElementById("right-pane"),Qe=!1;S.addEventListener("click",e=>{d()!==void 0&&(d().contains(e.target)||j(),Qe||e.preventDefault(),Qe=!0)},!0);S.addEventListener("contextmenu",e=>{let t=e.target;if(e.preventDefault(),t.classList.contains("list"))fe(t);else if(t.parentElement.classList.contains("list"))fe(t.parentElement);else return;e.stopPropagation();let n=["rcm-add-child","rcm-add-preset","rcm-copy","rcm-delete","rcm-rename"];(t.parentElement.parentElement.parentElement.classList.contains("list")||t.parentElement.parentElement.classList.contains("list"))&&n.push("rcm-add-sibbling"),Q.isCopying()&&(n.push("rcm-paste-child"),t.parentElement?.classList.contains("list")&&n.push("rcm-paste-above")),D(w.rightClick,n,t)},!0);S.addEventListener("focus",e=>{let t=e.target;t.classList.contains("list")||(t=t.parentElement),t.classList.contains("list")&&(St(t),Qe=!1)},!0);Ue.addEventListener("change",()=>{T()});var Xe={};m(Xe,{realElement:()=>so});function so(){let e=$();return e.appendChild(N()),e.appendChild(Ce()),e}var Ke={};m(Ke,{realElement:()=>co});function co(){let e=$();e.appendChild(N());let t=Te();return t.appendChild(H()),t.appendChild(H()),t.appendChild(H()),t.appendChild(H()),e.appendChild(t),e}var Ye={};m(Ye,{realElement:()=>po});function be(e){let t=Be(e),n=xe();return t.append(n),n.innerText=" abc ",t}function po(){let e=$();e.appendChild(N());let t=Le();return t.appendChild(be(t.id)),t.appendChild(be(t.id)),t.appendChild(be(t.id)),t.appendChild(be(t.id)),e.appendChild(t),e}var q={shortTextQuestion:Xe,multipleChoiceQuestion:Ke,singleChoiceQuestion:Ye};function At(){let e=[];for(let t of Object.keys(q))e.push(t);return e}var ye=class{#n;set data(t){this.#n=t}get data(){return this.#n}isCopying(){return this.#n!==void 0}};var X,Q=new ye;function mo(){document.getElementById("rcm-add-child").addEventListener("click",e=>{X=uo,D(w.element,Me(d()),e.target)},!1),document.getElementById("rcm-add-sibbling").addEventListener("click",e=>{X=go,D(w.element,Me(d().parentElement),e.target)},!1),document.getElementById("rcm-add-preset").addEventListener("click",e=>{X=fo,D(w.preset,At(),e.target)},!1),document.getElementById("rcm-copy").addEventListener("click",e=>{let t=d().dataset.id;Q.data=document.getElementById(t),R()},!1),document.getElementById("rcm-paste-child").addEventListener("click",e=>{let t=G(Q.data);i().appendChild(t),d().parentElement.replaceChild(v(i()),d()),R(),T()},!1),document.getElementById("rcm-paste-above").addEventListener("click",e=>{let t=G(Q.data);i().parentElement.insertBefore(t,i());let n=v(i().parentElement);d().parentElement.parentElement.replaceChild(n,d().parentElement),R(),T()},!1),document.getElementById("rcm-delete").addEventListener("click",e=>{let t=d().dataset.id;d().remove(),j(),document.getElementById(t).remove(),R(),T()},!1),document.getElementById("rcm-rename").addEventListener("click",e=>{let t=d().dataset.id,n=d().firstChild,o=n.innerText,r=document.createElement("input");r.type="text",r.value=o,d().insertBefore(r,n),n.remove(),r.focus(),r.addEventListener("blur",a=>{r.contains(a.relatedTarget)||(n.innerText=r.value,document.getElementById(t).dataset.name=r.value,d().insertBefore(n,r),r.remove())}),r.addEventListener("click",a=>{a.stopPropagation()}),r.addEventListener("keyup",a=>{(a.key==="Enter"||a.key==="Escape")&&r.blur()}),n.remove(),T()},!1);for(let e of Object.keys(u)){let t=document.getElementById(e);t&&t.addEventListener("click",()=>{X(d(),e),j(),R()})}for(let e of Object.keys(q)){let t=document.getElementById(e);t&&t.addEventListener("click",()=>{X(d(),e),j(),R()})}xt()}mo();function uo(e,t){let n=e.dataset.id,o=document.getElementById(n),r=u[t].realElement(n);if(o.appendChild(r),u[t].mounted!==void 0&&u[t].mounted(r),e.appendChild(v(r)),e.tagName==="DIV"){let a=document.createElement("details");a.classList.add("list"),a.tabIndex=0,a.dataset.id=n,a.dataset.type=e.dataset.type,a.open=!0;let c=document.createElement("summary");c.dataset.type=e.dataset.type,c.innerText=e.firstChild.innerText,a.appendChild(c);let K=[...e.children].slice(1);console.log(K),a.append(...K),e.replaceWith(a)}T()}function go(e,t){let n=e.dataset.id,o=document.getElementById(n),r=o.parentElement,a=e.parentElement.id,c=u[t].realElement(a);r.insertBefore(c,o),u[t].mounted!==void 0&&u[t].mounted(c),e.parentElement.insertBefore(v(c),e),T()}function fo(e,t){let n=e.dataset.id,o=document.getElementById(n),r=q[t].realElement();o.appendChild(r),q[t].mounted!==void 0&&q[t].mounted(r),e.parentElement.replaceChild(v(o),e),T()}export{Q as copyBuffer};
