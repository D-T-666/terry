var Pe=Object.defineProperty;var p=(e,t)=>{for(var n in t)Pe(e,n,{get:t[n],enumerable:!0})};var h=function(e){return e[e.rightClick=0]="rightClick",e[e.element=1]="element",e[e.preset=2]="preset",e}({}),b=[document.getElementById("left-pane-right-click-menu"),document.getElementById("element-menu"),document.getElementById("preset-menu")],Re={[h.element]:h.rightClick,[h.preset]:h.rightClick},ue;function y(){for(let e of b)e.style.visibility="hidden"}function je(e,t){let n=t.getBoundingClientRect();b[e].style.top=`${n.top}px`,b[e].style.left=`calc(${n.right}px + 0.25rem)`,b[e].style.visibility="visible",ue=e}function A(e,t,n){if(t.length>0)for(let r of b[e].children)r.disabled=!t.includes(r.id);else{console.error("requested to open a menu with 0 options.");for(let r of b[e].children)r.disabled=!1}je(e,n)}document.addEventListener("click",function(e){let t=[],n=ue;for(;n!==void 0;)t.push(n),n=Re[n];let r;for(let o=0;o<3;o++)if(b[o].contains(e.target)){r=o;break}for(;t.length>0&&t[t.length-1]!==r;)t.pop();for(let o=0;o<3;o++)t.includes(o)||(b[o].style.visibility="hidden")});var v=document.getElementById("tree-view"),u=document.getElementById("main-content"),fe=document.getElementById("right-pane");var De=document.getElementById("page-buttons"),ge=document.getElementById("add-page"),j=0,g=0,k=[];function R(){let e=document.createElement("input");e.type="radio",e.id=`page-${g+1}`,e.name="current-page";let t=g;e.addEventListener("change",()=>{he(t)});let n=document.createElement("label");n.innerText=String(g+1),n.appendChild(e),De.insertBefore(n,ge),k.push([]),g+=1,u.firstElementChild.dataset.pages=String(g)}function _e(){for(let e of k[j])e.classList.remove("current")}function he(e){if(e<g&&e>=0){_e(),j=e;for(let t of k[j])t.classList.add("current")}}function x(e){switch(e.dataset.visibilityType||"always"){case"only":let n=Number(e.dataset.visibleOnlyOn||"1");for(;n>g;)R();be(e,n);break;case"range":let r=Number(e.dataset.visibleFrom||"1"),o=Number(e.dataset.visibleTo||"1");for(;r>g;)R();for(;o>g;)R();He(e,r,o);break}for(let n of e.children)x(n)}function Ee(e){for(let t of k){let n=t.indexOf(e);n>=0&&t.splice(n,1)}}function be(e,t,n=!0){t-=1,t<g&&t>=0&&(n&&Ee(e),k[t].includes(e)||k[t].push(e),t===j&&he(t))}function He(e,t,n){Ee(e);for(let r=t;r<=n;r++)be(e,r,!1)}ge.addEventListener("click",()=>{R()});var ve={text:["content","color","bold","italic","underline","size"],paragraph:["line-height","first-line-indent","spacing-above","spacing-below"],container:["layout","padding","border","align"],browserPage:["closable","title","url"],browserLink:["browser","url"],formula:["content"],shortTextInput:["width"],table:["style"],general:["visibility-type","visible-only-on","visible-from","visible-to"]},xe={text:e=>({content:e.innerText,color:e.style.color||"black",bold:e.style.fontWeight==="bold",italic:e.style.fontStyle==="oblique",underline:e.style.textDecoration==="underline",size:(e.style.fontSize||"12pt").slice(0,-2)}),paragraph:e=>({"line-height":e.style.lineHeight.slice(0,-1),"first-line-indent":e.style.lineHeight.slice(0,-1),"spacing-above":e.style.marginTop.slice(0,-2),"spacing-below":e.style.marginBottom.slice(0,-2)}),container:e=>({layout:e.dataset.layout,padding:e.style.padding.slice(0,-2),border:e.dataset.border,align:e.dataset.align}),formula:e=>({content:e.dataset.content}),shortTextInput:e=>({width:e.style.width.slice(0,-2)}),browserLink:e=>({browser:e.getAttribute("browser"),url:e.getAttribute("to")}),browserPage:e=>({closable:e.getAttribute("closable"),title:e.getAttribute("title"),url:e.getAttribute("url")}),table:e=>({style:e.dataset.style||"empty"}),general:e=>{let t={"visibility-type":e.dataset.visibilityType||"always"};switch(t["visibility-type"]){case"only":t["visible-only-on"]=e.dataset.visibleOnlyOn||"1";break;case"range":t["visible-from"]=e.dataset.visibleFrom||"1",t["visible-to"]=e.dataset.visibleTo||"1";break}return t}},s={};for(let e of Object.keys(ve)){let t={};for(let n of ve[e]){let r=document.getElementById(`${e}-toolbar-${n}`);console.log(e,n),t[n]={element:r,addEventListener:r.addEventListener,set value(o){if(r.nodeName==="INPUT"){let i=r;switch(i.type){case"text":case"number":i.value=o;break;case"checkbox":i.checked=o}}(r.nodeName==="SELECT"||r.nodeName==="TEXTAREA")&&(r.value=o),this.setTrigger(o)},setTrigger(o){}}}s[e]=t}var Ie={_elements:{},_current:void 0,show(e){this._current&&this._current.classList.remove("current");let t=e.dataset.type;if(this._elements[t]===void 0&&(this._elements[t]=document.getElementById(`${t}-toolbar`)),this._current=this._elements[t],t==="browserLink"){let o=function(i){i.tagName==="BROWSER-SIM"&&(r[i.dataset.name]=i.id),i.tagName==="BROWSER-PAGE"&&n.push(i.getAttribute("url"));for(let c of i.children)o(c)},n=[],r={};o(u),s.browserLink.url.element.innerHTML="",s.browserLink.browser.element.innerHTML="";for(let i of n){let c=document.createElement("option");c.value=i,c.innerText=i,s.browserLink.url.element.appendChild(c)}for(let i of Object.keys(r)){let c=document.createElement("option");c.value=r[i],c.innerText=i,s.browserLink.browser.element.appendChild(c)}}if(this._current){this._current.classList.add("current");let n=xe[t](e);for(let o of Object.keys(n))s[t][o].value=n[o];let r=xe.general(e);for(let o of Object.keys(r))s.general[o].value=r[o]}},hide(){this._current&&(this._current.classlist.remove("current"),this._current=void 0)}};function Me(){s.general["visibility-type"].setTrigger=e=>{fe.dataset.visibilityType=e},s.general["visibility-type"].element.addEventListener("change",e=>{s.general["visibility-type"].setTrigger(e.target.value),a().dataset.visibilityType=e.target.value}),s.general["visible-only-on"].element.addEventListener("change",e=>{a().dataset.visibleOnlyOn=e.target.value,x(a())}),s.general["visible-from"].element.addEventListener("change",e=>{a().dataset.visibleFrom=e.target.value,x(a())}),s.general["visible-to"].element.addEventListener("change",e=>{a().dataset.visibleTo=e.target.value,x(a())}),s.table.style.element.addEventListener("change",e=>{a().dataset.style=e.target.value}),s.shortTextInput.width.element.addEventListener("change",e=>{a().style.width=e.target.value+"ch"}),s.formula.content.element.addEventListener("keyup",e=>{a().dataset.content=e.target.value;let t=MathJax.tex2mml(e.target.value);a().innerHTML=t,a().firstChild.setAttribute("display","inline")}),s.browserLink.browser.element.addEventListener("change",e=>{a().setAttribute("browser",e.target.value)}),s.browserLink.url.element.addEventListener("change",e=>{a().setAttribute("to",e.target.value)}),s.browserPage.closable.element.addEventListener("change",e=>{a().setAttribute("closable",String(e.target.checked))}),s.browserPage.title.element.addEventListener("keyup",e=>{a().setAttribute("title",e.target.value)}),s.browserPage.url.element.addEventListener("keyup",e=>{a().setAttribute("url",e.target.value)}),s.paragraph["line-height"].element.addEventListener("change",e=>{a().style.lineHeight=e.target.value+"%"}),s.paragraph["first-line-indent"].element.addEventListener("change",e=>{a().style.textIndent=e.target.value+"%"}),s.paragraph["spacing-above"].element.addEventListener("change",e=>{a().style.marginTop=e.target.value+"rem"}),s.paragraph["spacing-below"].element.addEventListener("change",e=>{a().style.marginBottom=e.target.value+"rem"}),s.container.layout.element.addEventListener("change",e=>{a().dataset.layout=e.target.value}),s.container.padding.element.addEventListener("change",e=>{a().style.padding=e.target.value+"px"}),s.container.border.element.addEventListener("change",e=>{a().dataset.border=e.target.value}),s.container.align.element.addEventListener("change",e=>{a().dataset.align=e.target.value}),s.text.content.element.addEventListener("keyup",e=>{a().innerText=e.target.value},!1),s.text.color.element.addEventListener("change",e=>{a().style.color=e.target.value},!1),s.text.bold.element.addEventListener("change",e=>{a().style.fontWeight=e.target.checked?"bold":"normal"},!1),s.text.italic.element.addEventListener("change",e=>{a().style.fontStyle=e.target.checked?"oblique":"normal"},!1),s.text.underline.element.addEventListener("change",e=>{a().style.textDecoration=e.target.checked?"underline":"none"},!1),s.text.size.element.addEventListener("change",e=>{a().style.fontSize=e.target.value+"pt"},!1)}Me();var W=0;function l(){return String(W++)}function Q(e){let t=Number(e.id);t>=W&&(W=t+1);for(let n of e.children)Q(n)}function V(e){let t=e.cloneNode(!0);function n(r){r.id=l();for(let o of r.children)n(o)}return n(t),t}var I;function m(){return I}function T(){Ce(),I&&(I.blur(),I.removeAttribute("id")),I=void 0}function D(e){T(),I=e,I.setAttribute("id","selected");let t=document.getElementById(e.dataset.id);Fe(t),Ie.show(t)}function we(e){D(e)}var L;function a(){return L}function Ce(){L&&L.classList.remove("selected"),L=void 0}function Fe(e){Ce(),L=e,L.classList.add("selected")}function d(e,t,n,r){r===void 0&&(r=`${e}-${n}`);let o=document.createElement(t);return o.id=n,o.dataset.name=r,o.dataset.type=e,o}var B={};p(B,{realElement:()=>w});function w(){let e=l();return d("container","div",e,`\u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8 (${e})`)}var $={};p($,{children:()=>qe,mounted:()=>ze,realElement:()=>C});var ke=[];function _(e){let t=e.parentElement;for(;t.id!=="main-content";){if(ke.includes(t.id))return;t=t.parentElement}ke.push(e.id),e.contentEditable="true",console.log(`making ${e} contenteditable;`)}function C(){let e=l();return d("paragraph","p",e,`\u10DE\u10D0\u10E0\u10D0\u10D2\u10E0\u10D0\u10E4\u10D8 (${e})`)}function ze(e){_(e)}var qe=["text","formula"];var G={};p(G,{realElement:()=>Je});function Je(){let e=l();return d("formula","span",e,`\u10E4\u10DD\u10E0\u10DB\u10E3\u10DA\u10D0 (${e})`)}var H={};p(H,{mounted:()=>Ue,realElement:()=>X});function X(){let e=l();return d("text","span",e,`\u10E2\u10D4\u10E5\u10E1\u10E2\u10D8 (${e})`)}function Ue(e){_(e)}var M={};p(M,{realElement:()=>K});function K(){let e=document.createElement("input");return e.type="text",e.id=l(),e.dataset.name=`\u10DB\u10DD\u10D9\u10DA\u10D4 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="shortTextInput",e}var F={};p(F,{children:()=>We,realElement:()=>Y});function Y(){let e=l();return d("multipleChoiceInput","ol",e,`\u10DB\u10E0\u10D0\u10D5\u10D0\u10DA\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var We=["multipleChoiceItem"];var z={};p(z,{parents:()=>Qe,realElement:()=>O});function O(){let e=document.createElement("li");e.dataset.type="multipleChoiceItem",e.id=l(),e.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${e.id})`;let t=document.createElement("input");return t.type="checkbox",t.id=l(),e.appendChild(t),e}var Qe=["multipleChoiceInput"];var q={};p(q,{children:()=>Ve,realElement:()=>Z});function Z(){let e=l();return d("singleChoiceInput","ol",e,`\u10D4\u10E0\u10D7\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var Ve=["singleChoiceItem"];var J={};p(J,{parents:()=>Ge,realElement:()=>ee});function ee(e){let t=document.createElement("li");t.dataset.type="singleChoiceItem",t.id=l(),t.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${t.id})`;let n=document.createElement("input");return n.type="radio",n.id=l(),n.name=e,t.appendChild(n),t}var Ge=["singleChoiceInput"];var te={};p(te,{children:()=>Ke,realElement:()=>Xe});function Xe(){let e=l();return d("browserSim","browser-sim",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10E1\u10D8\u10DB\u10E3\u10DA\u10D0\u10E2\u10DD\u10E0\u10D8 (${e})`)}var Ke=["browserPage"];var ne={};p(ne,{parents:()=>Ze,realElement:()=>Ye});function Ye(){let e=l(),t=d("browserPage","browser-page",e,`\u10D2\u10D5\u10D4\u10E0\u10D3\u10D8 (${e})`);return t.setAttribute("closable","true"),t}var Ze=["browserSim"];var re={};p(re,{children:()=>tt,realElement:()=>et});function et(){let e=l();return d("browserLink","browser-link",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10DA\u10D8\u10DC\u10D9\u10D8 (${e})`)}var tt=["text","image"];function E(e){let t=e.dataset.type,n=e.id,r=e.dataset.name,o=[];for(let i of e.children){let c=E(i);c&&(c instanceof HTMLElement?o.push(c):o.push(...c))}if(t!==void 0){let i=document.createElement("div");i.innerHTML=o.length===0?`<div class="list" tabindex="0" data-id="${n}" data-type="${t}"><span data-type="${t}">${r}</span></div>`:`<details open class="list" tabindex="0" data-id="${n}" data-type="${t}"><summary data-type="${t}">${r}</summary></details>`;let c=i.firstChild;for(let Oe of o)c.appendChild(Oe);return c}else return o}var f={container:B,paragraph:$,formula:G,text:H,shortTextInput:M,multipleChoiceInput:F,multipleChoiceItem:z,singleChoiceInput:q,singleChoiceItem:J,browserSim:te,browserPage:ne,browserLink:re,table:{children:["table-body","table-head","table-foot"],realElement(){return d("table","table",l())}},"table-head":{children:["table-row"],realElement(){return d("table-head","thead",l())}},"table-body":{children:["table-row"],realElement(){return d("table-body","tbody",l())}},"table-foot":{children:["table-row"],realElement(){return d("table-foot","tfoot",l())}},"table-row":{children:["table-data"],realElement(){let e=l();return d("table-row","tr",e,`row-${e}`)}},"table-data":{children:[],realElement(){let e=l();return d("table-data","td",e,`cell-${e}`)}}};console.log(f);function oe(e){let t=[];for(let n of Object.keys(f)){let r=!0;f[e.dataset.type].children!==void 0&&(r&&=f[e.dataset.type].children.includes(n)),f[n].parents!==void 0&&(r&&=f[n].parents.includes(e.dataset.type)),r&&t.push(n)}return console.log(t),t}var ie={multipleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let r=n.children[0];t.options.push(r.id),t.correct.push(r.checked)}return t},singleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let r=n.children[0];t.options.push(r.id),t.correct.push(r.checked)}return t},shortTextInput:e=>({correct:e.value})};var ae;function Le(){ae={};for(let e of Object.keys(ie))for(let t of u.querySelectorAll(`[data-type=${e}]`))console.log("extracted",ie[e](t)),ae[t.id]=ie[e](t);return ae}var nt={Authorization:"Bearer "+(localStorage.getItem("authToken")??"")};function se(){return nt}var le="https://eko.dimitri.ge/api";async function Te(e){let t=await fetch(`${le}/test/${e}`,{headers:se()});if(!t.ok)throw new Error(t.statusText);return await t.json()}function Be(e,t){return fetch(`${le}/test/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",...se()},body:JSON.stringify(t)})}var N;async function $e(e,t){N=e,localStorage.setItem("currentFile",JSON.stringify(e)),t!==void 0&&await Be(t,e)}async function Ne(e){if(e!==void 0)try{return N=await Te(e),N}catch(n){console.log(n)}let t=localStorage.getItem("currentFile");return t!=null?N=JSON.parse(t):N={content:'<div data-type="container" data-name="\u10DB\u10D7\u10D0\u10D5\u10D0\u10E0\u10D8 \u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8" id="0" data-pages="1"></div>'},N}var rt=document.getElementById("test-name"),ot=window.location.search,it=new URLSearchParams(ot),at=it.get("id"),Se={testName:void 0,export(){let e=i=>{i.classList.remove("current"),i.className===""&&i.removeAttribute("class");for(let c of i.children)e(c)},t=u.cloneNode(!0);e(t);let n=t.innerHTML.trim().replaceAll(/[\s\t][\s\t]+/g,"").replaceAll(' contenteditable="true"',""),r=Le();localStorage.setItem("test",JSON.stringify({html:n,gradingScheme:r}));let o=rt.value;return{content:n,name:o,description:"",tags:{},gradingScheme:r}},load({content:e,gradingScheme:t}){console.log(e),t||(t={}),u.innerHTML=e;for(let n of u.getElementsByTagName("p"))n.contentEditable="true";for(let n of u.getElementsByTagName("span"))n.contentEditable="true";Q(u.firstChild);for(let n of Object.keys(t))document.getElementById(n).value=t[n].correct;v.innerHTML="",v.appendChild(E(u.firstElementChild)),x(u.firstElementChild)}};document.getElementById("save-test").addEventListener("click",e=>{$e(Se.export())});async function st(){Se.load(await Ne(at))}st();var ce={};p(ce,{realElement:()=>lt});function lt(){let e=w();return e.appendChild(C()),e.appendChild(K()),e}var de={};p(de,{realElement:()=>ct});function ct(){let e=w();e.appendChild(C());let t=Y();return t.appendChild(O()),t.appendChild(O()),t.appendChild(O()),e.appendChild(t),e}var pe={};p(pe,{realElement:()=>dt});function me(e){let t=ee(e),n=X();return t.append(n),n.innerText=" abc ",t}function dt(){let e=w();e.appendChild(C());let t=Z();return t.appendChild(me(t.id)),t.appendChild(me(t.id)),t.appendChild(me(t.id)),e.appendChild(t),e}var S={shortTextQuestion:ce,multipleChoiceQuestion:de,singleChoiceQuestion:pe};function Ae(){let e=[];for(let t of Object.keys(S))e.push(t);return e}var P,U;function mt(){let e=!1;v.addEventListener("click",t=>{m()!==void 0&&(m().contains(t.target)||T(),e||t.preventDefault(),e=!0)},!0),v.addEventListener("contextmenu",t=>{let n=t.target;if(t.preventDefault(),n.classList.contains("list"))D(n);else if(n.parentElement.classList.contains("list"))D(n.parentElement);else return;t.stopPropagation();let r=["rcm-add-child","rcm-add-preset","rcm-copy","rcm-delete","rcm-rename"];(n.parentElement.parentElement.parentElement.classList.contains("list")||n.parentElement.parentElement.classList.contains("list"))&&r.push("rcm-add-sibbling"),U!==void 0&&(r.push("rcm-paste-child"),n.parentElement?.classList.contains("list")&&r.push("rcm-paste-above")),A(h.rightClick,r,n)},!0),v.addEventListener("focus",t=>{let n=t.target;n.classList.contains("list")||(n=n.parentElement),n.classList.contains("list")&&(we(n),e=!1)},!0),document.getElementById("rcm-add-child").addEventListener("click",t=>{P=pt,A(h.element,oe(m()),t.target)},!1),document.getElementById("rcm-add-sibbling").addEventListener("click",t=>{P=ut,A(h.element,oe(m().parentElement),t.target)},!1),document.getElementById("rcm-add-preset").addEventListener("click",t=>{P=ft,A(h.preset,Ae(),t.target)},!1),document.getElementById("rcm-copy").addEventListener("click",t=>{let n=m().dataset.id;U=document.getElementById(n),y()},!1),document.getElementById("rcm-paste-child").addEventListener("click",t=>{let n=V(U);a().appendChild(n),m().parentElement.replaceChild(E(a()),m()),y()},!1),document.getElementById("rcm-paste-above").addEventListener("click",t=>{let n=V(U);a().parentElement.insertBefore(n,a());let r=E(a().parentElement);m().parentElement.parentElement.replaceChild(r,m().parentElement),y()},!1),document.getElementById("rcm-delete").addEventListener("click",t=>{let n=m().dataset.id;m().remove(),T(),document.getElementById(n).remove(),y()},!1),document.getElementById("rcm-rename").addEventListener("click",t=>{let n=m().dataset.id,r=m().firstChild,o=r.innerText,i=document.createElement("input");i.type="text",i.value=o,m().insertBefore(i,r),r.remove(),i.focus(),i.addEventListener("blur",c=>{i.contains(c.relatedTarget)||(r.innerText=i.value,document.getElementById(n).dataset.name=i.value,m().insertBefore(r,i),i.remove())}),i.addEventListener("click",c=>{c.stopPropagation()}),i.addEventListener("keyup",c=>{(c.key==="Enter"||c.key==="Escape")&&i.blur()}),r.remove()},!1);for(let t of Object.keys(f)){let n=document.getElementById(t);n&&n.addEventListener("click",()=>{P(m(),t),T(),y()})}for(let t of Object.keys(S)){let n=document.getElementById(t);n&&n.addEventListener("click",()=>{P(m(),t),T(),y()})}}mt();function pt(e,t){let n=e.dataset.id,r=document.getElementById(n),o=f[t].realElement(n);r.appendChild(o),f[t].mounted!==void 0&&f[t].mounted(o),e.parentElement.replaceChild(E(r),e)}function ut(e,t){let n=e.dataset.id,r=document.getElementById(n),o=r.parentElement,i=e.parentElement.id,c=f[t].realElement(i);o.insertBefore(c,r),f[t].mounted!==void 0&&f[t].mounted(c),e.parentElement.insertBefore(E(c),e)}function ft(e,t){let n=e.dataset.id,r=document.getElementById(n),o=S[t].realElement();r.appendChild(o),S[t].mounted!==void 0&&S[t].mounted(o),e.parentElement.replaceChild(E(r),e)}
