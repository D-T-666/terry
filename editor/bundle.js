var Ot=Object.defineProperty;var d=(e,t)=>{for(var n in t)Ot(e,n,{get:t[n],enumerable:!0})};var v=function(e){return e[e.rightClick=0]="rightClick",e[e.element=1]="element",e[e.preset=2]="preset",e}({}),T=[document.getElementById("left-pane-right-click-menu"),document.getElementById("element-menu"),document.getElementById("preset-menu")],$t={[v.element]:v.rightClick,[v.preset]:v.rightClick},Qe;function B(){for(let e of T)e.style.visibility="hidden"}function Nt(e,t){let n=t.getBoundingClientRect();T[e].style.top=`${n.top}px`,T[e].style.left=`calc(${n.right}px + 0.25rem)`,T[e].style.visibility="visible",Qe=e}function A(e,t,n){if(t.length>0)for(let o of T[e].children)o.disabled=!t.includes(o.id);else{console.error("requested to open a menu with 0 options.");for(let o of T[e].children)o.disabled=!1}Nt(e,n)}document.addEventListener("click",function(e){let t=[],n=Qe;for(;n!==void 0;)t.push(n),n=$t[n];let o;for(let r=0;r<3;r++)if(T[r].contains(e.target)){o=r;break}for(;t.length>0&&t[t.length-1]!==o;)t.pop();for(let r=0;r<3;r++)t.includes(r)||(T[r].style.visibility="hidden")});var j={};d(j,{attributes:()=>Xe,initializeToolbar:()=>zt,realElement:()=>S,showToolbar:()=>At});function s(e,t,n,o){o===void 0&&(o=`${e}-${n}`);let r=document.createElement(t);return r.id=n,r.dataset.name=o,r.dataset.type=e,r}function S(){let e=l();return s("container","div",e,`\u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8 (${e})`)}var h={},K=e=>document.getElementById(e);function zt(){h.layout=K("container-toolbar-layout"),h.padding=K("container-toolbar-padding"),h.border=K("container-toolbar-border"),h.align=K("container-toolbar-align"),h.layout.addEventListener("change",()=>{i().dataset.layout=h.layout.value}),h.padding.addEventListener("change",()=>{i().style.padding=h.padding.value+"px"}),h.border.addEventListener("change",()=>{i().dataset.border=h.border.value}),h.align.addEventListener("change",()=>{i().dataset.align=h.align.value})}function At(e){let t=Xe(e);for(let[n,o]of Object.entries(t))h[n].value=o}function Xe(e){return{layout:e.dataset.layout??"",padding:(e.style.padding??"0  ").slice(0,-2),border:e.dataset.border??"",align:e.dataset.align??""}}var D={};d(D,{attributes:()=>Ye,children:()=>Dt,initializeToolbar:()=>Pt,mounted:()=>jt,realElement:()=>R,showToolbar:()=>_t});var Ke=[];function Y(e){let t=e.parentElement;for(;t.id!=="main-content";){if(Ke.includes(t.id))return;t=t.parentElement}Ke.push(e.id),e.contentEditable="true",console.log(`making ${e} contenteditable;`)}function R(){let e=l();return s("paragraph","p",e,`\u10DE\u10D0\u10E0\u10D0\u10D2\u10E0\u10D0\u10E4\u10D8 (${e})`)}function jt(e){Y(e)}var Dt=["text","formula"],f={},q=e=>document.getElementById(e);function Pt(){f["line-height"]=q("paragraph-toolbar-line-height"),f["first-line-indent"]=q("paragraph-toolbar-first-line-indent"),f["spacing-above"]=q("paragraph-toolbar-spacing-above"),f["spacing-below"]=q("paragraph-toolbar-spacing-below"),f.align=q("paragraph-toolbar-align"),f["line-height"].addEventListener("change",()=>{i().style.lineHeight=f["line-height"].value+"%"}),f["first-line-indent"].addEventListener("change",()=>{i().style.textIndent=f["first-line-indent"].value+"%"}),f["spacing-above"].addEventListener("change",()=>{i().style.marginTop=f["spacing-above"].value+"rem"}),f["spacing-below"].addEventListener("change",()=>{i().style.marginBottom=f["spacing-below"].value+"rem"}),f.align.addEventListener("change",()=>{i().style.textAlign=f.align.value})}function _t(e){let t=Ye(e);for(let[n,o]of Object.entries(t))f[n].value=o}function Ye(e){return{"line-height":(e.style.lineHeight??"%").slice(0,-1),"first-line-indent":(e.style.lineHeight??"%").slice(0,-1),"spacing-above":(e.style.marginTop??"rem").slice(0,-2),"spacing-below":(e.style.marginBottom??"rem").slice(0,-2),align:e.style.textAlign??"left"}}var ye={};d(ye,{attributes:()=>Ze,initializeToolbar:()=>Mt,realElement:()=>Ft,showToolbar:()=>Ut});function Ft(){let e=l();return s("formula","span",e,`\u10E4\u10DD\u10E0\u10DB\u10E3\u10DA\u10D0 (${e})`)}var J={},Ht=e=>document.getElementById(e);function Mt(){J.content=Ht("formula-toolbar-content"),J.content.addEventListener("keyup",()=>{i().dataset.content=J.content.value;let e=MathJax.tex2mml(J.content.value);i().innerHTML=e,i().firstChild.setAttribute("display","inline")})}function Ut(e){let t=Ze(e);for(let[n,o]of Object.entries(t))J[n].value=o}function Ze(e){return{content:e.dataset.content??""}}var Z={};d(Z,{attributes:()=>et,initializeToolbar:()=>Jt,mounted:()=>qt,realElement:()=>Ee,showToolbar:()=>Wt});function Ee(){let e=l();return s("text","span",e,`\u10E2\u10D4\u10E5\u10E1\u10E2\u10D8 (${e})`)}function qt(e){Y(e)}var p={},P=e=>document.getElementById(e);function Jt(){p.content=P("text-toolbar-content"),p.color=P("text-toolbar-color"),p.bold=P("text-toolbar-bold"),p.italic=P("text-toolbar-italic"),p.underline=P("text-toolbar-underline"),p.size=P("text-toolbar-size"),console.log("but whyyyy"),p.content.addEventListener("keyup",()=>{i().innerText=p.content.value},!1),p.color.addEventListener("change",()=>{i().style.color=p.color.value},!1),p.bold.addEventListener("change",()=>{i().style.fontWeight=p.bold.checked?"bold":"normal"},!1),p.italic.addEventListener("change",()=>{i().style.fontStyle=p.italic.checked?"oblique":"normal"},!1),p.underline.addEventListener("change",()=>{i().style.textDecoration=p.underline.checked?"underline":"none"},!1),p.size.addEventListener("change",()=>{i().style.fontSize=p.size.value+"pt"},!1)}function Wt(e){let t=et(e);console.log(t,p);for(let[n,o]of Object.entries(t))p[n].value=o}function et(e){return{content:e.innerText,color:e.style.color??"black",bold:String(e.style.fontWeight==="bold"),italic:String(e.style.fontStyle==="oblique"),underline:String(e.style.textDecoration==="underline"),size:(e.style.fontSize??"12pt").slice(0,-2)}}var te={};d(te,{attributes:()=>tt,initializeToolbar:()=>Vt,realElement:()=>xe,showToolbar:()=>Qt});function xe(){let e=document.createElement("input");return e.type="text",e.id=l(),e.dataset.name=`\u10DB\u10DD\u10D9\u10DA\u10D4 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="shortTextInput",e}var ee={},Gt=e=>document.getElementById(e);function Vt(){ee.width=Gt("shortTextInput-toolbar-width"),ee.width.addEventListener("change",()=>{i().style.width=ee.width.value+"ch"})}function Qt(e){let t=tt(e);for(let[n,o]of Object.entries(t))ee[n].value=o}function tt(e){return{width:e.style.width.slice(0,-2)}}var ve={};d(ve,{attributes:()=>nt,initializeToolbar:()=>Yt,realElement:()=>Xt,showToolbar:()=>Zt});function Xt(){let e=document.createElement("textarea");return e.id=l(),e.dataset.name=`\u10D2\u10E0\u10EB\u10D4\u10DA\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="longTextInput",e}var ne={},Kt=e=>document.getElementById(e);function Yt(){ne.width=Kt("longTextInput-toolbar-width"),ne.width.addEventListener("change",()=>{i().cols=Number(ne.width.value)})}function Zt(e){let t=nt(e);for(let[n,o]of Object.entries(t))ne[n].value=o}function nt(e){return{width:String(e.cols)}}var re={};d(re,{attributes:()=>ot,children:()=>en,initializeToolbar:()=>tn,realElement:()=>we,showToolbar:()=>nn});function we(){let e=l();return s("multipleChoiceInput","ol",e,`\u10DB\u10E0\u10D0\u10D5\u10D0\u10DA\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var en=["multipleChoiceItem"],oe={};function tn(){oe.numbering=document.getElementById("multipleChoiceInput-toolbar-numbering"),oe.numbering.addEventListener("change",()=>{i().dataset.numbering=oe.numbering.value})}function nn(e){let t=ot(e);for(let[n,o]of Object.entries(t))oe[n].value=o}function ot(e){return{numbering:e.dataset.numbering??"letters"}}var ie={};d(ie,{attributes:()=>ln,initializeToolbar:()=>rn,parents:()=>on,realElement:()=>_,showToolbar:()=>an});function _(){let e=document.createElement("li");e.dataset.type="multipleChoiceItem",e.id=l(),e.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${e.id})`;let t=document.createElement("input");return t.type="checkbox",t.id=l(),e.appendChild(t),e}var on=["multipleChoiceInput"];function rn(){}function an(e){}function ln(e){return{}}var le={};d(le,{attributes:()=>rt,children:()=>sn,initializeToolbar:()=>cn,realElement:()=>Ie,showToolbar:()=>dn});function Ie(){let e=l();return s("singleChoiceInput","ol",e,`\u10D4\u10E0\u10D7\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var sn=["singleChoiceItem"],ae={};function cn(){ae.numbering=document.getElementById("singleChoiceInput-toolbar-numbering"),ae.numbering.addEventListener("change",()=>{i().dataset.numbering=ae.numbering.value})}function dn(e){let t=rt(e);for(let[n,o]of Object.entries(t))ae[n].value=o}function rt(e){return{numbering:e.dataset.numbering??"letters"}}var se={};d(se,{attributes:()=>fn,initializeToolbar:()=>mn,parents:()=>pn,realElement:()=>ke,showToolbar:()=>un});function ke(e){let t=document.createElement("li");t.dataset.type="singleChoiceItem",t.id=l(),t.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${t.id})`;let n=document.createElement("input");return n.type="radio",n.id=l(),n.name=e,t.appendChild(n),t}var pn=["singleChoiceInput"];function mn(){}function un(e){}function fn(e){return{}}var Ce={};d(Ce,{attributes:()=>En,children:()=>hn,initializeToolbar:()=>bn,realElement:()=>gn,showToolbar:()=>yn});function gn(){let e=l();return s("browserSim","browser-sim",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10E1\u10D8\u10DB\u10E3\u10DA\u10D0\u10E2\u10DD\u10E0\u10D8 (${e})`)}var hn=["browserPage"];function bn(){}function yn(e){}function En(e){return{}}var Le={};d(Le,{attributes:()=>it,initializeToolbar:()=>wn,parents:()=>vn,realElement:()=>xn,showToolbar:()=>In});function xn(){let e=l(),t=s("browserPage","browser-page",e,`\u10D2\u10D5\u10D4\u10E0\u10D3\u10D8 (${e})`);return t.setAttribute("closable","true"),t}var vn=["browserSim"],w={},Te=e=>document.getElementById(e);function wn(){w.closable=Te("browserPage-toolbar-closable"),w.title=Te("browserPage-toolbar-title"),w.url=Te("browserPage-toolbar-url"),w.closable.addEventListener("change",()=>{i().setAttribute("closable",String(w.closable.checked))}),w.title.addEventListener("keyup",()=>{i().setAttribute("title",w.title.value)}),w.url.addEventListener("keyup",()=>{i().setAttribute("url",w.url.value)})}function In(e){let t=it(e);for(let[n,o]of Object.entries(t))w[n].value=o}function it(e){return{closable:e.getAttribute("closable")??"true",title:e.getAttribute("title")??"",url:e.getAttribute("url")??e.id}}var Be={};d(Be,{attributes:()=>lt,children:()=>Cn,initializeToolbar:()=>Tn,realElement:()=>kn,showToolbar:()=>Ln});function kn(){let e=l();return s("browserLink","browser-link",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10DA\u10D8\u10DC\u10D9\u10D8 (${e})`)}var Cn=["text","image"],O={},at=e=>document.getElementById(e);function Tn(){O.browser=at("browserLink-toolbar-browser"),O.url=at("browserLink-toolbar-url"),O.browser.addEventListener("change",()=>{i().setAttribute("browser",O.browser.value)}),O.url.addEventListener("change",()=>{i().setAttribute("url",O.url.value)})}function Ln(e){let t=lt(e);for(let[n,o]of Object.entries(t))O[n].value=o}function lt(e){return{browser:e.getAttribute("browser")??"",url:e.getAttribute("to")??""}}var Ne={};d(Ne,{attributes:()=>st,children:()=>jn,initializeToolbar:()=>_n,realElement:()=>An,showToolbar:()=>Fn});var Re={};d(Re,{attributes:()=>On,children:()=>Bn,initializeToolbar:()=>Sn,realElement:()=>Se,showToolbar:()=>Rn});function Se(){let e=l();return s("tableRow","tr",e,"\u10E1\u10E2\u10E0\u10D8\u10E5\u10DD\u10DC\u10D8")}var Bn=[];function Sn(){}function Rn(e){}function On(e){return{}}var Oe={};d(Oe,{attributes:()=>zn,initializeToolbar:()=>$n,realElement:()=>ce,showToolbar:()=>Nn});function ce(){let e=l();return s("tableElement","td",e,"\u10D4\u10DA\u10D4\u10DB\u10D4\u10DC\u10E2\u10D8")}function $n(){}function Nn(e){}function zn(e){return{}}function An(){let e=l(),t=s("table","table",e,`\u10EA\u10EE\u10E0\u10D8\u10DA\u10D8 (${e})`);return t.appendChild(Se()),t.lastChild.appendChild(ce()),t}var jn=[];function Dn(e,t){let n=e.children.length;if(n<t)for(let o=0;o<t-n;o++){let r=W(e.lastChild);e.appendChild(r)}else if(n>t)for(;e.children.length>t;)e.lastChild.remove();e.dataset.rows=String(t),ze(e)}function Pn(e,t){let n=e.firstChild.children.length;for(let o of e.children)if(n<t)for(let r=0;r<t-n;r++)o.appendChild(ce());else for(;o.children.length;)o.lastChild.remove();e.dataset.cols=String(t),ze(e)}var E={},$e=e=>document.getElementById(e);function _n(){E.style=$e("table-toolbar-style"),E.rows=$e("table-toolbar-rows"),E.cols=$e("table-toolbar-cols"),E.style.addEventListener("change",()=>{i().dataset.style=E.style.value}),E.rows.addEventListener("change",()=>{let e=i();Dn(e,Number(E.rows.value))}),E.cols.addEventListener("change",()=>{let e=i();Pn(e,Number(E.cols.value))})}function Fn(e){let t=st(e);console.log(E,t);for(let[n,o]of Object.entries(t))E[n].value=o}function st(e){return{style:e.dataset.style||"empty",rows:e.dataset.rows||"1",cols:e.dataset.cols||"1"}}var De={};d(De,{attributes:()=>ft,initializeToolbar:()=>Un,realElement:()=>Mn,showToolbar:()=>qn});var Hn={Authorization:"Bearer "+(localStorage.getItem("authToken")??"")};function de(){return Hn}var pe="https://terryapi.dimitri.ge/api";async function ct(e){let t=await fetch(`${pe}/test/${e}`,{headers:de()});if(!t.ok)throw new Error(t.statusText);let n=await t.json();return{id:e,...n}}function dt(e,t){return console.log("trying to upload",t,"for test",e),fetch(`${pe}/test/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",...de()},body:JSON.stringify({...t,gradingScheme:JSON.stringify(t.gradingScheme)})})}function Ae(e,t){return`${pe}/image/${e}/${t}`}async function pt(e,t,n){let o=new FormData;return o.append("image",n),(await fetch(Ae(e,t),{method:"POST",headers:{...de()},body:o})).ok}var C;async function mt(e,t){C=e,localStorage.setItem("currentFile",JSON.stringify(e)),t!==void 0&&await dt(t,e)}async function ut(e){if(e!==void 0)try{return C=await ct(e),C}catch(n){console.log(n)}let t=localStorage.getItem("currentFile");return t!=null?C=JSON.parse(t):C={content:'<div data-type="container" data-name="\u10DB\u10D7\u10D0\u10D5\u10D0\u10E0\u10D8 \u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8" id="0" data-pages="1"></div>'},C}function Mn(){let e=l();return s("image","img",e,`\u10E1\u10E3\u10E0\u10D0\u10D7\u10D8 (${e})`)}var I={},je=e=>document.getElementById(e);function Un(){I.image=je("image-toolbar-image"),I.width=je("image-toolbar-width"),I.float=je("image-toolbar-float"),I.image.addEventListener("change",async e=>{let t=e.target.files,n=t[0];if(await pt(C.id,n.name,n))i().src=Ae(C.id,n.name);else{let o=new FileReader;o.onload=r=>{i().src=r.target.result},o.readAsDataURL(e.target.files[0])}console.log(t)}),I.width.addEventListener("change",()=>{i().style.width=`${I.width.value}px`}),I.float.addEventListener("change",()=>{i().style.float=I.float.value})}function qn(e){let t=ft(e);for(let[n,o]of Object.entries(t))I[n]&&(I[n].value=o)}function ft(e){return{url:e.src??"",width:(e.style.width??"100px").slice(0,-2),float:e.style.float??"left"}}function x(e){let t=e.dataset.type,n=e.id,o=e.dataset.name,r=[];for(let a of e.children){let c=x(a);c&&(c instanceof HTMLElement?r.push(c):r.push(...c))}if(t!==void 0){let a=document.createElement("div");a.innerHTML=r.length===0?`<div class="list" tabindex="0" data-id="${n}" data-type="${t}"><span data-type="${t}">${o}</span></div>`:`<details open class="list" tabindex="0" data-id="${n}" data-type="${t}"><summary data-type="${t}">${o}</summary></details>`;let c=a.firstChild;for(let X of r)c.appendChild(X);return c}else return r}var u={container:j,paragraph:D,formula:ye,text:Z,shortTextInput:te,multipleChoiceInput:re,multipleChoiceItem:ie,singleChoiceInput:le,singleChoiceItem:se,browserSim:Ce,browserPage:Le,browserLink:Be,table:Ne,tableRow:Re,tableElement:Oe,image:De,longTextInput:ve};console.log(u);function gt(){console.log("hello");for(let{initializeToolbar:e}of Object.values(u))e&&e()}function Pe(e){let t=[];console.log(e.dataset.type),console.log(u);for(let n of Object.keys(u)){let o=!0;u[e.dataset.type].children!==void 0&&(o&&=u[e.dataset.type].children.includes(n)),u[n].parents!==void 0&&(o&&=u[n].parents.includes(e.dataset.type)),o&&t.push(n)}return console.log(t),t}var Jn=document.getElementById("page-buttons"),ht=document.getElementById("add-page"),ue=0,b=0,k=[],bt=[];function me(){let e=document.createElement("input");e.type="radio",e.id=`page-${b+1}`,e.name="current-page";let t=b;e.addEventListener("change",()=>{yt(t)});let n=document.createElement("label");n.innerText=String(b+1),n.appendChild(e),Jn.insertBefore(n,ht),bt.push(n),k.push([]),b+=1,g.firstElementChild.dataset.pages=String(b)}function Wn(){for(let e of k[ue])e.classList.remove("current")}function yt(e){if(e<b&&e>=0){console.log(k[e]),Wn(),ue=e;for(let t of k[ue])t.classList.add("current")}}function $(e){switch(e.dataset.visibilityType??"always"){case"only":{let n=Number(e.dataset.visibleOnlyOn??"1");for(;n>b;)me();xt(e,n);break}case"range":{let n=Number(e.dataset.visibleFrom??"1"),o=Number(e.dataset.visibleTo??"1");for(;n>b;)me();for(;o>b;)me();Vn(e,n,o);break}}for(let n of e.children)$(n);Gn()}function Et(e,t,n){for(let o=0;o<b;o++)if(o<t||o>n){let r=k[o].indexOf(e);r>=0&&k[o].splice(r,1)}}function Gn(){for(let e=b-1;e>0&&!(k[e].length>0);e--)k.pop(),bt.pop().remove(),b--}function xt(e,t,n=!0){t-=1,t<b&&t>=0&&(k[t].includes(e)||k[t].push(e),n&&Et(e,t,t),t===ue&&yt(t))}function Vn(e,t,n){for(let o=t;o<=n;o++)xt(e,o,!1);Et(e,t-1,n-1)}ht.addEventListener("click",()=>{me()});var wt={general:["visibility-type","visible-only-on","visible-from","visible-to"]},Qn={general:e=>{let t={"visibility-type":e.dataset.visibilityType||"always"};switch(t["visibility-type"]){case"only":t["visible-only-on"]=e.dataset.visibleOnlyOn||"1";break;case"range":t["visible-from"]=e.dataset.visibleFrom||"1",t["visible-to"]=e.dataset.visibleTo||"1";break}return t}},y={};for(let e of Object.keys(wt)){let t={};for(let n of wt[e]){let o=document.getElementById(`${e}-toolbar-${n}`);console.log(e,n),t[n]={element:o,addEventListener:o.addEventListener,set value(r){if(o.nodeName==="INPUT"){let a=o;switch(a.type){case"text":case"number":a.value=r;break;case"checkbox":a.checked=r}}(o.nodeName==="SELECT"||o.nodeName==="TEXTAREA")&&(o.value=r),this.setTrigger(r)},setTrigger(r){}}}y[e]=t}var It={_elements:{},_current:void 0,show(e){this._current&&this._current.classList.remove("current");let t=e.dataset.type;if(this._elements[t]===void 0&&(this._elements[t]=document.getElementById(`${t}-toolbar`)),this._current=this._elements[t],t==="browserLink"){let r=function(a){a.tagName==="BROWSER-SIM"&&(o[a.dataset.name]=a.id),a.tagName==="BROWSER-PAGE"&&n.push(a.getAttribute("url"));for(let c of a.children)r(c)},n=[],o={};r(g),y.browserLink.url.element.innerHTML="",y.browserLink.browser.element.innerHTML="";for(let a of n){let c=document.createElement("option");c.value=a,c.innerText=a,y.browserLink.url.element.appendChild(c)}for(let a of Object.keys(o)){let c=document.createElement("option");c.value=o[a],c.innerText=a,y.browserLink.browser.element.appendChild(c)}}if(this._current){this._current.classList.add("current"),u[t].showToolbar(e);let n=Qn.general(e);for(let o of Object.keys(n))y.general[o].value=n[o]}},hide(){this._current&&(this._current.classlist.remove("current"),this._current=void 0)}};function Xn(){y.general["visibility-type"].setTrigger=e=>{_e.dataset.visibilityType=e},y.general["visibility-type"].element.addEventListener("change",e=>{y.general["visibility-type"].setTrigger(e.target.value),i().dataset.visibilityType=e.target.value}),y.general["visible-only-on"].element.addEventListener("change",e=>{i().dataset.visibleOnlyOn=e.target.value,$(i())}),y.general["visible-from"].element.addEventListener("change",e=>{i().dataset.visibleFrom=e.target.value,$(i())}),y.general["visible-to"].element.addEventListener("change",e=>{i().dataset.visibleTo=e.target.value,$(i())})}Xn();var Fe=0;function l(){return String(Fe++)}function He(e){let t=Number(e.id);t>=Fe&&(Fe=t+1);for(let n of e.children)He(n)}function W(e){let t=e.cloneNode(!0);function n(o){o.id=l();for(let r of o.children)n(r)}return n(t),t}var N;function m(){return N}function z(){Ct(),N&&(N.blur(),N.removeAttribute("id")),N=void 0}function fe(e){z(),N=e,N.setAttribute("id","selected");let t=document.getElementById(e.dataset.id);Kn(t),It.show(t)}function kt(e){fe(e)}function ze(e){let t=e.id,n=L.querySelector(`[data-id="${t}"]`);n.parentElement.replaceChild(x(e),n)}var F;function i(){return F}function Ct(){F&&F.classList.remove("selected"),F=void 0}function Kn(e){Ct(),F=e,F.classList.add("selected")}var Me={multipleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},singleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},shortTextInput:e=>({correct:e.value})};var Ue;function Tt(){Ue={};for(let e of Object.keys(Me))for(let t of g.querySelectorAll(`[data-type=${e}]`))console.log("extracted",Me[e](t)),Ue[t.id]=Me[e](t);return Ue}var ge=class{#n=100;#t=[];#e=-1;update(t){this.#t.splice(0,this.#e,t),this.#t.length>=this.#n&&this.#t.splice(this.#n),this.#e=-1,console.log(this.#t)}canGoBack(){return this.#e<this.#t.length-1}goBack(){return this.#e+=1,console.log("returning version",this.#e),this.#t[this.#e]}canGoForward(){return this.#e>0}goForward(){return this.#e-=1,console.log("returning version",this.#e),this.#t[this.#e]}};var Lt=document.getElementById("test-name"),Yn=window.location.search,Zn=new URLSearchParams(Yn),Bt=Zn.get("id"),St=e=>{e.classList.remove("current"),e.className===""&&e.removeAttribute("class");for(let t of e.children)St(t)},qe=class{get content(){let t=g.cloneNode(!0);return St(t),t.innerHTML.trim().replaceAll(/[\s\t][\s\t]+/g,"").replaceAll(' contenteditable="true"',"")}get gradingScheme(){return JSON.stringify(Tt())}get name(){return Lt.value}export(){return{content:this.content,gradingScheme:this.gradingScheme,name:this.name}}load({name:t,content:n,gradingScheme:o}){g.innerHTML=n;for(let r of g.getElementsByTagName("p"))r.contentEditable="true";for(let r of g.getElementsByTagName("span"))r.contentEditable="true";if(He(g.firstChild),o){let r=JSON.parse(o);for(let a of Object.keys(r))document.getElementById(a).value=r[a].correct}L.innerHTML="",L.appendChild(x(g.firstElementChild)),$(g.firstElementChild),t&&(Lt.value=t)}},H=new ge;document.getElementById("undo").addEventListener("click",()=>{if(H.canGoBack()){let e=H.goBack();G.load(e)}else console.log("can't go back anymore")});document.getElementById("redo").addEventListener("click",()=>{if(H.canGoForward()){let e=H.goForward();G.load(e)}else console.log("can't go forward anymore")});function M(){H.update(G.export())}var G=new qe;document.getElementById("save-test").addEventListener("click",async()=>{await mt(G.export(),Bt??void 0)});async function eo(){let e=await ut(Bt);G.load(e),H.update(e)}eo();var L=document.getElementById("tree-view"),g=document.getElementById("main-content"),_e=document.getElementById("right-pane"),Je=!1;L.addEventListener("click",e=>{m()!==void 0&&(m().contains(e.target)||z(),Je||e.preventDefault(),Je=!0)},!0);L.addEventListener("contextmenu",e=>{let t=e.target;if(e.preventDefault(),t.classList.contains("list"))fe(t);else if(t.parentElement.classList.contains("list"))fe(t.parentElement);else return;e.stopPropagation();let n=["rcm-add-child","rcm-add-preset","rcm-copy","rcm-delete","rcm-rename"];(t.parentElement.parentElement.parentElement.classList.contains("list")||t.parentElement.parentElement.classList.contains("list"))&&n.push("rcm-add-sibbling"),V.isCopying()&&(n.push("rcm-paste-child"),t.parentElement?.classList.contains("list")&&n.push("rcm-paste-above")),A(v.rightClick,n,t)},!0);L.addEventListener("focus",e=>{let t=e.target;t.classList.contains("list")||(t=t.parentElement),t.classList.contains("list")&&(kt(t),Je=!1)},!0);_e.addEventListener("change",()=>{M()});var We={};d(We,{realElement:()=>to});function to(){let e=S();return e.appendChild(R()),e.appendChild(xe()),e}var Ge={};d(Ge,{realElement:()=>no});function no(){let e=S();e.appendChild(R());let t=we();return t.appendChild(_()),t.appendChild(_()),t.appendChild(_()),t.appendChild(_()),e.appendChild(t),e}var Ve={};d(Ve,{realElement:()=>oo});function he(e){let t=ke(e),n=Ee();return t.append(n),n.innerText=" abc ",t}function oo(){let e=S();e.appendChild(R());let t=Ie();return t.appendChild(he(t.id)),t.appendChild(he(t.id)),t.appendChild(he(t.id)),t.appendChild(he(t.id)),e.appendChild(t),e}var U={shortTextQuestion:We,multipleChoiceQuestion:Ge,singleChoiceQuestion:Ve};function Rt(){let e=[];for(let t of Object.keys(U))e.push(t);return e}var be=class{#n;set data(t){this.#n=t}get data(){return this.#n}isCopying(){return this.#n!==void 0}};var Q,V=new be;function ro(){document.getElementById("rcm-add-child").addEventListener("click",e=>{Q=io,A(v.element,Pe(m()),e.target)},!1),document.getElementById("rcm-add-sibbling").addEventListener("click",e=>{Q=ao,A(v.element,Pe(m().parentElement),e.target)},!1),document.getElementById("rcm-add-preset").addEventListener("click",e=>{Q=lo,A(v.preset,Rt(),e.target)},!1),document.getElementById("rcm-copy").addEventListener("click",e=>{let t=m().dataset.id;V.data=document.getElementById(t),B()},!1),document.getElementById("rcm-paste-child").addEventListener("click",e=>{let t=W(V.data);i().appendChild(t),m().parentElement.replaceChild(x(i()),m()),B()},!1),document.getElementById("rcm-paste-above").addEventListener("click",e=>{let t=W(V.data);i().parentElement.insertBefore(t,i());let n=x(i().parentElement);m().parentElement.parentElement.replaceChild(n,m().parentElement),B()},!1),document.getElementById("rcm-delete").addEventListener("click",e=>{let t=m().dataset.id;m().remove(),z(),document.getElementById(t).remove(),B()},!1),document.getElementById("rcm-rename").addEventListener("click",e=>{let t=m().dataset.id,n=m().firstChild,o=n.innerText,r=document.createElement("input");r.type="text",r.value=o,m().insertBefore(r,n),n.remove(),r.focus(),r.addEventListener("blur",a=>{r.contains(a.relatedTarget)||(n.innerText=r.value,document.getElementById(t).dataset.name=r.value,m().insertBefore(n,r),r.remove())}),r.addEventListener("click",a=>{a.stopPropagation()}),r.addEventListener("keyup",a=>{(a.key==="Enter"||a.key==="Escape")&&r.blur()}),n.remove()},!1);for(let e of Object.keys(u)){let t=document.getElementById(e);t&&t.addEventListener("click",()=>{Q(m(),e),z(),B()})}for(let e of Object.keys(U)){let t=document.getElementById(e);t&&t.addEventListener("click",()=>{Q(m(),e),z(),B()})}console.log("hello?"),gt()}ro();function io(e,t){let n=e.dataset.id,o=document.getElementById(n),r=u[t].realElement(n);if(o.appendChild(r),u[t].mounted!==void 0&&u[t].mounted(r),e.appendChild(x(r)),e.tagName==="DIV"){let a=document.createElement("details");a.classList.add("list"),a.tabIndex=0,a.dataset.id=n,a.dataset.type=e.dataset.type,a.open=!0;let c=document.createElement("summary");c.dataset.type=e.dataset.type,c.innerText=e.firstChild.innerText,a.appendChild(c);let X=[...e.children].slice(1);console.log(X),a.append(...X),e.replaceWith(a)}M()}function ao(e,t){let n=e.dataset.id,o=document.getElementById(n),r=o.parentElement,a=e.parentElement.id,c=u[t].realElement(a);r.insertBefore(c,o),u[t].mounted!==void 0&&u[t].mounted(c),e.parentElement.insertBefore(x(c),e),M()}function lo(e,t){let n=e.dataset.id,o=document.getElementById(n),r=U[t].realElement();o.appendChild(r),U[t].mounted!==void 0&&U[t].mounted(r),e.parentElement.replaceChild(x(o),e),M()}export{V as copyBuffer};
