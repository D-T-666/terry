var $e=Object.defineProperty;var p=(e,t)=>{for(var n in t)$e(e,n,{get:t[n],enumerable:!0})};var h=function(e){return e[e.rightClick=0]="rightClick",e[e.element=1]="element",e[e.preset=2]="preset",e}({}),b=[document.getElementById("left-pane-right-click-menu"),document.getElementById("element-menu"),document.getElementById("preset-menu")],Ae={[h.element]:h.rightClick,[h.preset]:h.rightClick},ue;function y(){for(let e of b)e.style.visibility="hidden"}function Se(e,t){let n=t.getBoundingClientRect();b[e].style.top=`${n.top}px`,b[e].style.left=`calc(${n.right}px + 0.25rem)`,b[e].style.visibility="visible",ue=e}function S(e,t,n){if(t.length>0)for(let r of b[e].children)r.disabled=!t.includes(r.id);else{console.error("requested to open a menu with 0 options.");for(let r of b[e].children)r.disabled=!1}Se(e,n)}document.addEventListener("click",function(e){let t=[],n=ue;for(;n!==void 0;)t.push(n),n=Ae[n];let r;for(let i=0;i<3;i++)if(b[i].contains(e.target)){r=i;break}for(;t.length>0&&t[t.length-1]!==r;)t.pop();for(let i=0;i<3;i++)t.includes(i)||(b[i].style.visibility="hidden")});var v=document.getElementById("tree-view"),u=document.getElementById("main-content"),fe=document.getElementById("right-pane");var Oe=document.getElementById("page-buttons"),ge=document.getElementById("add-page"),R=0,g=0,k=[];function w(){let e=document.createElement("input");e.type="radio",e.id=`page-${g+1}`,e.name="current-page";let t=g;e.addEventListener("change",()=>{he(t)});let n=document.createElement("label");n.innerText=String(g+1),n.appendChild(e),Oe.insertBefore(n,ge),k.push([]),g+=1,u.firstElementChild.dataset.pages=String(g)}function De(){for(let e of k[R])e.classList.remove("current")}function he(e){if(e<g&&e>=0){De(),R=e;for(let t of k[R])t.classList.add("current")}}function x(e){switch(e.dataset.visibilityType||"always"){case"only":let n=Number(e.dataset.visibleOnlyOn||"1");for(;n>g;)w();be(e,n);break;case"range":let r=Number(e.dataset.visibleFrom||"1"),i=Number(e.dataset.visibleTo||"1");for(;r>g;)w();for(;i>g;)w();Re(e,r,i);break}for(let n of e.children)x(n)}function Ee(e){for(let t of k){let n=t.indexOf(e);n>=0&&t.splice(n,1)}}function be(e,t,n=!0){t-=1,t<g&&t>=0&&(n&&Ee(e),k[t].includes(e)||k[t].push(e),t===R&&he(t))}function Re(e,t,n){Ee(e);for(let r=t;r<=n;r++)be(e,r,!1)}ge.addEventListener("click",()=>{w()});var ve={text:["content","color","bold","italic","underline","size"],paragraph:["line-height","first-line-indent","spacing-above","spacing-below"],container:["layout","padding","border","align"],browserPage:["closable","title","url"],browserLink:["browser","url"],formula:["content"],shortTextInput:["width"],table:["style"],general:["visibility-type","visible-only-on","visible-from","visible-to"]},xe={text:e=>({content:e.innerText,color:e.style.color||"black",bold:e.style.fontWeight==="bold",italic:e.style.fontStyle==="oblique",underline:e.style.textDecoration==="underline",size:(e.style.fontSize||"12pt").slice(0,-2)}),paragraph:e=>({"line-height":e.style.lineHeight.slice(0,-1),"first-line-indent":e.style.lineHeight.slice(0,-1),"spacing-above":e.style.marginTop.slice(0,-2),"spacing-below":e.style.marginBottom.slice(0,-2)}),container:e=>({layout:e.dataset.layout,padding:e.style.padding.slice(0,-2),border:e.dataset.border,align:e.dataset.align}),formula:e=>({content:e.dataset.content}),shortTextInput:e=>({width:e.style.width.slice(0,-2)}),browserLink:e=>({browser:e.getAttribute("browser"),url:e.getAttribute("to")}),browserPage:e=>({closable:e.getAttribute("closable"),title:e.getAttribute("title"),url:e.getAttribute("url")}),table:e=>({style:e.dataset.style||"empty"}),general:e=>{let t={"visibility-type":e.dataset.visibilityType||"always"};switch(t["visibility-type"]){case"only":t["visible-only-on"]=e.dataset.visibleOnlyOn||"1";break;case"range":t["visible-from"]=e.dataset.visibleFrom||"1",t["visible-to"]=e.dataset.visibleTo||"1";break}return t}},a={};for(let e of Object.keys(ve)){let t={};for(let n of ve[e]){let r=document.getElementById(`${e}-toolbar-${n}`);console.log(e,n),t[n]={element:r,addEventListener:r.addEventListener,set value(i){if(r.nodeName==="INPUT"){let o=r;switch(o.type){case"text":case"number":o.value=i;break;case"checkbox":o.checked=i}}(r.nodeName==="SELECT"||r.nodeName==="TEXTAREA")&&(r.value=i),this.setTrigger(i)},setTrigger(i){}}}a[e]=t}var Ie={_elements:{},_current:void 0,show(e){this._current&&this._current.classList.remove("current");let t=e.dataset.type;if(this._elements[t]===void 0&&(this._elements[t]=document.getElementById(`${t}-toolbar`)),this._current=this._elements[t],t==="browserLink"){let i=function(o){o.tagName==="BROWSER-SIM"&&(r[o.dataset.name]=o.id),o.tagName==="BROWSER-PAGE"&&n.push(o.getAttribute("url"));for(let c of o.children)i(c)},n=[],r={};i(u),a.browserLink.url.element.innerHTML="",a.browserLink.browser.element.innerHTML="";for(let o of n){let c=document.createElement("option");c.value=o,c.innerText=o,a.browserLink.url.element.appendChild(c)}for(let o of Object.keys(r)){let c=document.createElement("option");c.value=r[o],c.innerText=o,a.browserLink.browser.element.appendChild(c)}}if(this._current){this._current.classList.add("current");let n=xe[t](e);for(let i of Object.keys(n))a[t][i].value=n[i];let r=xe.general(e);for(let i of Object.keys(r))a.general[i].value=r[i]}},hide(){this._current&&(this._current.classlist.remove("current"),this._current=void 0)}};function Pe(){a.general["visibility-type"].setTrigger=e=>{fe.dataset.visibilityType=e},a.general["visibility-type"].element.addEventListener("change",e=>{a.general["visibility-type"].setTrigger(e.target.value),l().dataset.visibilityType=e.target.value}),a.general["visible-only-on"].element.addEventListener("change",e=>{l().dataset.visibleOnlyOn=e.target.value,x(l())}),a.general["visible-from"].element.addEventListener("change",e=>{l().dataset.visibleFrom=e.target.value,x(l())}),a.general["visible-to"].element.addEventListener("change",e=>{l().dataset.visibleTo=e.target.value,x(l())}),a.table.style.element.addEventListener("change",e=>{l().dataset.style=e.target.value}),a.shortTextInput.width.element.addEventListener("change",e=>{l().style.width=e.target.value+"ch"}),a.formula.content.element.addEventListener("keyup",e=>{l().dataset.content=e.target.value;let t=MathJax.tex2mml(e.target.value);l().innerHTML=t,l().firstChild.setAttribute("display","inline")}),a.browserLink.browser.element.addEventListener("change",e=>{l().setAttribute("browser",e.target.value)}),a.browserLink.url.element.addEventListener("change",e=>{l().setAttribute("to",e.target.value)}),a.browserPage.closable.element.addEventListener("change",e=>{l().setAttribute("closable",String(e.target.checked))}),a.browserPage.title.element.addEventListener("keyup",e=>{l().setAttribute("title",e.target.value)}),a.browserPage.url.element.addEventListener("keyup",e=>{l().setAttribute("url",e.target.value)}),a.paragraph["line-height"].element.addEventListener("change",e=>{l().style.lineHeight=e.target.value+"%"}),a.paragraph["first-line-indent"].element.addEventListener("change",e=>{l().style.textIndent=e.target.value+"%"}),a.paragraph["spacing-above"].element.addEventListener("change",e=>{l().style.marginTop=e.target.value+"rem"}),a.paragraph["spacing-below"].element.addEventListener("change",e=>{l().style.marginBottom=e.target.value+"rem"}),a.container.layout.element.addEventListener("change",e=>{l().dataset.layout=e.target.value}),a.container.padding.element.addEventListener("change",e=>{l().style.padding=e.target.value+"px"}),a.container.border.element.addEventListener("change",e=>{l().dataset.border=e.target.value}),a.container.align.element.addEventListener("change",e=>{l().dataset.align=e.target.value}),a.text.content.element.addEventListener("keyup",e=>{l().innerText=e.target.value},!1),a.text.color.element.addEventListener("change",e=>{l().style.color=e.target.value},!1),a.text.bold.element.addEventListener("change",e=>{l().style.fontWeight=e.target.checked?"bold":"normal"},!1),a.text.italic.element.addEventListener("change",e=>{l().style.fontStyle=e.target.checked?"oblique":"normal"},!1),a.text.underline.element.addEventListener("change",e=>{l().style.textDecoration=e.target.checked?"underline":"none"},!1),a.text.size.element.addEventListener("change",e=>{l().style.fontSize=e.target.value+"pt"},!1)}Pe();var Q=0;function s(){return String(Q++)}function U(e){let t=Number(e.id);t>=Q&&(Q=t+1);for(let n of e.children)U(n)}function V(e){let t=e.cloneNode(!0);function n(r){r.id=s();for(let i of r.children)n(i)}return n(t),t}var I;function m(){return I}function B(){Le(),I&&(I.blur(),I.removeAttribute("id")),I=void 0}function P(e){B(),I=e,I.setAttribute("id","selected");let t=document.getElementById(e.dataset.id);_e(t),Ie.show(t)}function Ce(e){P(e)}var T;function l(){return T}function Le(){T&&T.classList.remove("selected"),T=void 0}function _e(e){Le(),T=e,T.classList.add("selected")}function d(e,t,n,r){r===void 0&&(r=`${e}-${n}`);let i=document.createElement(t);return i.id=n,i.dataset.name=r,i.dataset.type=e,i}var N={};p(N,{realElement:()=>C});function C(){let e=s();return d("container","div",e,`\u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8 (${e})`)}var $={};p($,{children:()=>Fe,mounted:()=>Me,realElement:()=>L});var we=[];function _(e){let t=e.parentElement;for(;t.id!=="main-content";){if(we.includes(t.id))return;t=t.parentElement}we.push(e.id),e.contentEditable="true",console.log(`making ${e} contenteditable;`)}function L(){let e=s();return d("paragraph","p",e,`\u10DE\u10D0\u10E0\u10D0\u10D2\u10E0\u10D0\u10E4\u10D8 (${e})`)}function Me(e){_(e)}var Fe=["text","formula"];var G={};p(G,{realElement:()=>je});function je(){let e=s();return d("formula","span",e,`\u10E4\u10DD\u10E0\u10DB\u10E3\u10DA\u10D0 (${e})`)}var M={};p(M,{mounted:()=>He,realElement:()=>X});function X(){let e=s();return d("text","span",e,`\u10E2\u10D4\u10E5\u10E1\u10E2\u10D8 (${e})`)}function He(e){_(e)}var F={};p(F,{realElement:()=>K});function K(){let e=document.createElement("input");return e.type="text",e.id=s(),e.dataset.name=`\u10DB\u10DD\u10D9\u10DA\u10D4 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="shortTextInput",e}var j={};p(j,{children:()=>qe,realElement:()=>Y});function Y(){let e=s();return d("multipleChoiceInput","ol",e,`\u10DB\u10E0\u10D0\u10D5\u10D0\u10DA\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var qe=["multipleChoiceItem"];var H={};p(H,{parents:()=>ze,realElement:()=>O});function O(){let e=document.createElement("li");e.dataset.type="multipleChoiceItem",e.id=s(),e.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${e.id})`;let t=document.createElement("input");return t.type="checkbox",t.id=s(),e.appendChild(t),e}var ze=["multipleChoiceInput"];var q={};p(q,{children:()=>We,realElement:()=>Z});function Z(){let e=s();return d("singleChoiceInput","ol",e,`\u10D4\u10E0\u10D7\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var We=["singleChoiceItem"];var z={};p(z,{parents:()=>Je,realElement:()=>ee});function ee(e){let t=document.createElement("li");t.dataset.type="singleChoiceItem",t.id=s(),t.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${t.id})`;let n=document.createElement("input");return n.type="radio",n.id=s(),n.name=e,t.appendChild(n),t}var Je=["singleChoiceInput"];var te={};p(te,{children:()=>Ue,realElement:()=>Qe});function Qe(){let e=s();return d("browserSim","browser-sim",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10E1\u10D8\u10DB\u10E3\u10DA\u10D0\u10E2\u10DD\u10E0\u10D8 (${e})`)}var Ue=["browserPage"];var ne={};p(ne,{parents:()=>Ge,realElement:()=>Ve});function Ve(){let e=s(),t=d("browserPage","browser-page",e,`\u10D2\u10D5\u10D4\u10E0\u10D3\u10D8 (${e})`);return t.setAttribute("closable","true"),t}var Ge=["browserSim"];var re={};p(re,{children:()=>Ke,realElement:()=>Xe});function Xe(){let e=s();return d("browserLink","browser-link",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10DA\u10D8\u10DC\u10D9\u10D8 (${e})`)}var Ke=["text","image"];function E(e){let t=e.dataset.type,n=e.id,r=e.dataset.name,i=[];for(let o of e.children){let c=E(o);c&&(c instanceof HTMLElement?i.push(c):i.push(...c))}if(t!==void 0){let o=document.createElement("div");o.innerHTML=i.length===0?`<div class="list" tabindex="0" data-id="${n}" data-type="${t}"><span data-type="${t}">${r}</span></div>`:`<details open class="list" tabindex="0" data-id="${n}" data-type="${t}"><summary data-type="${t}">${r}</summary></details>`;let c=o.firstChild;for(let Ne of i)c.appendChild(Ne);return c}else return i}var f={container:N,paragraph:$,formula:G,text:M,shortTextInput:F,multipleChoiceInput:j,multipleChoiceItem:H,singleChoiceInput:q,singleChoiceItem:z,browserSim:te,browserPage:ne,browserLink:re,table:{children:["table-body","table-head","table-foot"],realElement(){return d("table","table",s())}},"table-head":{children:["table-row"],realElement(){return d("table-head","thead",s())}},"table-body":{children:["table-row"],realElement(){return d("table-body","tbody",s())}},"table-foot":{children:["table-row"],realElement(){return d("table-foot","tfoot",s())}},"table-row":{children:["table-data"],realElement(){let e=s();return d("table-row","tr",e,`row-${e}`)}},"table-data":{children:[],realElement(){let e=s();return d("table-data","td",e,`cell-${e}`)}}};console.log(f);function ie(e){let t=[];for(let n of Object.keys(f)){let r=!0;f[e.dataset.type].children!==void 0&&(r&&=f[e.dataset.type].children.includes(n)),f[n].parents!==void 0&&(r&&=f[n].parents.includes(e.dataset.type)),r&&t.push(n)}return console.log(t),t}var oe={multipleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let r=n.children[0];t.options.push(r.id),t.correct.push(r.checked)}return t},singleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let r=n.children[0];t.options.push(r.id),t.correct.push(r.checked)}return t},shortTextInput:e=>({correct:e.value})};var le;function ke(){le={};for(let e of Object.keys(oe))for(let t of u.querySelectorAll(`[data-type=${e}]`))console.log("extracted",oe[e](t)),le[t.id]=oe[e](t);return le}var W;function Te(e){W=e,localStorage.setItem("currentFile",JSON.stringify(e))}function ae(e){let t=localStorage.getItem("currentFile");return t!=null?W=JSON.parse(t):W={name:"\u10D0\u10EE\u10D0\u10DA\u10D8 \u10E2\u10D4\u10E1\u10E2\u10D8",description:"\u10D0\u10E6\u10EC\u10D4\u10E0\u10D0",tags:{},content:'<div data-type="container" data-name="\u10DB\u10D7\u10D0\u10D5\u10D0\u10E0\u10D8 \u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8" id="0"></div>',gradingScheme:{}},W}var Ye=document.getElementById("test-name"),se={testName:void 0,export(){let e=o=>{o.classList.remove("current"),o.className===""&&o.removeAttribute("class");for(let c of o.children)e(c)},t=u.cloneNode(!0);e(t);let n=t.innerHTML.trim().replaceAll(/[\s\t][\s\t]+/g,"").replaceAll(' contenteditable="true"',""),r=ke();localStorage.setItem("test",JSON.stringify({html:n,gradingScheme:r}));let i=Ye.value;return{content:n,name:i,description:"",tags:{},gradingScheme:r}},load({content:e,gradingScheme:t}){t==null&&(t={}),u.innerHTML=e;for(let n of u.getElementsByTagName("p"))n.contentEditable="true";for(let n of u.getElementsByTagName("span"))n.contentEditable="true";U(u.firstChild);for(let n of Object.keys(t))document.getElementById(n).value=t[n].correct;v.innerHTML="",v.appendChild(E(u.firstElementChild)),x(u.firstElementChild)}};document.getElementById("load-test").addEventListener("click",e=>{se.load(ae())});document.getElementById("save-test").addEventListener("click",e=>{Te(se.export())});se.load(ae());var ce={};p(ce,{realElement:()=>Ze});function Ze(){let e=C();return e.appendChild(L()),e.appendChild(K()),e}var de={};p(de,{realElement:()=>et});function et(){let e=C();e.appendChild(L());let t=Y();return t.appendChild(O()),t.appendChild(O()),t.appendChild(O()),e.appendChild(t),e}var pe={};p(pe,{realElement:()=>tt});function me(e){let t=ee(e),n=X();return t.append(n),n.innerText=" abc ",t}function tt(){let e=C();e.appendChild(L());let t=Z();return t.appendChild(me(t.id)),t.appendChild(me(t.id)),t.appendChild(me(t.id)),e.appendChild(t),e}var A={shortTextQuestion:ce,multipleChoiceQuestion:de,singleChoiceQuestion:pe};function Be(){let e=[];for(let t of Object.keys(A))e.push(t);return e}var D,J;function nt(){let e=!1;v.addEventListener("click",t=>{m()!==void 0&&(m().contains(t.target)||B(),e||t.preventDefault(),e=!0)},!0),v.addEventListener("contextmenu",t=>{let n=t.target;if(t.preventDefault(),n.classList.contains("list"))P(n);else if(n.parentElement.classList.contains("list"))P(n.parentElement);else return;t.stopPropagation();let r=["rcm-add-child","rcm-add-preset","rcm-copy","rcm-delete","rcm-rename"];(n.parentElement.parentElement.parentElement.classList.contains("list")||n.parentElement.parentElement.classList.contains("list"))&&r.push("rcm-add-sibbling"),J!==void 0&&(r.push("rcm-paste-child"),n.parentElement?.classList.contains("list")&&r.push("rcm-paste-above")),S(h.rightClick,r,n)},!0),v.addEventListener("focus",t=>{let n=t.target;n.classList.contains("list")||(n=n.parentElement),n.classList.contains("list")&&(Ce(n),e=!1)},!0),document.getElementById("rcm-add-child").addEventListener("click",t=>{D=rt,S(h.element,ie(m()),t.target)},!1),document.getElementById("rcm-add-sibbling").addEventListener("click",t=>{D=it,S(h.element,ie(m().parentElement),t.target)},!1),document.getElementById("rcm-add-preset").addEventListener("click",t=>{D=ot,S(h.preset,Be(),t.target)},!1),document.getElementById("rcm-copy").addEventListener("click",t=>{let n=m().dataset.id;J=document.getElementById(n),y()},!1),document.getElementById("rcm-paste-child").addEventListener("click",t=>{let n=V(J);l().appendChild(n),m().parentElement.replaceChild(E(l()),m()),y()},!1),document.getElementById("rcm-paste-above").addEventListener("click",t=>{let n=V(J);l().parentElement.insertBefore(n,l());let r=E(l().parentElement);m().parentElement.parentElement.replaceChild(r,m().parentElement),y()},!1),document.getElementById("rcm-delete").addEventListener("click",t=>{let n=m().dataset.id;m().remove(),B(),document.getElementById(n).remove(),y()},!1),document.getElementById("rcm-rename").addEventListener("click",t=>{let n=m().dataset.id,r=m().firstChild,i=r.innerText,o=document.createElement("input");o.type="text",o.value=i,m().insertBefore(o,r),r.remove(),o.focus(),o.addEventListener("blur",c=>{o.contains(c.relatedTarget)||(r.innerText=o.value,document.getElementById(n).dataset.name=o.value,m().insertBefore(r,o),o.remove())}),o.addEventListener("click",c=>{c.stopPropagation()}),o.addEventListener("keyup",c=>{(c.key==="Enter"||c.key==="Escape")&&o.blur()}),r.remove()},!1);for(let t of Object.keys(f)){let n=document.getElementById(t);n&&n.addEventListener("click",()=>{D(m(),t),B(),y()})}for(let t of Object.keys(A)){let n=document.getElementById(t);n&&n.addEventListener("click",()=>{D(m(),t),B(),y()})}w()}nt();function rt(e,t){let n=e.dataset.id,r=document.getElementById(n),i=f[t].realElement(n);r.appendChild(i),f[t].mounted!==void 0&&f[t].mounted(i),e.parentElement.replaceChild(E(r),e)}function it(e,t){let n=e.dataset.id,r=document.getElementById(n),i=r.parentElement,o=e.parentElement.id,c=f[t].realElement(o);i.insertBefore(c,r),f[t].mounted!==void 0&&f[t].mounted(c),e.parentElement.insertBefore(E(c),e)}function ot(e,t){let n=e.dataset.id,r=document.getElementById(n),i=A[t].realElement();r.appendChild(i),A[t].mounted!==void 0&&A[t].mounted(i),e.parentElement.replaceChild(E(r),e)}
