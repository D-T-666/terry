var Dt=Object.defineProperty;var m=(e,t)=>{for(var n in t)Dt(e,n,{get:t[n],enumerable:!0})};var w=function(e){return e[e.rightClick=0]="rightClick",e[e.element=1]="element",e[e.preset=2]="preset",e}({}),B=[document.getElementById("left-pane-right-click-menu"),document.getElementById("element-menu"),document.getElementById("preset-menu")],Pt={[w.element]:w.rightClick,[w.preset]:w.rightClick},tt;function R(){for(let e of B)e.style.visibility="hidden"}function _t(e,t){let n=t.getBoundingClientRect();B[e].style.top=`${n.top}px`,B[e].style.left=`calc(${n.right}px + 0.25rem)`,B[e].style.visibility="visible",tt=e}function D(e,t,n){if(t.length>0)for(let o of B[e].children)o.disabled=!t.includes(o.id);else{console.error("requested to open a menu with 0 options.");for(let o of B[e].children)o.disabled=!1}_t(e,n)}document.addEventListener("click",function(e){let t=[],n=tt;for(;n!==void 0;)t.push(n),n=Pt[n];let o;for(let r=0;r<3;r++)if(B[r].contains(e.target)){o=r;break}for(;t.length>0&&t[t.length-1]!==o;)t.pop();for(let r=0;r<3;r++)t.includes(r)||(B[r].style.visibility="hidden")});var P={};m(P,{attributes:()=>nt,initializeToolbar:()=>Ft,realElement:()=>$,showToolbar:()=>Ht});function s(e,t,n,o){o===void 0&&(o=`${e}-${n}`);let r=document.createElement(t);return r.id=n,r.dataset.name=o,r.dataset.type=e,r}function $(){let e=l();return s("container","div",e,`\u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8 (${e})`)}var h={},Z=e=>document.getElementById(e);function Ft(){h.layout=Z("container-toolbar-layout"),h.padding=Z("container-toolbar-padding"),h.border=Z("container-toolbar-border"),h.align=Z("container-toolbar-align"),h.layout.addEventListener("change",()=>{i().dataset.layout=h.layout.value}),h.padding.addEventListener("change",()=>{i().style.padding=h.padding.value+"px"}),h.border.addEventListener("change",()=>{i().dataset.border=h.border.value}),h.align.addEventListener("change",()=>{i().dataset.align=h.align.value})}function Ht(e){let t=nt(e);for(let[n,o]of Object.entries(t))h[n].value=o}function nt(e){return{layout:e.dataset.layout??"",padding:(e.style.padding??"0  ").slice(0,-2),border:e.dataset.border??"",align:e.dataset.align??""}}var _={};m(_,{attributes:()=>rt,children:()=>Ut,initializeToolbar:()=>qt,mounted:()=>Mt,realElement:()=>N,showToolbar:()=>Jt});var ot=[];function ee(e){let t=e.parentElement;for(;t.id!=="main-content";){if(ot.includes(t.id))return;t=t.parentElement}ot.push(e.id),e.contentEditable="true",console.log(`making ${e} contenteditable;`)}function N(){let e=l();return s("paragraph","p",e,`\u10DE\u10D0\u10E0\u10D0\u10D2\u10E0\u10D0\u10E4\u10D8 (${e})`)}function Mt(e){ee(e)}var Ut=["text","formula"],f={},G=e=>document.getElementById(e);function qt(){f["line-height"]=G("paragraph-toolbar-line-height"),f["first-line-indent"]=G("paragraph-toolbar-first-line-indent"),f["spacing-above"]=G("paragraph-toolbar-spacing-above"),f["spacing-below"]=G("paragraph-toolbar-spacing-below"),f.align=G("paragraph-toolbar-align"),f["line-height"].addEventListener("change",()=>{i().style.lineHeight=f["line-height"].value+"%"}),f["first-line-indent"].addEventListener("change",()=>{i().style.textIndent=f["first-line-indent"].value+"%"}),f["spacing-above"].addEventListener("change",()=>{i().style.marginTop=f["spacing-above"].value+"rem"}),f["spacing-below"].addEventListener("change",()=>{i().style.marginBottom=f["spacing-below"].value+"rem"}),f.align.addEventListener("change",()=>{i().style.textAlign=f.align.value})}function Jt(e){let t=rt(e);for(let[n,o]of Object.entries(t))f[n].value=o}function rt(e){return{"line-height":(e.style.lineHeight??"%").slice(0,-1),"first-line-indent":(e.style.lineHeight??"%").slice(0,-1),"spacing-above":(e.style.marginTop??"rem").slice(0,-2),"spacing-below":(e.style.marginBottom??"rem").slice(0,-2),align:e.style.textAlign??"left"}}var xe={};m(xe,{attributes:()=>it,initializeToolbar:()=>Vt,realElement:()=>Wt,showToolbar:()=>Qt});function Wt(){let e=l();return s("formula","span",e,`\u10E4\u10DD\u10E0\u10DB\u10E3\u10DA\u10D0 (${e})`)}var V={},Gt=e=>document.getElementById(e);function Vt(){V.content=Gt("formula-toolbar-content"),V.content.addEventListener("keyup",()=>{i().dataset.content=V.content.value;let e=MathJax.tex2mml(V.content.value);i().innerHTML=e,i().firstChild.setAttribute("display","inline")})}function Qt(e){let t=it(e);for(let[n,o]of Object.entries(t))V[n].value=o}function it(e){return{content:e.dataset.content??""}}var te={};m(te,{attributes:()=>at,initializeToolbar:()=>Kt,mounted:()=>Xt,realElement:()=>ve,showToolbar:()=>Yt});function ve(){let e=l();return s("text","span",e,`\u10E2\u10D4\u10E5\u10E1\u10E2\u10D8 (${e})`)}function Xt(e){ee(e)}var p={},F=e=>document.getElementById(e);function Kt(){p.content=F("text-toolbar-content"),p.color=F("text-toolbar-color"),p.bold=F("text-toolbar-bold"),p.italic=F("text-toolbar-italic"),p.underline=F("text-toolbar-underline"),p.size=F("text-toolbar-size"),console.log("but whyyyy"),p.content.addEventListener("keyup",()=>{i().innerText=p.content.value;let e="(T) "+p.content.value.slice(0,20);p.content.value.length>20&&(e+="..."),i().dataset.name=e,d().firstChild.innerText=e},!1),p.color.addEventListener("change",()=>{i().style.color=p.color.value},!1),p.bold.addEventListener("change",()=>{i().style.fontWeight=p.bold.checked?"bold":"normal"},!1),p.italic.addEventListener("change",()=>{i().style.fontStyle=p.italic.checked?"oblique":"normal"},!1),p.underline.addEventListener("change",()=>{i().style.textDecoration=p.underline.checked?"underline":"none"},!1),p.size.addEventListener("change",()=>{i().style.fontSize=p.size.value+"pt"},!1)}function Yt(e){let t=at(e);console.log(t,p);for(let[n,o]of Object.entries(t))p[n].value=o}function at(e){return{content:e.innerText,color:e.style.color??"black",bold:String(e.style.fontWeight==="bold"),italic:String(e.style.fontStyle==="oblique"),underline:String(e.style.textDecoration==="underline"),size:(e.style.fontSize??"12pt").slice(0,-2)}}var ke={};m(ke,{attributes:()=>lt,initializeToolbar:()=>en,realElement:()=>Zt,showToolbar:()=>tn});function Zt(){let e=l();return s("heading","h1",e,`\u10E1\u10D0\u10D7\u10D0\u10E3\u10E0\u10D8 (${e})`)}var y={},we=e=>document.getElementById(e);function en(){y.level=we("heading-toolbar-level"),y.content=we("heading-toolbar-content"),y.align=we("heading-toolbar-align"),y.content.addEventListener("keyup",()=>{i().innerText=y.content.value;let e="(H) "+y.content.value.slice(0,20);y.content.value.length>20&&(e+="..."),i().dataset.name=e,d().firstChild.innerText=e},!1),y.level.addEventListener("change",()=>{let e=i(),t=document.createElement(`h${y.level.value}`);t.id=e.id,t.textContent=e.textContent,t.style.textAlign=e.style.textAlign,t.dataset.type=e.dataset.type,t.dataset.name=e.dataset.name,e.replaceWith(t),Ie(t)}),y.align.addEventListener("change",()=>{i().style.textAlign=y.align.value})}function tn(e){let t=lt(e);for(let[n,o]of Object.entries(t))y[n].value=o}function lt(e){return{content:e.innerText,level:e.tagName.slice(1),align:e.style.textAlign??"center"}}var oe={};m(oe,{attributes:()=>st,initializeToolbar:()=>on,realElement:()=>Ce,showToolbar:()=>rn});function Ce(){let e=document.createElement("input");return e.type="text",e.id=l(),e.dataset.name=`\u10DB\u10DD\u10D9\u10DA\u10D4 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="shortTextInput",e}var ne={},nn=e=>document.getElementById(e);function on(){ne.width=nn("shortTextInput-toolbar-width"),ne.width.addEventListener("change",()=>{i().style.width=ne.width.value+"ch"})}function rn(e){let t=st(e);for(let[n,o]of Object.entries(t))ne[n].value=o}function st(e){return{width:e.style.width.slice(0,-2)}}var Te={};m(Te,{attributes:()=>ct,initializeToolbar:()=>sn,realElement:()=>an,showToolbar:()=>cn});function an(){let e=document.createElement("textarea");return e.id=l(),e.dataset.name=`\u10D2\u10E0\u10EB\u10D4\u10DA\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="longTextInput",e}var re={},ln=e=>document.getElementById(e);function sn(){re.width=ln("longTextInput-toolbar-width"),re.width.addEventListener("change",()=>{i().cols=Number(re.width.value)})}function cn(e){let t=ct(e);for(let[n,o]of Object.entries(t))re[n].value=o}function ct(e){return{width:String(e.cols)}}var ae={};m(ae,{attributes:()=>dt,children:()=>dn,initializeToolbar:()=>pn,realElement:()=>Le,showToolbar:()=>mn});function Le(){let e=l();return s("multipleChoiceInput","ol",e,`\u10DB\u10E0\u10D0\u10D5\u10D0\u10DA\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var dn=["multipleChoiceItem"],ie={};function pn(){ie.numbering=document.getElementById("multipleChoiceInput-toolbar-numbering"),ie.numbering.addEventListener("change",()=>{i().dataset.numbering=ie.numbering.value})}function mn(e){let t=dt(e);for(let[n,o]of Object.entries(t))ie[n].value=o}function dt(e){return{numbering:e.dataset.numbering??"letters"}}var le={};m(le,{attributes:()=>hn,initializeToolbar:()=>fn,parents:()=>un,realElement:()=>H,showToolbar:()=>gn});function H(){let e=document.createElement("li");e.dataset.type="multipleChoiceItem",e.id=l(),e.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${e.id})`;let t=document.createElement("input");return t.type="checkbox",t.id=l(),e.appendChild(t),e}var un=["multipleChoiceInput"];function fn(){}function gn(e){}function hn(e){return{}}var ce={};m(ce,{attributes:()=>pt,children:()=>bn,initializeToolbar:()=>yn,realElement:()=>Be,showToolbar:()=>En});function Be(){let e=l();return s("singleChoiceInput","ol",e,`\u10D4\u10E0\u10D7\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var bn=["singleChoiceItem"],se={};function yn(){se.numbering=document.getElementById("singleChoiceInput-toolbar-numbering"),se.numbering.addEventListener("change",()=>{i().dataset.numbering=se.numbering.value})}function En(e){let t=pt(e);for(let[n,o]of Object.entries(t))se[n].value=o}function pt(e){return{numbering:e.dataset.numbering??"letters"}}var de={};m(de,{attributes:()=>kn,initializeToolbar:()=>vn,parents:()=>xn,realElement:()=>Se,showToolbar:()=>wn});function Se(e){let t=document.createElement("li");t.dataset.type="singleChoiceItem",t.id=l(),t.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${t.id})`;let n=document.createElement("input");return n.type="radio",n.id=l(),n.name=e,t.appendChild(n),t}var xn=["singleChoiceInput"];function vn(){}function wn(e){}function kn(e){return{}}var Re={};m(Re,{attributes:()=>Bn,children:()=>Cn,initializeToolbar:()=>Tn,realElement:()=>In,showToolbar:()=>Ln});function In(){let e=l();return s("browserSim","browser-sim",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10E1\u10D8\u10DB\u10E3\u10DA\u10D0\u10E2\u10DD\u10E0\u10D8 (${e})`)}var Cn=["browserPage"];function Tn(){}function Ln(e){}function Bn(e){return{}}var Ne={};m(Ne,{attributes:()=>mt,initializeToolbar:()=>$n,parents:()=>Rn,realElement:()=>Sn,showToolbar:()=>Nn});function Sn(){let e=l(),t=s("browserPage","browser-page",e,`\u10D2\u10D5\u10D4\u10E0\u10D3\u10D8 (${e})`);return t.setAttribute("closable","true"),t}var Rn=["browserSim"],k={},$e=e=>document.getElementById(e);function $n(){k.closable=$e("browserPage-toolbar-closable"),k.title=$e("browserPage-toolbar-title"),k.url=$e("browserPage-toolbar-url"),k.closable.addEventListener("change",()=>{i().setAttribute("closable",String(k.closable.checked))}),k.title.addEventListener("keyup",()=>{i().setAttribute("title",k.title.value)}),k.url.addEventListener("keyup",()=>{i().setAttribute("url",k.url.value)})}function Nn(e){let t=mt(e);for(let[n,o]of Object.entries(t))k[n].value=o}function mt(e){return{closable:e.getAttribute("closable")??"true",title:e.getAttribute("title")??"",url:e.getAttribute("url")??e.id}}var Oe={};m(Oe,{attributes:()=>ft,children:()=>zn,initializeToolbar:()=>An,realElement:()=>On,showToolbar:()=>jn});function On(){let e=l();return s("browserLink","browser-link",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10DA\u10D8\u10DC\u10D9\u10D8 (${e})`)}var zn=["text","image"],O={},ut=e=>document.getElementById(e);function An(){O.browser=ut("browserLink-toolbar-browser"),O.url=ut("browserLink-toolbar-url"),O.browser.addEventListener("change",()=>{i().setAttribute("browser",O.browser.value)}),O.url.addEventListener("change",()=>{i().setAttribute("url",O.url.value)})}function jn(e){let t=ft(e);for(let[n,o]of Object.entries(t))O[n].value=o}function ft(e){return{browser:e.getAttribute("browser")??"",url:e.getAttribute("to")??""}}var Pe={};m(Pe,{attributes:()=>gt,children:()=>Jn,initializeToolbar:()=>Vn,realElement:()=>qn,showToolbar:()=>Qn});var Ae={};m(Ae,{attributes:()=>Fn,children:()=>Dn,initializeToolbar:()=>Pn,realElement:()=>ze,showToolbar:()=>_n});function ze(){let e=l();return s("tableRow","tr",e,"\u10E1\u10E2\u10E0\u10D8\u10E5\u10DD\u10DC\u10D8")}var Dn=[];function Pn(){}function _n(e){}function Fn(e){return{}}var je={};m(je,{attributes:()=>Un,initializeToolbar:()=>Hn,realElement:()=>pe,showToolbar:()=>Mn});function pe(){let e=l();return s("tableElement","td",e,"\u10D4\u10DA\u10D4\u10DB\u10D4\u10DC\u10E2\u10D8")}function Hn(){}function Mn(e){}function Un(e){return{}}function qn(){let e=l(),t=s("table","table",e,`\u10EA\u10EE\u10E0\u10D8\u10DA\u10D8 (${e})`);return t.appendChild(ze()),t.lastChild.appendChild(pe()),t}var Jn=[];function Wn(e,t){let n=e.children.length;if(n<t)for(let o=0;o<t-n;o++){let r=Q(e.lastChild);e.appendChild(r)}else if(n>t)for(;e.children.length>t;)e.lastChild.remove();e.dataset.rows=String(t),_e(e)}function Gn(e,t){let n=e.firstChild.children.length;for(let o of e.children)if(n<t)for(let r=0;r<t-n;r++)o.appendChild(pe());else for(;o.children.length;)o.lastChild.remove();e.dataset.cols=String(t),_e(e)}var x={},De=e=>document.getElementById(e);function Vn(){x.style=De("table-toolbar-style"),x.rows=De("table-toolbar-rows"),x.cols=De("table-toolbar-cols"),x.style.addEventListener("change",()=>{i().dataset.style=x.style.value}),x.rows.addEventListener("change",()=>{let e=i();Wn(e,Number(x.rows.value))}),x.cols.addEventListener("change",()=>{let e=i();Gn(e,Number(x.cols.value))})}function Qn(e){let t=gt(e);console.log(x,t);for(let[n,o]of Object.entries(t))x[n].value=o}function gt(e){return{style:e.dataset.style||"empty",rows:e.dataset.rows||"1",cols:e.dataset.cols||"1"}}var Ue={};m(Ue,{attributes:()=>xt,initializeToolbar:()=>Yn,realElement:()=>Kn,showToolbar:()=>Zn});var Xn={Authorization:"Bearer "+(localStorage.getItem("authToken")??"")};function me(){return Xn}var ue="https://terryapi.dimitri.ge/api";async function ht(e){let t=await fetch(`${ue}/test/${e}`,{headers:me()});if(!t.ok)throw new Error(t.statusText);let n=await t.json();return{id:e,...n}}function bt(e,t){return console.log("trying to upload",t,"for test",e),fetch(`${ue}/test/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",...me()},body:JSON.stringify({...t,gradingScheme:JSON.stringify(t.gradingScheme)})})}function Fe(e,t){return`${ue}/image/${e}/${t}`}async function yt(e,t,n){let o=new FormData;return o.append("image",n),(await fetch(Fe(e,t),{method:"POST",headers:{...me()},body:o})).ok}var L;async function He(e,t){return L=e,localStorage.setItem("currentFile",JSON.stringify(e)),t!==void 0?(await bt(t,e)).ok:!1}async function Et(e){if(e!==void 0)try{return L=await ht(e),L}catch(n){console.log(n)}let t=localStorage.getItem("currentFile");return t!=null?L=JSON.parse(t):L={content:'<div data-type="container" data-name="\u10DB\u10D7\u10D0\u10D5\u10D0\u10E0\u10D8 \u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8" id="0" data-pages="1"></div>'},L}function Kn(){let e=l();return s("image","img",e,`\u10E1\u10E3\u10E0\u10D0\u10D7\u10D8 (${e})`)}var I={},Me=e=>document.getElementById(e);function Yn(){I.image=Me("image-toolbar-image"),I.width=Me("image-toolbar-width"),I.float=Me("image-toolbar-float"),I.image.addEventListener("change",async e=>{let t=e.target.files,n=t[0];if(await yt(L.id,n.name,n))i().src=Fe(L.id,n.name);else{let o=new FileReader;o.onload=r=>{i().src=r.target.result},o.readAsDataURL(e.target.files[0])}console.log(t)}),I.width.addEventListener("change",()=>{i().style.width=`${I.width.value}px`}),I.float.addEventListener("change",()=>{i().style.float=I.float.value})}function Zn(e){let t=xt(e);for(let[n,o]of Object.entries(t))I[n]&&(I[n].value=o)}function xt(e){return{url:e.src??"",width:(e.style.width??"100px").slice(0,-2),float:e.style.float??"left"}}function v(e){let t=e.dataset.type,n=e.id,o=e.dataset.name,r=[];for(let a of e.children){let c=v(a);c&&(c instanceof HTMLElement?r.push(c):r.push(...c))}if(t!==void 0){let a=document.createElement("div");a.innerHTML=r.length===0?`<div class="list" tabindex="0" data-id="${n}" data-type="${t}"><span data-type="${t}">${o}</span></div>`:`<details open class="list" tabindex="0" data-id="${n}" data-type="${t}"><summary data-type="${t}">${o}</summary></details>`;let c=a.firstChild;for(let Y of r)c.appendChild(Y);return c}else return r}var u={container:P,paragraph:_,formula:xe,text:te,shortTextInput:oe,multipleChoiceInput:ae,multipleChoiceItem:le,singleChoiceInput:ce,singleChoiceItem:de,browserSim:Re,browserPage:Ne,browserLink:Oe,table:Pe,tableRow:Ae,tableElement:je,image:Ue,longTextInput:Te,heading:ke};console.log(u);function vt(){console.log("hello");for(let{initializeToolbar:e}of Object.values(u))e&&e()}function qe(e){let t=[];console.log(e.dataset.type),console.log(u);for(let n of Object.keys(u)){let o=!0;u[e.dataset.type].children!==void 0&&(o&&=u[e.dataset.type].children.includes(n)),u[n].parents!==void 0&&(o&&=u[n].parents.includes(e.dataset.type)),o&&t.push(n)}return console.log(t),t}var eo=document.getElementById("page-buttons"),wt=document.getElementById("add-page"),M=0,b=0,C=[],kt=[];function fe(){let e=document.createElement("input");e.type="radio",e.id=`page-${b+1}`,e.name="current-page";let t=b;e.addEventListener("change",()=>{It(t)});let n=document.createElement("label");n.innerText=String(b+1),n.appendChild(e),eo.insertBefore(n,wt),kt.push(n),C.push([]),b+=1,g.firstElementChild.dataset.pages=String(b)}function to(){for(let e of C[M])e.classList.remove("current")}function It(e){if(e<b&&e>=0){console.log(C[e]),to(),M=e;for(let t of C[M])t.classList.add("current")}}function z(e){switch(e.dataset.visibilityType??"always"){case"only":{let n=Number(e.dataset.visibleOnlyOn??"1");for(;n>b;)fe();Tt(e,n);break}case"range":{let n=Number(e.dataset.visibleFrom??"1"),o=Number(e.dataset.visibleTo??"1");for(;n>b;)fe();for(;o>b;)fe();oo(e,n,o);break}}for(let n of e.children)z(n);no()}function Ct(e,t,n){for(let o=0;o<b;o++)if(o<t||o>n){let r=C[o].indexOf(e);r>=0&&C[o].splice(r,1)}}function no(){for(let e=b-1;e>0&&!(C[e].length>0);e--)C.pop(),kt.pop().remove(),b--}function Tt(e,t,n=!0){t-=1,t<b&&t>=0&&(C[t].includes(e)||C[t].push(e),n&&Ct(e,t,t),t===M&&It(t))}function oo(e,t,n){for(let o=t;o<=n;o++)Tt(e,o,!1);Ct(e,t-1,n-1)}wt.addEventListener("click",()=>{fe()});var Bt={general:["visibility-type","visible-only-on","visible-from","visible-to"]},ro={general:e=>{let t={"visibility-type":e.dataset.visibilityType||"always"};switch(t["visibility-type"]){case"only":t["visible-only-on"]=e.dataset.visibleOnlyOn||"1";break;case"range":t["visible-from"]=e.dataset.visibleFrom||"1",t["visible-to"]=e.dataset.visibleTo||"1";break}return t}},E={};for(let e of Object.keys(Bt)){let t={};for(let n of Bt[e]){let o=document.getElementById(`${e}-toolbar-${n}`);console.log(e,n),t[n]={element:o,addEventListener:o.addEventListener,set value(r){if(o.nodeName==="INPUT"){let a=o;switch(a.type){case"text":case"number":a.value=r;break;case"checkbox":a.checked=r}}(o.nodeName==="SELECT"||o.nodeName==="TEXTAREA")&&(o.value=r),this.setTrigger(r)},setTrigger(r){}}}E[e]=t}var St={_elements:{},_current:void 0,show(e){this._current&&this._current.classList.remove("current");let t=e.dataset.type;if(this._elements[t]===void 0&&(this._elements[t]=document.getElementById(`${t}-toolbar`)),this._current=this._elements[t],t==="browserLink"){let r=function(a){a.tagName==="BROWSER-SIM"&&(o[a.dataset.name]=a.id),a.tagName==="BROWSER-PAGE"&&n.push(a.getAttribute("url"));for(let c of a.children)r(c)},n=[],o={};r(g),E.browserLink.url.element.innerHTML="",E.browserLink.browser.element.innerHTML="";for(let a of n){let c=document.createElement("option");c.value=a,c.innerText=a,E.browserLink.url.element.appendChild(c)}for(let a of Object.keys(o)){let c=document.createElement("option");c.value=o[a],c.innerText=a,E.browserLink.browser.element.appendChild(c)}}if(this._current){this._current.classList.add("current"),u[t].showToolbar(e);let n=ro.general(e);for(let o of Object.keys(n))E.general[o].value=n[o]}},hide(){this._current&&(this._current.classlist.remove("current"),this._current=void 0)}};function io(){E.general["visibility-type"].setTrigger=e=>{Je.dataset.visibilityType=e},E.general["visibility-type"].element.addEventListener("change",e=>{E.general["visibility-type"].setTrigger(e.target.value),i().dataset.visibilityType=e.target.value}),E.general["visible-only-on"].element.addEventListener("change",e=>{i().dataset.visibleOnlyOn=e.target.value,z(i())}),E.general["visible-from"].element.addEventListener("change",e=>{i().dataset.visibleFrom=e.target.value,z(i())}),E.general["visible-to"].element.addEventListener("change",e=>{i().dataset.visibleTo=e.target.value,z(i())})}io();var We=0;function l(){return String(We++)}function Ge(e){let t=Number(e.id);t>=We&&(We=t+1);for(let n of e.children)Ge(n)}function Q(e){let t=e.cloneNode(!0);function n(o){o.id=l();for(let r of o.children)n(r)}return n(t),t}var A;function d(){return A}function j(){$t(),A&&(A.blur(),A.removeAttribute("id")),A=void 0}function ge(e){j(),A=e,A.setAttribute("id","selected");let t=document.getElementById(e.dataset.id);Ie(t),St.show(t)}function Rt(e){ge(e)}function _e(e){let t=e.id,n=S.querySelector(`[data-id="${t}"]`);n.parentElement.replaceChild(v(e),n)}var U;function i(){return U}function $t(){U&&U.classList.remove("selected"),U=void 0}function Ie(e){$t(),U=e,U.classList.add("selected")}var Ve={multipleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},singleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},shortTextInput:e=>({correct:e.value})};var Qe;function Nt(){Qe={};for(let e of Object.keys(Ve))for(let t of g.querySelectorAll(`[data-type=${e}]`))console.log("extracted",Ve[e](t)),Qe[t.id]=Ve[e](t);return Qe}var he=class{#n=100;#t=[];#e=-1;update(t){this.#t.splice(0,this.#e,t),this.#t.length>=this.#n&&this.#t.splice(this.#n),this.#e=-1,console.log(this.#t)}canGoBack(){return this.#e<this.#t.length-1}goBack(){return this.#e+=1,console.log("returning version",this.#e),this.#t[this.#e]}canGoForward(){return this.#e>0}goForward(){return this.#e-=1,console.log("returning version",this.#e),this.#t[this.#e]}};var Ot=document.getElementById("test-name"),ao=window.location.search,lo=new URLSearchParams(ao),be=lo.get("id"),zt=e=>{e.classList.remove("selected"),e.className===""&&e.removeAttribute("class");for(let t of e.children)zt(t)},Xe=class{get content(){let t=g.cloneNode(!0);return zt(t),t.innerHTML.trim().replaceAll(/[\s\t][\s\t]+/g,"").replaceAll(' contenteditable="true"',"")}get gradingScheme(){return JSON.stringify(Nt())}get name(){return Ot.value}export(){return{content:this.content,gradingScheme:this.gradingScheme,name:this.name}}load({name:t,content:n,gradingScheme:o}){g.innerHTML=n;for(let r of g.getElementsByTagName("p"))r.contentEditable="true";for(let r of g.getElementsByTagName("span"))r.contentEditable="true";if(Ge(g.firstChild),o){let r=JSON.parse(o);for(let a of Object.keys(r))document.getElementById(a).value=r[a].correct}S.innerHTML="",S.appendChild(v(g.firstElementChild)),z(g.firstElementChild),t&&(Ot.value=t)}},q=new he;document.getElementById("undo").addEventListener("click",()=>{if(q.canGoBack()){let e=q.goBack();J.load(e)}else console.log("can't go back anymore")});document.getElementById("redo").addEventListener("click",()=>{if(q.canGoForward()){let e=q.goForward();J.load(e)}else console.log("can't go forward anymore")});function T(){q.update(J.export())}var J=new Xe;document.getElementById("save-test").addEventListener("click",async()=>{await He(J.export(),be??void 0)});function At(e){e.preventDefault()}document.getElementById("preview").addEventListener("click",async()=>{await He(J.export(),be??void 0)&&(removeEventListener("beforeunload",At),window.location.href=`/player/?id=${be}&page=${M+1}`)});addEventListener("beforeunload",At);async function so(){let e=await Et(be);J.load(e),q.update(e)}so();var S=document.getElementById("tree-view"),g=document.getElementById("main-content"),Je=document.getElementById("right-pane"),Ke=!1;S.addEventListener("click",e=>{d()!==void 0&&(d().contains(e.target)||j(),Ke||e.preventDefault(),Ke=!0)},!0);S.addEventListener("contextmenu",e=>{let t=e.target;if(e.preventDefault(),t.classList.contains("list"))ge(t);else if(t.parentElement.classList.contains("list"))ge(t.parentElement);else return;e.stopPropagation();let n=["rcm-add-child","rcm-add-preset","rcm-copy","rcm-delete","rcm-rename"];(t.parentElement.parentElement.parentElement.classList.contains("list")||t.parentElement.parentElement.classList.contains("list"))&&n.push("rcm-add-sibbling"),X.isCopying()&&(n.push("rcm-paste-child"),t.parentElement?.classList.contains("list")&&n.push("rcm-paste-above")),D(w.rightClick,n,t)},!0);S.addEventListener("focus",e=>{let t=e.target;t.classList.contains("list")||(t=t.parentElement),t.classList.contains("list")&&(Rt(t),Ke=!1)},!0);Je.addEventListener("change",()=>{T()});var Ye={};m(Ye,{realElement:()=>co});function co(){let e=$();return e.appendChild(N()),e.appendChild(Ce()),e}var Ze={};m(Ze,{realElement:()=>po});function po(){let e=$();e.appendChild(N());let t=Le();return t.appendChild(H()),t.appendChild(H()),t.appendChild(H()),t.appendChild(H()),e.appendChild(t),e}var et={};m(et,{realElement:()=>mo});function ye(e){let t=Se(e),n=ve();return t.append(n),n.innerText=" abc ",t}function mo(){let e=$();e.appendChild(N());let t=Be();return t.appendChild(ye(t.id)),t.appendChild(ye(t.id)),t.appendChild(ye(t.id)),t.appendChild(ye(t.id)),e.appendChild(t),e}var W={shortTextQuestion:Ye,multipleChoiceQuestion:Ze,singleChoiceQuestion:et};function jt(){let e=[];for(let t of Object.keys(W))e.push(t);return e}var Ee=class{#n;set data(t){this.#n=t}get data(){return this.#n}isCopying(){return this.#n!==void 0}};var K,X=new Ee;function uo(){document.getElementById("rcm-add-child").addEventListener("click",e=>{K=fo,D(w.element,qe(d()),e.target)},!1),document.getElementById("rcm-add-sibbling").addEventListener("click",e=>{K=go,D(w.element,qe(d().parentElement),e.target)},!1),document.getElementById("rcm-add-preset").addEventListener("click",e=>{K=ho,D(w.preset,jt(),e.target)},!1),document.getElementById("rcm-copy").addEventListener("click",e=>{let t=d().dataset.id;X.data=document.getElementById(t),R()},!1),document.getElementById("rcm-paste-child").addEventListener("click",e=>{let t=Q(X.data);i().appendChild(t),d().parentElement.replaceChild(v(i()),d()),R(),T()},!1),document.getElementById("rcm-paste-above").addEventListener("click",e=>{let t=Q(X.data);i().parentElement.insertBefore(t,i());let n=v(i().parentElement);d().parentElement.parentElement.replaceChild(n,d().parentElement),R(),T()},!1),document.getElementById("rcm-delete").addEventListener("click",e=>{let t=d().dataset.id;d().remove(),j(),document.getElementById(t).remove(),R(),T()},!1),document.getElementById("rcm-rename").addEventListener("click",e=>{let t=d().dataset.id,n=d().firstChild,o=n.innerText,r=document.createElement("input");r.type="text",r.value=o,d().insertBefore(r,n),n.remove(),r.focus(),r.addEventListener("blur",a=>{r.contains(a.relatedTarget)||(n.innerText=r.value,document.getElementById(t).dataset.name=r.value,d().insertBefore(n,r),r.remove())}),r.addEventListener("click",a=>{a.stopPropagation()}),r.addEventListener("keyup",a=>{(a.key==="Enter"||a.key==="Escape")&&r.blur()}),n.remove(),T()},!1);for(let e of Object.keys(u)){let t=document.getElementById(e);t&&t.addEventListener("click",()=>{K(d(),e),j(),R()})}for(let e of Object.keys(W)){let t=document.getElementById(e);t&&t.addEventListener("click",()=>{K(d(),e),j(),R()})}vt()}uo();function fo(e,t){let n=e.dataset.id,o=document.getElementById(n),r=u[t].realElement(n);if(o.appendChild(r),u[t].mounted!==void 0&&u[t].mounted(r),e.appendChild(v(r)),e.tagName==="DIV"){let a=document.createElement("details");a.classList.add("list"),a.tabIndex=0,a.dataset.id=n,a.dataset.type=e.dataset.type,a.open=!0;let c=document.createElement("summary");c.dataset.type=e.dataset.type,c.innerText=e.firstChild.innerText,a.appendChild(c);let Y=[...e.children].slice(1);console.log(Y),a.append(...Y),e.replaceWith(a)}T()}function go(e,t){let n=e.dataset.id,o=document.getElementById(n),r=o.parentElement,a=e.parentElement.id,c=u[t].realElement(a);r.insertBefore(c,o),u[t].mounted!==void 0&&u[t].mounted(c),e.parentElement.insertBefore(v(c),e),T()}function ho(e,t){let n=e.dataset.id,o=document.getElementById(n),r=W[t].realElement();o.appendChild(r),W[t].mounted!==void 0&&W[t].mounted(r),e.parentElement.replaceChild(v(o),e),T()}export{X as copyBuffer};
