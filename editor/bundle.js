var Pt=Object.defineProperty;var m=(e,t)=>{for(var n in t)Pt(e,n,{get:t[n],enumerable:!0})};var w=function(e){return e[e.rightClick=0]="rightClick",e[e.element=1]="element",e[e.preset=2]="preset",e}({}),B=[document.getElementById("left-pane-right-click-menu"),document.getElementById("element-menu"),document.getElementById("preset-menu")],_t={[w.element]:w.rightClick,[w.preset]:w.rightClick},nt;function $(){for(let e of B)e.style.visibility="hidden"}function Ft(e,t){let n=t.getBoundingClientRect();B[e].style.top=`${n.top}px`,B[e].style.left=`calc(${n.right}px + 0.25rem)`,B[e].style.visibility="visible",nt=e}function D(e,t,n){if(t.length>0)for(let o of B[e].children)o.disabled=!t.includes(o.id);else{console.error("requested to open a menu with 0 options.");for(let o of B[e].children)o.disabled=!1}Ft(e,n)}document.addEventListener("click",function(e){let t=[],n=nt;for(;n!==void 0;)t.push(n),n=_t[n];let o;for(let r=0;r<3;r++)if(B[r].contains(e.target)){o=r;break}for(;t.length>0&&t[t.length-1]!==o;)t.pop();for(let r=0;r<3;r++)t.includes(r)||(B[r].style.visibility="hidden")});var P={};m(P,{attributes:()=>ot,initializeToolbar:()=>Ht,realElement:()=>O,showToolbar:()=>Jt});function s(e,t,n,o){o===void 0&&(o=`${e}-${n}`);let r=document.createElement(t);return r.id=n,r.dataset.name=o,r.dataset.type=e,r}function O(){let e=l();return s("container","div",e,`\u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8 (${e})`)}var h={},Z=e=>document.getElementById(e);function Ht(){h.layout=Z("container-toolbar-layout"),h.padding=Z("container-toolbar-padding"),h.border=Z("container-toolbar-border"),h.align=Z("container-toolbar-align"),h.layout.addEventListener("change",()=>{i().dataset.layout=h.layout.value}),h.padding.addEventListener("change",()=>{i().style.padding=h.padding.value+"px"}),h.border.addEventListener("change",()=>{i().dataset.border=h.border.value}),h.align.addEventListener("change",()=>{i().dataset.align=h.align.value})}function Jt(e){let t=ot(e);for(let[n,o]of Object.entries(t))h[n].value=o}function ot(e){return{layout:e.dataset.layout??"",padding:(e.style.padding??"0  ").slice(0,-2),border:e.dataset.border??"",align:e.dataset.align??""}}var _={};m(_,{attributes:()=>it,children:()=>Ut,initializeToolbar:()=>qt,mounted:()=>Mt,realElement:()=>R,showToolbar:()=>Wt});var rt=[];function ee(e){let t=e.parentElement;for(;t.id!=="main-content";){if(rt.includes(t.id))return;t=t.parentElement}rt.push(e.id),e.contentEditable="true",console.log(`making ${e} contenteditable;`)}function R(){let e=l();return s("paragraph","p",e,`\u10DE\u10D0\u10E0\u10D0\u10D2\u10E0\u10D0\u10E4\u10D8 (${e})`)}function Mt(e){ee(e)}var Ut=["text","formula"],f={},G=e=>document.getElementById(e);function qt(){f["line-height"]=G("paragraph-toolbar-line-height"),f["first-line-indent"]=G("paragraph-toolbar-first-line-indent"),f["spacing-above"]=G("paragraph-toolbar-spacing-above"),f["spacing-below"]=G("paragraph-toolbar-spacing-below"),f.align=G("paragraph-toolbar-align"),f["line-height"].addEventListener("change",()=>{i().style.lineHeight=f["line-height"].value+"%"}),f["first-line-indent"].addEventListener("change",()=>{i().style.textIndent=f["first-line-indent"].value+"%"}),f["spacing-above"].addEventListener("change",()=>{i().style.marginTop=f["spacing-above"].value+"rem"}),f["spacing-below"].addEventListener("change",()=>{i().style.marginBottom=f["spacing-below"].value+"rem"}),f.align.addEventListener("change",()=>{i().style.textAlign=f.align.value})}function Wt(e){let t=it(e);for(let[n,o]of Object.entries(t))f[n].value=o}function it(e){return{"line-height":(e.style.lineHeight??"%").slice(0,-1),"first-line-indent":(e.style.lineHeight??"%").slice(0,-1),"spacing-above":(e.style.marginTop??"rem").slice(0,-2),"spacing-below":(e.style.marginBottom??"rem").slice(0,-2),align:e.style.textAlign??"left"}}var ve={};m(ve,{attributes:()=>at,initializeToolbar:()=>Qt,realElement:()=>Gt,showToolbar:()=>Xt});function Gt(){let e=l();return s("formula","span",e,`\u10E4\u10DD\u10E0\u10DB\u10E3\u10DA\u10D0 (${e})`)}var V={},Vt=e=>document.getElementById(e);function Qt(){V.content=Vt("formula-toolbar-content"),V.content.addEventListener("keyup",()=>{i().dataset.content=V.content.value;let e=MathJax.tex2mml(V.content.value);i().innerHTML=e,i().firstChild.setAttribute("display","inline")})}function Xt(e){let t=at(e);for(let[n,o]of Object.entries(t))V[n].value=o}function at(e){return{content:e.dataset.content??""}}var te={};m(te,{attributes:()=>lt,initializeToolbar:()=>Yt,mounted:()=>Kt,realElement:()=>we,showToolbar:()=>Zt});function we(){let e=l();return s("text","span",e,`\u10E2\u10D4\u10E5\u10E1\u10E2\u10D8 (${e})`)}function Kt(e){ee(e)}var p={},F=e=>document.getElementById(e);function Yt(){p.content=F("text-toolbar-content"),p.color=F("text-toolbar-color"),p.bold=F("text-toolbar-bold"),p.italic=F("text-toolbar-italic"),p.underline=F("text-toolbar-underline"),p.size=F("text-toolbar-size"),console.log("but whyyyy"),p.content.addEventListener("keyup",()=>{i().innerText=p.content.value;let e="(T) "+p.content.value.slice(0,20);p.content.value.length>20&&(e+="..."),i().dataset.name=e,d().firstChild.innerText=e},!1),p.color.addEventListener("change",()=>{i().style.color=p.color.value},!1),p.bold.addEventListener("change",()=>{i().style.fontWeight=p.bold.checked?"bold":"normal"},!1),p.italic.addEventListener("change",()=>{i().style.fontStyle=p.italic.checked?"oblique":"normal"},!1),p.underline.addEventListener("change",()=>{i().style.textDecoration=p.underline.checked?"underline":"none"},!1),p.size.addEventListener("change",()=>{i().style.fontSize=p.size.value+"pt"},!1)}function Zt(e){let t=lt(e);console.log(t,p);for(let[n,o]of Object.entries(t))p[n].value=o}function lt(e){return{content:e.innerText,color:e.style.color??"black",bold:String(e.style.fontWeight==="bold"),italic:String(e.style.fontStyle==="oblique"),underline:String(e.style.textDecoration==="underline"),size:(e.style.fontSize??"12pt").slice(0,-2)}}var Ce={};m(Ce,{attributes:()=>st,initializeToolbar:()=>tn,realElement:()=>en,showToolbar:()=>nn});function en(){let e=l();return s("heading","h1",e,`\u10E1\u10D0\u10D7\u10D0\u10E3\u10E0\u10D8 (${e})`)}var y={},ke=e=>document.getElementById(e);function tn(){y.level=ke("heading-toolbar-level"),y.content=ke("heading-toolbar-content"),y.align=ke("heading-toolbar-align"),y.content.addEventListener("keyup",()=>{i().innerText=y.content.value;let e="(H) "+y.content.value.slice(0,20);y.content.value.length>20&&(e+="..."),i().dataset.name=e,d().firstChild.innerText=e},!1),y.level.addEventListener("change",()=>{let e=i(),t=document.createElement(`h${y.level.value}`);t.id=e.id,t.textContent=e.textContent,t.style.textAlign=e.style.textAlign,t.dataset.type=e.dataset.type,t.dataset.name=e.dataset.name,e.replaceWith(t),Ie(t)}),y.align.addEventListener("change",()=>{i().style.textAlign=y.align.value})}function nn(e){let t=st(e);for(let[n,o]of Object.entries(t))y[n].value=o}function st(e){return{content:e.innerText,level:e.tagName.slice(1),align:e.style.textAlign??"center"}}var oe={};m(oe,{attributes:()=>ct,initializeToolbar:()=>rn,realElement:()=>Te,showToolbar:()=>an});function Te(){let e=document.createElement("input");return e.type="text",e.id=l(),e.dataset.name=`\u10DB\u10DD\u10D9\u10DA\u10D4 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="shortTextInput",e}var ne={},on=e=>document.getElementById(e);function rn(){ne.width=on("shortTextInput-toolbar-width"),ne.width.addEventListener("change",()=>{i().style.width=ne.width.value+"ch"})}function an(e){let t=ct(e);for(let[n,o]of Object.entries(t))ne[n].value=o}function ct(e){return{width:e.style.width.slice(0,-2)}}var Le={};m(Le,{attributes:()=>dt,initializeToolbar:()=>cn,realElement:()=>ln,showToolbar:()=>dn});function ln(){let e=document.createElement("textarea");return e.id=l(),e.dataset.name=`\u10D2\u10E0\u10EB\u10D4\u10DA\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="longTextInput",e}var re={},sn=e=>document.getElementById(e);function cn(){re.width=sn("longTextInput-toolbar-width"),re.width.addEventListener("change",()=>{i().cols=Number(re.width.value)})}function dn(e){let t=dt(e);for(let[n,o]of Object.entries(t))re[n].value=o}function dt(e){return{width:String(e.cols)}}var ae={};m(ae,{attributes:()=>pt,children:()=>pn,initializeToolbar:()=>mn,realElement:()=>Be,showToolbar:()=>un});function Be(){let e=l();return s("multipleChoiceInput","ol",e,`\u10DB\u10E0\u10D0\u10D5\u10D0\u10DA\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var pn=["multipleChoiceItem"],ie={};function mn(){ie.numbering=document.getElementById("multipleChoiceInput-toolbar-numbering"),ie.numbering.addEventListener("change",()=>{i().dataset.numbering=ie.numbering.value})}function un(e){let t=pt(e);for(let[n,o]of Object.entries(t))ie[n].value=o}function pt(e){return{numbering:e.dataset.numbering??"letters"}}var le={};m(le,{attributes:()=>bn,initializeToolbar:()=>gn,parents:()=>fn,realElement:()=>H,showToolbar:()=>hn});function H(){let e=document.createElement("li");e.dataset.type="multipleChoiceItem",e.id=l(),e.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${e.id})`;let t=document.createElement("input");return t.type="checkbox",t.id=l(),e.appendChild(t),e}var fn=["multipleChoiceInput"];function gn(){}function hn(e){}function bn(e){return{}}var ce={};m(ce,{attributes:()=>mt,children:()=>yn,initializeToolbar:()=>En,realElement:()=>Se,showToolbar:()=>xn});function Se(){let e=l();return s("singleChoiceInput","ol",e,`\u10D4\u10E0\u10D7\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var yn=["singleChoiceItem"],se={};function En(){se.numbering=document.getElementById("singleChoiceInput-toolbar-numbering"),se.numbering.addEventListener("change",()=>{i().dataset.numbering=se.numbering.value})}function xn(e){let t=mt(e);for(let[n,o]of Object.entries(t))se[n].value=o}function mt(e){return{numbering:e.dataset.numbering??"letters"}}var de={};m(de,{attributes:()=>Cn,initializeToolbar:()=>wn,parents:()=>vn,realElement:()=>$e,showToolbar:()=>kn});function $e(e){let t=document.createElement("li");t.dataset.type="singleChoiceItem",t.id=l(),t.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${t.id})`;let n=document.createElement("input");return n.type="radio",n.id=l(),n.name=e,t.appendChild(n),t}var vn=["singleChoiceInput"];function wn(){}function kn(e){}function Cn(e){return{}}var Oe={};m(Oe,{attributes:()=>Sn,children:()=>Tn,initializeToolbar:()=>Ln,realElement:()=>In,showToolbar:()=>Bn});function In(){let e=l();return s("browserSim","browser-sim",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10E1\u10D8\u10DB\u10E3\u10DA\u10D0\u10E2\u10DD\u10E0\u10D8 (${e})`)}var Tn=["browserPage"];function Ln(){}function Bn(e){}function Sn(e){return{}}var Ne={};m(Ne,{attributes:()=>ut,initializeToolbar:()=>Rn,parents:()=>On,realElement:()=>$n,showToolbar:()=>Nn});function $n(){let e=l(),t=s("browserPage","browser-page",e,`\u10D2\u10D5\u10D4\u10E0\u10D3\u10D8 (${e})`);return t.setAttribute("closable","true"),t}var On=["browserSim"],k={},Re=e=>document.getElementById(e);function Rn(){k.closable=Re("browserPage-toolbar-closable"),k.title=Re("browserPage-toolbar-title"),k.url=Re("browserPage-toolbar-url"),k.closable.addEventListener("change",()=>{i().setAttribute("closable",String(k.closable.checked))}),k.title.addEventListener("keyup",()=>{i().setAttribute("title",k.title.value)}),k.url.addEventListener("keyup",()=>{i().setAttribute("url",k.url.value)})}function Nn(e){let t=ut(e);for(let[n,o]of Object.entries(t))k[n].value=o}function ut(e){return{closable:e.getAttribute("closable")??"true",title:e.getAttribute("title")??"",url:e.getAttribute("url")??e.id}}var ze={};m(ze,{attributes:()=>gt,children:()=>jn,initializeToolbar:()=>An,realElement:()=>zn,showToolbar:()=>Dn});function zn(){let e=l();return s("browserLink","browser-link",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10DA\u10D8\u10DC\u10D9\u10D8 (${e})`)}var jn=["text","image"],N={},ft=e=>document.getElementById(e);function An(){N.browser=ft("browserLink-toolbar-browser"),N.url=ft("browserLink-toolbar-url"),N.browser.addEventListener("change",()=>{i().setAttribute("browser",N.browser.value)}),N.url.addEventListener("change",()=>{i().setAttribute("url",N.url.value)})}function Dn(e){let t=gt(e);for(let[n,o]of Object.entries(t))N[n].value=o}function gt(e){return{browser:e.getAttribute("browser")??"",url:e.getAttribute("to")??""}}var _e={};m(_e,{attributes:()=>ht,children:()=>Wn,initializeToolbar:()=>Qn,realElement:()=>qn,showToolbar:()=>Xn});var Ae={};m(Ae,{attributes:()=>Hn,children:()=>Pn,initializeToolbar:()=>_n,realElement:()=>je,showToolbar:()=>Fn});function je(){let e=l();return s("tableRow","tr",e,"\u10E1\u10E2\u10E0\u10D8\u10E5\u10DD\u10DC\u10D8")}var Pn=[];function _n(){}function Fn(e){}function Hn(e){return{}}var De={};m(De,{attributes:()=>Un,initializeToolbar:()=>Jn,realElement:()=>pe,showToolbar:()=>Mn});function pe(){let e=l();return s("tableElement","td",e,"\u10D4\u10DA\u10D4\u10DB\u10D4\u10DC\u10E2\u10D8")}function Jn(){}function Mn(e){}function Un(e){return{}}function qn(){let e=l(),t=s("table","table",e,`\u10EA\u10EE\u10E0\u10D8\u10DA\u10D8 (${e})`);return t.appendChild(je()),t.lastChild.appendChild(pe()),t}var Wn=[];function Gn(e,t){let n=e.children.length;if(n<t)for(let o=0;o<t-n;o++){let r=Q(e.lastChild);e.appendChild(r)}else if(n>t)for(;e.children.length>t;)e.lastChild.remove();e.dataset.rows=String(t),Fe(e)}function Vn(e,t){let n=e.firstChild.children.length;for(let o of e.children)if(n<t)for(let r=0;r<t-n;r++)o.appendChild(pe());else for(;o.children.length;)o.lastChild.remove();e.dataset.cols=String(t),Fe(e)}var x={},Pe=e=>document.getElementById(e);function Qn(){x.style=Pe("table-toolbar-style"),x.rows=Pe("table-toolbar-rows"),x.cols=Pe("table-toolbar-cols"),x.style.addEventListener("change",()=>{i().dataset.style=x.style.value}),x.rows.addEventListener("change",()=>{let e=i();Gn(e,Number(x.rows.value))}),x.cols.addEventListener("change",()=>{let e=i();Vn(e,Number(x.cols.value))})}function Xn(e){let t=ht(e);console.log(x,t);for(let[n,o]of Object.entries(t))x[n].value=o}function ht(e){return{style:e.dataset.style||"empty",rows:e.dataset.rows||"1",cols:e.dataset.cols||"1"}}var Ue={};m(Ue,{attributes:()=>vt,initializeToolbar:()=>Yn,realElement:()=>Kn,showToolbar:()=>Zn});function me(){let e=localStorage.getItem("authToken");return e?{Authorization:`Bearer ${e}`}:{}}var fe=class extends Error{};var ue="https://terryapi.dimitri.ge/api";async function bt(e){let t=await fetch(`${ue}/test/${e}`,{headers:me()});if(!t.ok){if(t.status===401)throw new fe;{let o=JSON.stringify(await t.json());throw new Error(o)}}let n=await t.json();return{id:e,...n}}function yt(e,t){return console.log("trying to upload",t,"for test",e),fetch(`${ue}/test/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",...me()},body:JSON.stringify({...t,gradingScheme:JSON.stringify(t.gradingScheme)})})}function He(e,t){return`${ue}/image/${e}/${t}`}async function Et(e,t,n){let o=new FormData;return o.append("image",n),(await fetch(He(e,t),{method:"POST",headers:{...me()},body:o})).ok}var L;async function Je(e,t){return L=e,localStorage.setItem("currentFile",JSON.stringify(e)),t!==void 0?(await yt(t,e)).ok:!1}async function xt(e){if(e!==void 0)try{return L=await bt(e),L}catch(n){console.log(n)}let t=localStorage.getItem("currentFile");return t!=null?L=JSON.parse(t):L={content:'<div data-type="container" data-name="\u10DB\u10D7\u10D0\u10D5\u10D0\u10E0\u10D8 \u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8" id="0" data-pages="1"></div>'},L}function Kn(){let e=l();return s("image","img",e,`\u10E1\u10E3\u10E0\u10D0\u10D7\u10D8 (${e})`)}var C={},Me=e=>document.getElementById(e);function Yn(){C.image=Me("image-toolbar-image"),C.width=Me("image-toolbar-width"),C.float=Me("image-toolbar-float"),C.image.addEventListener("change",async e=>{let t=e.target.files,n=t[0];if(await Et(L.id,n.name,n))i().src=He(L.id,n.name);else{let o=new FileReader;o.onload=r=>{i().src=r.target.result},o.readAsDataURL(e.target.files[0])}console.log(t)}),C.width.addEventListener("change",()=>{i().style.width=`${C.width.value}px`}),C.float.addEventListener("change",()=>{i().style.float=C.float.value})}function Zn(e){let t=vt(e);for(let[n,o]of Object.entries(t))C[n]&&(C[n].value=o)}function vt(e){return{url:e.src??"",width:(e.style.width??"100px").slice(0,-2),float:e.style.float??"left"}}function v(e){let t=e.dataset.type,n=e.id,o=e.dataset.name,r=[];for(let a of e.children){let c=v(a);c&&(c instanceof HTMLElement?r.push(c):r.push(...c))}if(t!==void 0){let a=document.createElement("div");a.innerHTML=r.length===0?`<div class="list" tabindex="0" data-id="${n}" data-type="${t}"><span data-type="${t}">${o}</span></div>`:`<details open class="list" tabindex="0" data-id="${n}" data-type="${t}"><summary data-type="${t}">${o}</summary></details>`;let c=a.firstChild;for(let Y of r)c.appendChild(Y);return c}else return r}var u={container:P,paragraph:_,formula:ve,text:te,shortTextInput:oe,multipleChoiceInput:ae,multipleChoiceItem:le,singleChoiceInput:ce,singleChoiceItem:de,browserSim:Oe,browserPage:Ne,browserLink:ze,table:_e,tableRow:Ae,tableElement:De,image:Ue,longTextInput:Le,heading:Ce};console.log(u);function wt(){console.log("hello");for(let{initializeToolbar:e}of Object.values(u))e&&e()}function qe(e){let t=[];console.log(e.dataset.type),console.log(u);for(let n of Object.keys(u)){let o=!0;u[e.dataset.type].children!==void 0&&(o&&=u[e.dataset.type].children.includes(n)),u[n].parents!==void 0&&(o&&=u[n].parents.includes(e.dataset.type)),o&&t.push(n)}return console.log(t),t}var eo=document.getElementById("page-buttons"),kt=document.getElementById("add-page"),J=0,b=0,I=[],Ct=[];function ge(){let e=document.createElement("input");e.type="radio",e.id=`page-${b+1}`,e.name="current-page";let t=b;e.addEventListener("change",()=>{It(t)});let n=document.createElement("label");n.innerText=String(b+1),n.appendChild(e),eo.insertBefore(n,kt),Ct.push(n),I.push([]),b+=1,g.firstElementChild.dataset.pages=String(b)}function to(){for(let e of I[J])e.classList.remove("current")}function It(e){if(e<b&&e>=0){console.log(I[e]),to(),J=e;for(let t of I[J])t.classList.add("current")}}function z(e){switch(e.dataset.visibilityType??"always"){case"only":{let n=Number(e.dataset.visibleOnlyOn??"1");for(;n>b;)ge();Lt(e,n);break}case"range":{let n=Number(e.dataset.visibleFrom??"1"),o=Number(e.dataset.visibleTo??"1");for(;n>b;)ge();for(;o>b;)ge();oo(e,n,o);break}}for(let n of e.children)z(n);no()}function Tt(e,t,n){for(let o=0;o<b;o++)if(o<t||o>n){let r=I[o].indexOf(e);r>=0&&I[o].splice(r,1)}}function no(){for(let e=b-1;e>0&&!(I[e].length>0);e--)I.pop(),Ct.pop().remove(),b--}function Lt(e,t,n=!0){t-=1,t<b&&t>=0&&(I[t].includes(e)||I[t].push(e),n&&Tt(e,t,t),t===J&&It(t))}function oo(e,t,n){for(let o=t;o<=n;o++)Lt(e,o,!1);Tt(e,t-1,n-1)}kt.addEventListener("click",()=>{ge()});var St={general:["visibility-type","visible-only-on","visible-from","visible-to"]},ro={general:e=>{let t={"visibility-type":e.dataset.visibilityType||"always"};switch(t["visibility-type"]){case"only":t["visible-only-on"]=e.dataset.visibleOnlyOn||"1";break;case"range":t["visible-from"]=e.dataset.visibleFrom||"1",t["visible-to"]=e.dataset.visibleTo||"1";break}return t}},E={};for(let e of Object.keys(St)){let t={};for(let n of St[e]){let o=document.getElementById(`${e}-toolbar-${n}`);console.log(e,n),t[n]={element:o,addEventListener:o.addEventListener,set value(r){if(o.nodeName==="INPUT"){let a=o;switch(a.type){case"text":case"number":a.value=r;break;case"checkbox":a.checked=r}}(o.nodeName==="SELECT"||o.nodeName==="TEXTAREA")&&(o.value=r),this.setTrigger(r)},setTrigger(r){}}}E[e]=t}var $t={_elements:{},_current:void 0,show(e){this._current&&this._current.classList.remove("current");let t=e.dataset.type;if(this._elements[t]===void 0&&(this._elements[t]=document.getElementById(`${t}-toolbar`)),this._current=this._elements[t],t==="browserLink"){let r=function(a){a.tagName==="BROWSER-SIM"&&(o[a.dataset.name]=a.id),a.tagName==="BROWSER-PAGE"&&n.push(a.getAttribute("url"));for(let c of a.children)r(c)},n=[],o={};r(g),E.browserLink.url.element.innerHTML="",E.browserLink.browser.element.innerHTML="";for(let a of n){let c=document.createElement("option");c.value=a,c.innerText=a,E.browserLink.url.element.appendChild(c)}for(let a of Object.keys(o)){let c=document.createElement("option");c.value=o[a],c.innerText=a,E.browserLink.browser.element.appendChild(c)}}if(this._current){this._current.classList.add("current"),u[t].showToolbar(e);let n=ro.general(e);for(let o of Object.keys(n))E.general[o].value=n[o]}},hide(){this._current&&(this._current.classlist.remove("current"),this._current=void 0)}};function io(){E.general["visibility-type"].setTrigger=e=>{We.dataset.visibilityType=e},E.general["visibility-type"].element.addEventListener("change",e=>{E.general["visibility-type"].setTrigger(e.target.value),i().dataset.visibilityType=e.target.value}),E.general["visible-only-on"].element.addEventListener("change",e=>{i().dataset.visibleOnlyOn=e.target.value,z(i())}),E.general["visible-from"].element.addEventListener("change",e=>{i().dataset.visibleFrom=e.target.value,z(i())}),E.general["visible-to"].element.addEventListener("change",e=>{i().dataset.visibleTo=e.target.value,z(i())})}io();var Ge=0;function l(){return String(Ge++)}function Ve(e){let t=Number(e.id);t>=Ge&&(Ge=t+1);for(let n of e.children)Ve(n)}function Q(e){let t=e.cloneNode(!0);function n(o){o.id=l();for(let r of o.children)n(r)}return n(t),t}var j;function d(){return j}function A(){Rt(),j&&(j.blur(),j.removeAttribute("id")),j=void 0}function he(e){A(),j=e,j.setAttribute("id","selected");let t=document.getElementById(e.dataset.id);Ie(t),$t.show(t)}function Ot(e){he(e)}function Fe(e){let t=e.id,n=S.querySelector(`[data-id="${t}"]`);n.parentElement.replaceChild(v(e),n)}var M;function i(){return M}function Rt(){M&&M.classList.remove("selected"),M=void 0}function Ie(e){Rt(),M=e,M.classList.add("selected")}var Qe={multipleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},singleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},shortTextInput:e=>({correct:e.value})};var Xe;function Nt(){Xe={};for(let e of Object.keys(Qe))for(let t of g.querySelectorAll(`[data-type=${e}]`))console.log("extracted",Qe[e](t)),Xe[t.id]=Qe[e](t);return Xe}var be=class{#n=100;#t=[];#e=-1;update(t){this.#t.splice(0,this.#e,t),this.#t.length>=this.#n&&this.#t.splice(this.#n),this.#e=-1,console.log(this.#t)}canGoBack(){return this.#e<this.#t.length-1}goBack(){return this.#e+=1,console.log("returning version",this.#e),this.#t[this.#e]}canGoForward(){return this.#e>0}goForward(){return this.#e-=1,console.log("returning version",this.#e),this.#t[this.#e]}};var zt=document.getElementById("test-name"),ao=window.location.search,lo=new URLSearchParams(ao),ye=lo.get("id"),jt=e=>{e.classList.remove("selected"),e.className===""&&e.removeAttribute("class");for(let t of e.children)jt(t)},Ke=class{get content(){let t=g.cloneNode(!0);return jt(t),t.innerHTML.trim().replaceAll(/[\s\t][\s\t]+/g,"").replaceAll(' contenteditable="true"',"")}get gradingScheme(){return JSON.stringify(Nt())}get name(){return zt.value}export(){return{content:this.content,gradingScheme:this.gradingScheme,name:this.name}}load({name:t,content:n,gradingScheme:o}){g.innerHTML=n;for(let r of g.getElementsByTagName("p"))r.contentEditable="true";for(let r of g.getElementsByTagName("span"))r.contentEditable="true";if(Ve(g.firstChild),o){let r=JSON.parse(o);for(let a of Object.keys(r))document.getElementById(a).value=r[a].correct}S.innerHTML="",S.appendChild(v(g.firstElementChild)),z(g.firstElementChild),t&&(zt.value=t)}},U=new be;document.getElementById("undo").addEventListener("click",()=>{if(U.canGoBack()){let e=U.goBack();q.load(e)}else console.log("can't go back anymore")});document.getElementById("redo").addEventListener("click",()=>{if(U.canGoForward()){let e=U.goForward();q.load(e)}else console.log("can't go forward anymore")});function T(){U.update(q.export())}var q=new Ke;document.getElementById("save-test").addEventListener("click",async()=>{await Je(q.export(),ye??void 0)});function At(e){e.preventDefault()}document.getElementById("preview").addEventListener("click",async()=>{await Je(q.export(),ye??void 0)&&(removeEventListener("beforeunload",At),window.location.href=`/player/?id=${ye}&page=${J+1}`)});addEventListener("beforeunload",At);async function so(){let e=await xt(ye);q.load(e),U.update(e)}so();var S=document.getElementById("tree-view"),g=document.getElementById("main-content"),We=document.getElementById("right-pane"),Ye=!1;S.addEventListener("click",e=>{d()!==void 0&&(d().contains(e.target)||A(),Ye||e.preventDefault(),Ye=!0)},!0);S.addEventListener("contextmenu",e=>{let t=e.target;if(e.preventDefault(),t.classList.contains("list"))he(t);else if(t.parentElement.classList.contains("list"))he(t.parentElement);else return;e.stopPropagation();let n=["rcm-add-child","rcm-add-preset","rcm-copy","rcm-delete","rcm-rename"];(t.parentElement.parentElement.parentElement.classList.contains("list")||t.parentElement.parentElement.classList.contains("list"))&&n.push("rcm-add-sibbling"),X.isCopying()&&(n.push("rcm-paste-child"),t.parentElement?.classList.contains("list")&&n.push("rcm-paste-above")),D(w.rightClick,n,t)},!0);S.addEventListener("focus",e=>{let t=e.target;t.classList.contains("list")||(t=t.parentElement),t.classList.contains("list")&&(Ot(t),Ye=!1)},!0);We.addEventListener("change",()=>{T()});var Ze={};m(Ze,{realElement:()=>co});function co(){let e=O();return e.appendChild(R()),e.appendChild(Te()),e}var et={};m(et,{realElement:()=>po});function po(){let e=O();e.appendChild(R());let t=Be();return t.appendChild(H()),t.appendChild(H()),t.appendChild(H()),t.appendChild(H()),e.appendChild(t),e}var tt={};m(tt,{realElement:()=>mo});function Ee(e){let t=$e(e),n=we();return t.append(n),n.innerText=" abc ",t}function mo(){let e=O();e.appendChild(R());let t=Se();return t.appendChild(Ee(t.id)),t.appendChild(Ee(t.id)),t.appendChild(Ee(t.id)),t.appendChild(Ee(t.id)),e.appendChild(t),e}var W={shortTextQuestion:Ze,multipleChoiceQuestion:et,singleChoiceQuestion:tt};function Dt(){let e=[];for(let t of Object.keys(W))e.push(t);return e}var xe=class{#n;set data(t){this.#n=t}get data(){return this.#n}isCopying(){return this.#n!==void 0}};var K,X=new xe;function uo(){document.getElementById("rcm-add-child").addEventListener("click",e=>{K=fo,D(w.element,qe(d()),e.target)},!1),document.getElementById("rcm-add-sibbling").addEventListener("click",e=>{K=go,D(w.element,qe(d().parentElement),e.target)},!1),document.getElementById("rcm-add-preset").addEventListener("click",e=>{K=ho,D(w.preset,Dt(),e.target)},!1),document.getElementById("rcm-copy").addEventListener("click",e=>{let t=d().dataset.id;X.data=document.getElementById(t),$()},!1),document.getElementById("rcm-paste-child").addEventListener("click",e=>{let t=Q(X.data);i().appendChild(t),d().parentElement.replaceChild(v(i()),d()),$(),T()},!1),document.getElementById("rcm-paste-above").addEventListener("click",e=>{let t=Q(X.data);i().parentElement.insertBefore(t,i());let n=v(i().parentElement);d().parentElement.parentElement.replaceChild(n,d().parentElement),$(),T()},!1),document.getElementById("rcm-delete").addEventListener("click",e=>{let t=d().dataset.id;d().remove(),A(),document.getElementById(t).remove(),$(),T()},!1),document.getElementById("rcm-rename").addEventListener("click",e=>{let t=d().dataset.id,n=d().firstChild,o=n.innerText,r=document.createElement("input");r.type="text",r.value=o,d().insertBefore(r,n),n.remove(),r.focus(),r.addEventListener("blur",a=>{r.contains(a.relatedTarget)||(n.innerText=r.value,document.getElementById(t).dataset.name=r.value,d().insertBefore(n,r),r.remove())}),r.addEventListener("click",a=>{a.stopPropagation()}),r.addEventListener("keyup",a=>{(a.key==="Enter"||a.key==="Escape")&&r.blur()}),n.remove(),T()},!1);for(let e of Object.keys(u)){let t=document.getElementById(e);t&&t.addEventListener("click",()=>{K(d(),e),A(),$()})}for(let e of Object.keys(W)){let t=document.getElementById(e);t&&t.addEventListener("click",()=>{K(d(),e),A(),$()})}wt()}uo();function fo(e,t){let n=e.dataset.id,o=document.getElementById(n),r=u[t].realElement(n);if(o.appendChild(r),u[t].mounted!==void 0&&u[t].mounted(r),e.appendChild(v(r)),e.tagName==="DIV"){let a=document.createElement("details");a.classList.add("list"),a.tabIndex=0,a.dataset.id=n,a.dataset.type=e.dataset.type,a.open=!0;let c=document.createElement("summary");c.dataset.type=e.dataset.type,c.innerText=e.firstChild.innerText,a.appendChild(c);let Y=[...e.children].slice(1);console.log(Y),a.append(...Y),e.replaceWith(a)}T()}function go(e,t){let n=e.dataset.id,o=document.getElementById(n),r=o.parentElement,a=e.parentElement.id,c=u[t].realElement(a);r.insertBefore(c,o),u[t].mounted!==void 0&&u[t].mounted(c),e.parentElement.insertBefore(v(c),e),T()}function ho(e,t){let n=e.dataset.id,o=document.getElementById(n),r=W[t].realElement();o.appendChild(r),W[t].mounted!==void 0&&W[t].mounted(r),e.parentElement.replaceChild(v(o),e),T()}export{X as copyBuffer};
//# sourceMappingURL=bundle.js.map
