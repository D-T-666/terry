var Ct=Object.defineProperty;var d=(e,t)=>{for(var n in t)Ct(e,n,{get:t[n],enumerable:!0})};var C=function(e){return e[e.rightClick=0]="rightClick",e[e.element=1]="element",e[e.preset=2]="preset",e}({}),k=[document.getElementById("left-pane-right-click-menu"),document.getElementById("element-menu"),document.getElementById("preset-menu")],Tt={[C.element]:C.rightClick,[C.preset]:C.rightClick},He;function B(){for(let e of k)e.style.visibility="hidden"}function Lt(e,t){let n=t.getBoundingClientRect();k[e].style.top=`${n.top}px`,k[e].style.left=`calc(${n.right}px + 0.25rem)`,k[e].style.visibility="visible",He=e}function H(e,t,n){if(t.length>0)for(let o of k[e].children)o.disabled=!t.includes(o.id);else{console.error("requested to open a menu with 0 options.");for(let o of k[e].children)o.disabled=!1}Lt(e,n)}document.addEventListener("click",function(e){let t=[],n=He;for(;n!==void 0;)t.push(n),n=Tt[n];let o;for(let i=0;i<3;i++)if(k[i].contains(e.target)){o=i;break}for(;t.length>0&&t[t.length-1]!==o;)t.pop();for(let i=0;i<3;i++)t.includes(i)||(k[i].style.visibility="hidden")});var T=document.getElementById("tree-view"),g=document.getElementById("main-content"),Me=document.getElementById("right-pane");var A={};d(A,{attributes:()=>Ue,initializeToolbar:()=>kt,realElement:()=>R,showToolbar:()=>Bt});function c(e,t,n,o){o===void 0&&(o=`${e}-${n}`);let i=document.createElement(t);return i.id=n,i.dataset.name=o,i.dataset.type=e,i}function R(){let e=l();return c("container","div",e,`\u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8 (${e})`)}var h={},W=e=>document.getElementById(e);function kt(){h.layout=W("container-toolbar-layout"),h.padding=W("container-toolbar-padding"),h.border=W("container-toolbar-border"),h.align=W("container-toolbar-align"),h.layout.addEventListener("change",()=>{r().dataset.layout=h.layout.value}),h.padding.addEventListener("change",()=>{r().style.padding=h.padding.value+"px"}),h.border.addEventListener("change",()=>{r().dataset.border=h.border.value}),h.align.addEventListener("change",()=>{r().dataset.align=h.align.value})}function Bt(e){let t=Ue(e);for(let[n,o]of Object.entries(t))h[n].value=o}function Ue(e){return{layout:e.dataset.layout??"",padding:(e.style.padding??"0  ").slice(0,-2),border:e.dataset.border??"",align:e.dataset.align??""}}var j={};d(j,{attributes:()=>Je,children:()=>$t,initializeToolbar:()=>St,mounted:()=>Rt,realElement:()=>$,showToolbar:()=>Ot});var qe=[];function V(e){let t=e.parentElement;for(;t.id!=="main-content";){if(qe.includes(t.id))return;t=t.parentElement}qe.push(e.id),e.contentEditable="true",console.log(`making ${e} contenteditable;`)}function $(){let e=l();return c("paragraph","p",e,`\u10DE\u10D0\u10E0\u10D0\u10D2\u10E0\u10D0\u10E4\u10D8 (${e})`)}function Rt(e){V(e)}var $t=["text","formula"],f={},M=e=>document.getElementById(e);function St(){f["line-height"]=M("paragraph-toolbar-line-height"),f["first-line-indent"]=M("paragraph-toolbar-first-line-indent"),f["spacing-above"]=M("paragraph-toolbar-spacing-above"),f["spacing-below"]=M("paragraph-toolbar-spacing-below"),f.align=M("paragraph-toolbar-align"),f["line-height"].addEventListener("change",()=>{r().style.lineHeight=f["line-height"].value+"%"}),f["first-line-indent"].addEventListener("change",()=>{r().style.textIndent=f["first-line-indent"].value+"%"}),f["spacing-above"].addEventListener("change",()=>{r().style.marginTop=f["spacing-above"].value+"rem"}),f["spacing-below"].addEventListener("change",()=>{r().style.marginBottom=f["spacing-below"].value+"rem"}),f.align.addEventListener("change",()=>{r().style.textAlign=f.align.value})}function Ot(e){let t=Je(e);for(let[n,o]of Object.entries(t))f[n].value=o}function Je(e){return{"line-height":(e.style.lineHeight??"%").slice(0,-1),"first-line-indent":(e.style.lineHeight??"%").slice(0,-1),"spacing-above":(e.style.marginTop??"rem").slice(0,-2),"spacing-below":(e.style.marginBottom??"rem").slice(0,-2),align:e.style.textAlign??"left"}}var ue={};d(ue,{attributes:()=>We,initializeToolbar:()=>jt,realElement:()=>Nt,showToolbar:()=>zt});function Nt(){let e=l();return c("formula","span",e,`\u10E4\u10DD\u10E0\u10DB\u10E3\u10DA\u10D0 (${e})`)}var U={},At=e=>document.getElementById(e);function jt(){U.content=At("formula-toolbar-content"),U.content.addEventListener("keyup",()=>{r().dataset.content=U.content.value;let e=MathJax.tex2mml(U.content.value);r().innerHTML=e,r().firstChild.setAttribute("display","inline")})}function zt(e){let t=We(e);for(let[n,o]of Object.entries(t))U[n].value=o}function We(e){return{content:e.dataset.content??""}}var Q={};d(Q,{attributes:()=>Ve,initializeToolbar:()=>Pt,mounted:()=>Dt,realElement:()=>pe,showToolbar:()=>_t});function pe(){let e=l();return c("text","span",e,`\u10E2\u10D4\u10E5\u10E1\u10E2\u10D8 (${e})`)}function Dt(e){V(e)}var m={},z=e=>document.getElementById(e);function Pt(){m.content=z("text-toolbar-content"),m.color=z("text-toolbar-color"),m.bold=z("text-toolbar-bold"),m.italic=z("text-toolbar-italic"),m.underline=z("text-toolbar-underline"),m.size=z("text-toolbar-size"),console.log("but whyyyy"),m.content.addEventListener("keyup",()=>{r().innerText=m.content.value},!1),m.color.addEventListener("change",()=>{r().style.color=m.color.value},!1),m.bold.addEventListener("change",()=>{r().style.fontWeight=m.bold.checked?"bold":"normal"},!1),m.italic.addEventListener("change",()=>{r().style.fontStyle=m.italic.checked?"oblique":"normal"},!1),m.underline.addEventListener("change",()=>{r().style.textDecoration=m.underline.checked?"underline":"none"},!1),m.size.addEventListener("change",()=>{r().style.fontSize=m.size.value+"pt"},!1)}function _t(e){let t=Ve(e);console.log(t,m);for(let[n,o]of Object.entries(t))m[n].value=o}function Ve(e){return{content:e.innerText,color:e.style.color??"black",bold:String(e.style.fontWeight==="bold"),italic:String(e.style.fontStyle==="oblique"),underline:String(e.style.textDecoration==="underline"),size:(e.style.fontSize??"12pt").slice(0,-2)}}var X={};d(X,{attributes:()=>Qe,initializeToolbar:()=>Ht,realElement:()=>fe,showToolbar:()=>Mt});function fe(){let e=document.createElement("input");return e.type="text",e.id=l(),e.dataset.name=`\u10DB\u10DD\u10D9\u10DA\u10D4 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="shortTextInput",e}var G={},Ft=e=>document.getElementById(e);function Ht(){G.width=Ft("shortTextInput-toolbar-width"),G.width.addEventListener("change",()=>{r().style.width=G.width.value+"ch"})}function Mt(e){let t=Qe(e);for(let[n,o]of Object.entries(t))G[n].value=o}function Qe(e){return{width:e.style.width.slice(0,-2)}}var ge={};d(ge,{attributes:()=>Ge,initializeToolbar:()=>Jt,realElement:()=>Ut,showToolbar:()=>Wt});function Ut(){let e=document.createElement("textarea");return e.id=l(),e.dataset.name=`\u10D2\u10E0\u10EB\u10D4\u10DA\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e.id})`,e.dataset.type="longTextInput",e}var K={},qt=e=>document.getElementById(e);function Jt(){K.width=qt("longTextInput-toolbar-width"),K.width.addEventListener("change",()=>{r().cols=Number(K.width.value)})}function Wt(e){let t=Ge(e);for(let[n,o]of Object.entries(t))K[n].value=o}function Ge(e){return{width:String(e.cols)}}var Z={};d(Z,{attributes:()=>Xe,children:()=>Vt,initializeToolbar:()=>Qt,realElement:()=>he,showToolbar:()=>Gt});function he(){let e=l();return c("multipleChoiceInput","ol",e,`\u10DB\u10E0\u10D0\u10D5\u10D0\u10DA\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var Vt=["multipleChoiceItem"],Y={};function Qt(){Y.numbering=document.getElementById("multipleChoiceInput-toolbar-numbering"),Y.numbering.addEventListener("change",()=>{r().dataset.numbering=Y.numbering.value})}function Gt(e){let t=Xe(e);for(let[n,o]of Object.entries(t))Y[n].value=o}function Xe(e){return{numbering:e.dataset.numbering??"letters"}}var ee={};d(ee,{attributes:()=>Zt,initializeToolbar:()=>Kt,parents:()=>Xt,realElement:()=>D,showToolbar:()=>Yt});function D(){let e=document.createElement("li");e.dataset.type="multipleChoiceItem",e.id=l(),e.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${e.id})`;let t=document.createElement("input");return t.type="checkbox",t.id=l(),e.appendChild(t),e}var Xt=["multipleChoiceInput"];function Kt(){}function Yt(e){}function Zt(e){return{}}var ne={};d(ne,{attributes:()=>Ke,children:()=>en,initializeToolbar:()=>tn,realElement:()=>be,showToolbar:()=>nn});function be(){let e=l();return c("singleChoiceInput","ol",e,`\u10D4\u10E0\u10D7\u10D0\u10E0\u10E9\u10D4\u10D5\u10DC\u10D8\u10D0\u10DC\u10D8 \u10DE\u10D0\u10E1\u10E3\u10EE\u10D8 (${e})`)}var en=["singleChoiceItem"],te={};function tn(){te.numbering=document.getElementById("singleChoiceInput-toolbar-numbering"),te.numbering.addEventListener("change",()=>{r().dataset.numbering=te.numbering.value})}function nn(e){let t=Ke(e);for(let[n,o]of Object.entries(t))te[n].value=o}function Ke(e){return{numbering:e.dataset.numbering??"letters"}}var oe={};d(oe,{attributes:()=>ln,initializeToolbar:()=>rn,parents:()=>on,realElement:()=>Ee,showToolbar:()=>an});function Ee(e){let t=document.createElement("li");t.dataset.type="singleChoiceItem",t.id=l(),t.dataset.name=`\u10D0\u10E0\u10E9\u10D4\u10D5\u10D0\u10DC\u10D8 (${t.id})`;let n=document.createElement("input");return n.type="radio",n.id=l(),n.name=e,t.appendChild(n),t}var on=["singleChoiceInput"];function rn(){}function an(e){}function ln(e){return{}}var ye={};d(ye,{attributes:()=>un,children:()=>cn,initializeToolbar:()=>dn,realElement:()=>sn,showToolbar:()=>mn});function sn(){let e=l();return c("browserSim","browser-sim",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10E1\u10D8\u10DB\u10E3\u10DA\u10D0\u10E2\u10DD\u10E0\u10D8 (${e})`)}var cn=["browserPage"];function dn(){}function mn(e){}function un(e){return{}}var xe={};d(xe,{attributes:()=>Ye,initializeToolbar:()=>gn,parents:()=>fn,realElement:()=>pn,showToolbar:()=>hn});function pn(){let e=l(),t=c("browserPage","browser-page",e,`\u10D2\u10D5\u10D4\u10E0\u10D3\u10D8 (${e})`);return t.setAttribute("closable","true"),t}var fn=["browserSim"],x={},ve=e=>document.getElementById(e);function gn(){x.closable=ve("browserPage-toolbar-closable"),x.title=ve("browserPage-toolbar-title"),x.url=ve("browserPage-toolbar-url"),x.closable.addEventListener("change",()=>{r().setAttribute("closable",String(x.closable.checked))}),x.title.addEventListener("keyup",()=>{r().setAttribute("title",x.title.value)}),x.url.addEventListener("keyup",()=>{r().setAttribute("url",x.url.value)})}function hn(e){let t=Ye(e);for(let[n,o]of Object.entries(t))x[n].value=o}function Ye(e){return{closable:e.getAttribute("closable")??"true",title:e.getAttribute("title")??"",url:e.getAttribute("url")??e.id}}var we={};d(we,{attributes:()=>et,children:()=>En,initializeToolbar:()=>yn,realElement:()=>bn,showToolbar:()=>vn});function bn(){let e=l();return c("browserLink","browser-link",e,`\u10D1\u10E0\u10D0\u10E3\u10D6\u10D4\u10E0\u10D8\u10E1 \u10DA\u10D8\u10DC\u10D9\u10D8 (${e})`)}var En=["text","image"],S={},Ze=e=>document.getElementById(e);function yn(){S.browser=Ze("browserLink-toolbar-browser"),S.url=Ze("browserLink-toolbar-url"),S.browser.addEventListener("change",()=>{r().setAttribute("browser",S.browser.value)}),S.url.addEventListener("change",()=>{r().setAttribute("url",S.url.value)})}function vn(e){let t=et(e);for(let[n,o]of Object.entries(t))S[n].value=o}function et(e){return{browser:e.getAttribute("browser")??"",url:e.getAttribute("to")??""}}var ke={};d(ke,{attributes:()=>tt,children:()=>Rn,initializeToolbar:()=>On,realElement:()=>Bn,showToolbar:()=>Nn});var Ce={};d(Ce,{attributes:()=>Cn,children:()=>xn,initializeToolbar:()=>wn,realElement:()=>Ie,showToolbar:()=>In});function Ie(){let e=l();return c("tableRow","tr",e,"\u10E1\u10E2\u10E0\u10D8\u10E5\u10DD\u10DC\u10D8")}var xn=[];function wn(){}function In(e){}function Cn(e){return{}}var Te={};d(Te,{attributes:()=>kn,initializeToolbar:()=>Tn,realElement:()=>re,showToolbar:()=>Ln});function re(){let e=l();return c("tableElement","td",e,"\u10D4\u10DA\u10D4\u10DB\u10D4\u10DC\u10E2\u10D8")}function Tn(){}function Ln(e){}function kn(e){return{}}function Bn(){let e=l(),t=c("table","table",e,`\u10EA\u10EE\u10E0\u10D8\u10DA\u10D8 (${e})`);return t.appendChild(Ie()),t.lastChild.appendChild(re()),t}var Rn=[];function $n(e,t){let n=e.children.length;if(n<t)for(let o=0;o<t-n;o++){let i=q(e.lastChild);e.appendChild(i)}else if(n>t)for(;e.children.length>t;)e.lastChild.remove();e.dataset.rows=String(t),Be(e)}function Sn(e,t){let n=e.firstChild.children.length;for(let o of e.children)if(n<t)for(let i=0;i<t-n;i++)o.appendChild(re());else for(;o.children.length;)o.lastChild.remove();e.dataset.cols=String(t),Be(e)}var y={},Le=e=>document.getElementById(e);function On(){y.style=Le("table-toolbar-style"),y.rows=Le("table-toolbar-rows"),y.cols=Le("table-toolbar-cols"),y.style.addEventListener("change",()=>{r().dataset.style=y.style.value}),y.rows.addEventListener("change",()=>{let e=r();$n(e,Number(y.rows.value))}),y.cols.addEventListener("change",()=>{let e=r();Sn(e,Number(y.cols.value))})}function Nn(e){let t=tt(e);console.log(y,t);for(let[n,o]of Object.entries(t))y[n].value=o}function tt(e){return{style:e.dataset.style||"empty",rows:e.dataset.rows||"1",cols:e.dataset.cols||"1"}}var Se={};d(Se,{attributes:()=>lt,initializeToolbar:()=>zn,realElement:()=>jn,showToolbar:()=>Dn});var An={Authorization:"Bearer "+(localStorage.getItem("authToken")??"")};function ie(){return An}var ae="https://terryapi.dimitri.ge/api";async function nt(e){let t=await fetch(`${ae}/test/${e}`,{headers:ie()});if(!t.ok)throw new Error(t.statusText);let n=await t.json();return{id:e,...n}}function ot(e,t){return console.log("trying to upload",t,"for test",e),fetch(`${ae}/test/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",...ie()},body:JSON.stringify({...t,gradingScheme:JSON.stringify(t.gradingScheme)})})}function Re(e,t){return`${ae}/image/${e}/${t}`}async function rt(e,t,n){let o=new FormData;return o.append("image",n),(await fetch(Re(e,t),{method:"POST",headers:{...ie()},body:o})).ok}var L;async function it(e,t){L=e,localStorage.setItem("currentFile",JSON.stringify(e)),t!==void 0&&await ot(t,e)}async function at(e){if(e!==void 0)try{return L=await nt(e),L}catch(n){console.log(n)}let t=localStorage.getItem("currentFile");return t!=null?L=JSON.parse(t):L={id:null,content:'<div data-type="container" data-name="\u10DB\u10D7\u10D0\u10D5\u10D0\u10E0\u10D8 \u10D9\u10DD\u10DC\u10E2\u10D4\u10D8\u10DC\u10D4\u10E0\u10D8" id="0" data-pages="1"></div>'},L}function jn(){let e=l();return c("image","img",e,`\u10E1\u10E3\u10E0\u10D0\u10D7\u10D8 (${e})`)}var w={},$e=e=>document.getElementById(e);function zn(){w.image=$e("image-toolbar-image"),w.width=$e("image-toolbar-width"),w.float=$e("image-toolbar-float"),w.image.addEventListener("change",async e=>{let t=e.target.files,n=t[0];if(await rt(L.id,n.name,n))r().src=Re(L.id,n.name);else{let o=new FileReader;o.onload=i=>{r().src=i.target.result},o.readAsDataURL(e.target.files[0])}console.log(t)}),w.width.addEventListener("change",()=>{r().style.width=`${w.width.value}px`}),w.float.addEventListener("change",()=>{r().style.float=w.float.value})}function Dn(e){let t=lt(e);for(let[n,o]of Object.entries(t))w[n]&&(w[n].value=o)}function lt(e){return{url:e.src??"",width:(e.style.width??"100px").slice(0,-2),float:e.style.float??"left"}}function v(e){let t=e.dataset.type,n=e.id,o=e.dataset.name,i=[];for(let a of e.children){let s=v(a);s&&(s instanceof HTMLElement?i.push(s):i.push(...s))}if(t!==void 0){let a=document.createElement("div");a.innerHTML=i.length===0?`<div class="list" tabindex="0" data-id="${n}" data-type="${t}"><span data-type="${t}">${o}</span></div>`:`<details open class="list" tabindex="0" data-id="${n}" data-type="${t}"><summary data-type="${t}">${o}</summary></details>`;let s=a.firstChild;for(let It of i)s.appendChild(It);return s}else return i}var u={container:A,paragraph:j,formula:ue,text:Q,shortTextInput:X,multipleChoiceInput:Z,multipleChoiceItem:ee,singleChoiceInput:ne,singleChoiceItem:oe,browserSim:ye,browserPage:xe,browserLink:we,table:ke,tableRow:Ce,tableElement:Te,image:Se,longTextInput:ge};console.log(u);function st(){console.log("hello");for(let{initializeToolbar:e}of Object.values(u))e&&e()}function Oe(e){let t=[];console.log(e.dataset.type),console.log(u);for(let n of Object.keys(u)){let o=!0;u[e.dataset.type].children!==void 0&&(o&&=u[e.dataset.type].children.includes(n)),u[n].parents!==void 0&&(o&&=u[n].parents.includes(e.dataset.type)),o&&t.push(n)}return console.log(t),t}var Pn=document.getElementById("page-buttons"),ct=document.getElementById("add-page"),se=0,b=0,I=[],dt=[];function le(){let e=document.createElement("input");e.type="radio",e.id=`page-${b+1}`,e.name="current-page";let t=b;e.addEventListener("change",()=>{mt(t)});let n=document.createElement("label");n.innerText=String(b+1),n.appendChild(e),Pn.insertBefore(n,ct),dt.push(n),I.push([]),b+=1,g.firstElementChild.dataset.pages=String(b)}function _n(){for(let e of I[se])e.classList.remove("current")}function mt(e){if(e<b&&e>=0){console.log(I[e]),_n(),se=e;for(let t of I[se])t.classList.add("current")}}function O(e){switch(e.dataset.visibilityType??"always"){case"only":{let n=Number(e.dataset.visibleOnlyOn??"1");for(;n>b;)le();pt(e,n);break}case"range":{let n=Number(e.dataset.visibleFrom??"1"),o=Number(e.dataset.visibleTo??"1");for(;n>b;)le();for(;o>b;)le();Hn(e,n,o);break}}for(let n of e.children)O(n);Fn()}function ut(e,t,n){for(let o=0;o<b;o++)if(o<t||o>n){let i=I[o].indexOf(e);i>=0&&I[o].splice(i,1)}}function Fn(){for(let e=b-1;e>0&&!(I[e].length>0);e--)I.pop(),dt.pop().remove(),b--}function pt(e,t,n=!0){t-=1,t<b&&t>=0&&(I[t].includes(e)||I[t].push(e),n&&ut(e,t,t),t===se&&mt(t))}function Hn(e,t,n){for(let o=t;o<=n;o++)pt(e,o,!1);ut(e,t-1,n-1)}ct.addEventListener("click",()=>{le()});var gt={general:["visibility-type","visible-only-on","visible-from","visible-to"]},Mn={general:e=>{let t={"visibility-type":e.dataset.visibilityType||"always"};switch(t["visibility-type"]){case"only":t["visible-only-on"]=e.dataset.visibleOnlyOn||"1";break;case"range":t["visible-from"]=e.dataset.visibleFrom||"1",t["visible-to"]=e.dataset.visibleTo||"1";break}return t}},E={};for(let e of Object.keys(gt)){let t={};for(let n of gt[e]){let o=document.getElementById(`${e}-toolbar-${n}`);console.log(e,n),t[n]={element:o,addEventListener:o.addEventListener,set value(i){if(o.nodeName==="INPUT"){let a=o;switch(a.type){case"text":case"number":a.value=i;break;case"checkbox":a.checked=i}}(o.nodeName==="SELECT"||o.nodeName==="TEXTAREA")&&(o.value=i),this.setTrigger(i)},setTrigger(i){}}}E[e]=t}var ht={_elements:{},_current:void 0,show(e){this._current&&this._current.classList.remove("current");let t=e.dataset.type;if(this._elements[t]===void 0&&(this._elements[t]=document.getElementById(`${t}-toolbar`)),this._current=this._elements[t],t==="browserLink"){let i=function(a){a.tagName==="BROWSER-SIM"&&(o[a.dataset.name]=a.id),a.tagName==="BROWSER-PAGE"&&n.push(a.getAttribute("url"));for(let s of a.children)i(s)},n=[],o={};i(g),E.browserLink.url.element.innerHTML="",E.browserLink.browser.element.innerHTML="";for(let a of n){let s=document.createElement("option");s.value=a,s.innerText=a,E.browserLink.url.element.appendChild(s)}for(let a of Object.keys(o)){let s=document.createElement("option");s.value=o[a],s.innerText=a,E.browserLink.browser.element.appendChild(s)}}if(this._current){this._current.classList.add("current"),u[t].showToolbar(e);let n=Mn.general(e);for(let o of Object.keys(n))E.general[o].value=n[o]}},hide(){this._current&&(this._current.classlist.remove("current"),this._current=void 0)}};function Un(){E.general["visibility-type"].setTrigger=e=>{Me.dataset.visibilityType=e},E.general["visibility-type"].element.addEventListener("change",e=>{E.general["visibility-type"].setTrigger(e.target.value),r().dataset.visibilityType=e.target.value}),E.general["visible-only-on"].element.addEventListener("change",e=>{r().dataset.visibleOnlyOn=e.target.value,O(r())}),E.general["visible-from"].element.addEventListener("change",e=>{r().dataset.visibleFrom=e.target.value,O(r())}),E.general["visible-to"].element.addEventListener("change",e=>{r().dataset.visibleTo=e.target.value,O(r())})}Un();var Ne=0;function l(){return String(Ne++)}function Ae(e){let t=Number(e.id);t>=Ne&&(Ne=t+1);for(let n of e.children)Ae(n)}function q(e){let t=e.cloneNode(!0);function n(o){o.id=l();for(let i of o.children)n(i)}return n(t),t}var N;function p(){return N}function _(){Et(),N&&(N.blur(),N.removeAttribute("id")),N=void 0}function ce(e){_(),N=e,N.setAttribute("id","selected");let t=document.getElementById(e.dataset.id);qn(t),ht.show(t)}function bt(e){ce(e)}function Be(e){let t=e.id,n=T.querySelector(`[data-id="${t}"]`);n.parentElement.replaceChild(v(e),n)}var P;function r(){return P}function Et(){P&&P.classList.remove("selected"),P=void 0}function qn(e){Et(),P=e,P.classList.add("selected")}var je={multipleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},singleChoiceInput:e=>{let t={options:[],correct:[]};for(let n of e.children){let o=n.children[0];t.options.push(o.id),t.correct.push(o.checked)}return t},shortTextInput:e=>({correct:e.value})};var ze;function yt(){ze={};for(let e of Object.keys(je))for(let t of g.querySelectorAll(`[data-type=${e}]`))console.log("extracted",je[e](t)),ze[t.id]=je[e](t);return ze}var vt=document.getElementById("test-name"),Jn=window.location.search,Wn=new URLSearchParams(Jn),De=Wn.get("id"),xt={testName:void 0,export(){let e=a=>{a.classList.remove("current"),a.className===""&&a.removeAttribute("class");for(let s of a.children)e(s)},t=g.cloneNode(!0);e(t);let n=t.innerHTML.trim().replaceAll(/[\s\t][\s\t]+/g,"").replaceAll(' contenteditable="true"',""),o=yt();localStorage.setItem("test",JSON.stringify({html:n,gradingScheme:o}));let i=vt.value;return{id:De,content:n,name:i,description:"",tags:{},gradingScheme:o}},load({name:e,content:t,gradingScheme:n}){console.log(t),n||(n={}),g.innerHTML=t;for(let o of g.getElementsByTagName("p"))o.contentEditable="true";for(let o of g.getElementsByTagName("span"))o.contentEditable="true";Ae(g.firstChild);for(let o of Object.keys(n))document.getElementById(o).value=n[o].correct;T.innerHTML="",T.appendChild(v(g.firstElementChild)),O(g.firstElementChild),vt.value=e}};document.getElementById("save-test").addEventListener("click",async()=>{await it(xt.export(),De??void 0)});async function Vn(){xt.load(await at(De))}Vn();var Pe={};d(Pe,{realElement:()=>Qn});function Qn(){let e=R();return e.appendChild($()),e.appendChild(fe()),e}var _e={};d(_e,{realElement:()=>Gn});function Gn(){let e=R();e.appendChild($());let t=he();return t.appendChild(D()),t.appendChild(D()),t.appendChild(D()),t.appendChild(D()),e.appendChild(t),e}var Fe={};d(Fe,{realElement:()=>Xn});function de(e){let t=Ee(e),n=pe();return t.append(n),n.innerText=" abc ",t}function Xn(){let e=R();e.appendChild($());let t=be();return t.appendChild(de(t.id)),t.appendChild(de(t.id)),t.appendChild(de(t.id)),t.appendChild(de(t.id)),e.appendChild(t),e}var F={shortTextQuestion:Pe,multipleChoiceQuestion:_e,singleChoiceQuestion:Fe};function wt(){let e=[];for(let t of Object.keys(F))e.push(t);return e}var J,me;function Kn(){let e=!1;T.addEventListener("click",t=>{p()!==void 0&&(p().contains(t.target)||_(),e||t.preventDefault(),e=!0)},!0),T.addEventListener("contextmenu",t=>{let n=t.target;if(t.preventDefault(),n.classList.contains("list"))ce(n);else if(n.parentElement.classList.contains("list"))ce(n.parentElement);else return;t.stopPropagation();let o=["rcm-add-child","rcm-add-preset","rcm-copy","rcm-delete","rcm-rename"];(n.parentElement.parentElement.parentElement.classList.contains("list")||n.parentElement.parentElement.classList.contains("list"))&&o.push("rcm-add-sibbling"),me!==void 0&&(o.push("rcm-paste-child"),n.parentElement?.classList.contains("list")&&o.push("rcm-paste-above")),H(C.rightClick,o,n)},!0),T.addEventListener("focus",t=>{let n=t.target;n.classList.contains("list")||(n=n.parentElement),n.classList.contains("list")&&(bt(n),e=!1)},!0),document.getElementById("rcm-add-child").addEventListener("click",t=>{J=Yn,H(C.element,Oe(p()),t.target)},!1),document.getElementById("rcm-add-sibbling").addEventListener("click",t=>{J=Zn,H(C.element,Oe(p().parentElement),t.target)},!1),document.getElementById("rcm-add-preset").addEventListener("click",t=>{J=eo,H(C.preset,wt(),t.target)},!1),document.getElementById("rcm-copy").addEventListener("click",t=>{let n=p().dataset.id;me=document.getElementById(n),B()},!1),document.getElementById("rcm-paste-child").addEventListener("click",t=>{let n=q(me);r().appendChild(n),p().parentElement.replaceChild(v(r()),p()),B()},!1),document.getElementById("rcm-paste-above").addEventListener("click",t=>{let n=q(me);r().parentElement.insertBefore(n,r());let o=v(r().parentElement);p().parentElement.parentElement.replaceChild(o,p().parentElement),B()},!1),document.getElementById("rcm-delete").addEventListener("click",t=>{let n=p().dataset.id;p().remove(),_(),document.getElementById(n).remove(),B()},!1),document.getElementById("rcm-rename").addEventListener("click",t=>{let n=p().dataset.id,o=p().firstChild,i=o.innerText,a=document.createElement("input");a.type="text",a.value=i,p().insertBefore(a,o),o.remove(),a.focus(),a.addEventListener("blur",s=>{a.contains(s.relatedTarget)||(o.innerText=a.value,document.getElementById(n).dataset.name=a.value,p().insertBefore(o,a),a.remove())}),a.addEventListener("click",s=>{s.stopPropagation()}),a.addEventListener("keyup",s=>{(s.key==="Enter"||s.key==="Escape")&&a.blur()}),o.remove()},!1);for(let t of Object.keys(u)){let n=document.getElementById(t);n&&n.addEventListener("click",()=>{J(p(),t),_(),B()})}for(let t of Object.keys(F)){let n=document.getElementById(t);n&&n.addEventListener("click",()=>{J(p(),t),_(),B()})}console.log("hello?"),st()}Kn();function Yn(e,t){let n=e.dataset.id,o=document.getElementById(n),i=u[t].realElement(n);o.appendChild(i),u[t].mounted!==void 0&&u[t].mounted(i),e.parentElement.replaceChild(v(o),e)}function Zn(e,t){let n=e.dataset.id,o=document.getElementById(n),i=o.parentElement,a=e.parentElement.id,s=u[t].realElement(a);i.insertBefore(s,o),u[t].mounted!==void 0&&u[t].mounted(s),e.parentElement.insertBefore(v(s),e)}function eo(e,t){let n=e.dataset.id,o=document.getElementById(n),i=F[t].realElement();o.appendChild(i),F[t].mounted!==void 0&&F[t].mounted(i),e.parentElement.replaceChild(v(o),e)}
